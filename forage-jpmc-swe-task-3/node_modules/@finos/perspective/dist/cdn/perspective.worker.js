(()=>{var Hs=Object.defineProperty;var Yr=(h,s)=>()=>(s||h((s={exports:{}}).exports,s),s.exports),Ws=(h,s)=>{for(var i in s)Hs(h,i,{get:s[i],enumerable:!0})};var nr=Yr(()=>{});var Gr=Yr(()=>{});var Ls=(()=>{var h=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(h=h||__filename),function(s){s=s||{};var i=typeof s<"u"?s:{},y,$;i.ready=new Promise(function(e,t){y=e,$=t});var x=Object.assign({},i),k=[],L="./this.program",J=(e,t)=>{throw t},pe=typeof window=="object",j=typeof importScripts=="function",Je=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",K="";function Xe(e){return i.locateFile?i.locateFile(e,K):K+e}var Me,Ue,Pe,be;function G(e){if(e instanceof Hr)return;Ee("exiting due to exception: "+e)}var He,Te,Ze;Je?(j?K=nr().dirname(K)+"/":K=__dirname+"/",Ze=()=>{Te||(He=Gr(),Te=nr())},Me=function(t,r){return Ze(),t=Te.normalize(t),He.readFileSync(t,r?void 0:"utf8")},Pe=e=>{var t=Me(e,!0);return t.buffer||(t=new Uint8Array(t)),t},Ue=(e,t,r)=>{Ze(),e=Te.normalize(e),He.readFile(e,function(n,l){n?r(n):t(l.buffer)})},process.argv.length>1&&(L=process.argv[1].replace(/\\/g,"/")),k=process.argv.slice(2),process.on("uncaughtException",function(e){if(!(e instanceof Hr))throw e}),process.on("unhandledRejection",function(e){throw e}),J=(e,t)=>{if(tn())throw process.exitCode=e,t;G(t),process.exit(e)},i.inspect=function(){return"[Emscripten Module object]"}):(pe||j)&&(j?K=self.location.href:typeof document<"u"&&document.currentScript&&(K=document.currentScript.src),h&&(K=h),K.indexOf("blob:")!==0?K=K.substr(0,K.replace(/[?#].*/,"").lastIndexOf("/")+1):K="",Me=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},j&&(Pe=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),Ue=(e,t,r)=>{var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=()=>{if(n.status==200||n.status==0&&n.response){t(n.response);return}r()},n.onerror=r,n.send(null)},be=e=>document.title=e);var Ce=i.print||console.log.bind(console),Ee=i.printErr||console.warn.bind(console);Object.assign(i,x),x=null,i.arguments&&(k=i.arguments),i.thisProgram&&(L=i.thisProgram),i.quit&&(J=i.quit);var o=4,a=0,_=e=>{a=e},v;i.wasmBinary&&(v=i.wasmBinary);var m=i.noExitRuntime||!0;typeof WebAssembly!="object"&&Le("no native wasm support detected");var O,P=!1,b;function N(e,t){e||Le(t)}var S=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function z(e,t,r){t>>>=0;for(var n=t+r,l=t;e[l]&&!(l>=n);)++l;if(l-t>16&&e.buffer&&S)return S.decode(e.subarray(t,l));for(var c="";t<l;){var f=e[t++];if(!(f&128)){c+=String.fromCharCode(f);continue}var u=e[t++]&63;if((f&224)==192){c+=String.fromCharCode((f&31)<<6|u);continue}var d=e[t++]&63;if((f&240)==224?f=(f&15)<<12|u<<6|d:f=(f&7)<<18|u<<12|d<<6|e[t++]&63,f<65536)c+=String.fromCharCode(f);else{var g=f-65536;c+=String.fromCharCode(55296|g>>10,56320|g&1023)}}return c}function M(e,t){return e>>>=0,e?z(U,e,t):""}function q(e,t,r,n){if(r>>>=0,!(n>0))return 0;for(var l=r,c=r+n-1,f=0;f<e.length;++f){var u=e.charCodeAt(f);if(u>=55296&&u<=57343){var d=e.charCodeAt(++f);u=65536+((u&1023)<<10)|d&1023}if(u<=127){if(r>=c)break;t[r++>>>0]=u}else if(u<=2047){if(r+1>=c)break;t[r++>>>0]=192|u>>6,t[r++>>>0]=128|u&63}else if(u<=65535){if(r+2>=c)break;t[r++>>>0]=224|u>>12,t[r++>>>0]=128|u>>6&63,t[r++>>>0]=128|u&63}else{if(r+3>=c)break;t[r++>>>0]=240|u>>18,t[r++>>>0]=128|u>>12&63,t[r++>>>0]=128|u>>6&63,t[r++>>>0]=128|u&63}}return t[r>>>0]=0,r-l}function ce(e,t,r){return q(e,U,t,r)}function ie(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&(n=65536+((n&1023)<<10)|e.charCodeAt(++r)&1023),n<=127?++t:n<=2047?t+=2:n<=65535?t+=3:t+=4}return t}var fe=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function We(e,t){for(var r=e,n=r>>1,l=n+t/2;!(n>=l)&&xe[n>>>0];)++n;if(r=n<<1,r-e>32&&fe)return fe.decode(U.subarray(e>>>0,r>>>0));for(var c="",f=0;!(f>=t/2);++f){var u=ve[e+f*2>>>1];if(u==0)break;c+=String.fromCharCode(u)}return c}function Ft(e,t,r){if(r===void 0&&(r=2147483647),r<2)return 0;r-=2;for(var n=t,l=r<e.length*2?r/2:e.length,c=0;c<l;++c){var f=e.charCodeAt(c);ve[t>>>1]=f,t+=2}return ve[t>>>1]=0,t-n}function $t(e){return e.length*2}function oe(e,t){for(var r=0,n="";!(r>=t/4);){var l=A[e+r*4>>>2];if(l==0)break;if(++r,l>=65536){var c=l-65536;n+=String.fromCharCode(55296|c>>10,56320|c&1023)}else n+=String.fromCharCode(l)}return n}function he(e,t,r){if(t>>>=0,r===void 0&&(r=2147483647),r<4)return 0;for(var n=t,l=n+r-4,c=0;c<e.length;++c){var f=e.charCodeAt(c);if(f>=55296&&f<=57343){var u=e.charCodeAt(++c);f=65536+((f&1023)<<10)|u&1023}if(A[t>>>2]=f,t+=4,t+4>l)break}return A[t>>>2]=0,t-n}function Re(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&++r,t+=4}return t}function ae(e){var t=ie(e)+1,r=ft(t);return r&&q(e,Z,r,t),r}function te(e,t){Z.set(e,t>>>0)}function le(e,t,r){for(var n=0;n<e.length;++n)Z[t++>>>0]=e.charCodeAt(n);r||(Z[t>>>0]=0)}var se,Z,U,ve,xe,A,H,_r,Dt;function dr(e){se=e,i.HEAP8=Z=new Int8Array(e),i.HEAP16=ve=new Int16Array(e),i.HEAP32=A=new Int32Array(e),i.HEAPU8=U=new Uint8Array(e),i.HEAPU16=xe=new Uint16Array(e),i.HEAPU32=H=new Uint32Array(e),i.HEAPF32=_r=new Float32Array(e),i.HEAPF64=Dt=new Float64Array(e)}var no=i.INITIAL_MEMORY||16777216,pr,hr=[],vr=[],gr=[],en=!1;function tn(){return m}function rn(){if(i.preRun)for(typeof i.preRun=="function"&&(i.preRun=[i.preRun]);i.preRun.length;)on(i.preRun.shift());Nt(hr)}function nn(){en=!0,Nt(vr)}function sn(){if(i.postRun)for(typeof i.postRun=="function"&&(i.postRun=[i.postRun]);i.postRun.length;)ln(i.postRun.shift());Nt(gr)}function on(e){hr.unshift(e)}function an(e){vr.unshift(e)}function ln(e){gr.unshift(e)}var De=0,It=null,Ke=null;function un(e){De++,i.monitorRunDependencies&&i.monitorRunDependencies(De)}function cn(e){if(De--,i.monitorRunDependencies&&i.monitorRunDependencies(De),De==0&&(It!==null&&(clearInterval(It),It=null),Ke)){var t=Ke;Ke=null,t()}}function Le(e){i.onAbort&&i.onAbort(e),e="Aborted("+e+")",Ee(e),P=!0,b=1,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw $(t),t}var fn="data:application/octet-stream;base64,";function mr(e){return e.startsWith(fn)}function yr(e){return e.startsWith("file://")}var ne;ne="perspective.cpp.wasm",mr(ne)||(ne=Xe(ne));function wr(e){try{if(e==ne&&v)return new Uint8Array(v);if(Pe)return Pe(e);throw"both async and sync fetching of the wasm failed"}catch(t){Le(t)}}function _n(){if(!v&&(pe||j)){if(typeof fetch=="function"&&!yr(ne))return fetch(ne,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+ne+"'";return e.arrayBuffer()}).catch(function(){return wr(ne)});if(Ue)return new Promise(function(e,t){Ue(ne,function(r){e(new Uint8Array(r))},t)})}return Promise.resolve().then(function(){return wr(ne)})}function dn(){var e={a:Ts};function t(f,u){var d=f.exports;i.asm=d,O=i.asm.qa,dr(O.buffer),pr=i.asm.ua,an(i.asm.ra),cn("wasm-instantiate")}un("wasm-instantiate");function r(f){t(f.instance)}function n(f){return _n().then(function(u){return WebAssembly.instantiate(u,e)}).then(function(u){return u}).then(f,function(u){Ee("failed to asynchronously prepare wasm: "+u),Le(u)})}function l(){return!v&&typeof WebAssembly.instantiateStreaming=="function"&&!mr(ne)&&!yr(ne)&&!Je&&typeof fetch=="function"?fetch(ne,{credentials:"same-origin"}).then(function(f){var u=WebAssembly.instantiateStreaming(f,e);return u.then(r,function(d){return Ee("wasm streaming compile failed: "+d),Ee("falling back to ArrayBuffer instantiation"),n(r)})}):n(r)}if(i.instantiateWasm)try{var c=i.instantiateWasm(e,t);return c}catch(f){return Ee("Module.instantiateWasm callback failed with error: "+f),!1}return l().catch($),{}}var pn={834452:e=>{throw new Error(M(e))}};function Nt(e){for(;e.length>0;){var t=e.shift();if(typeof t=="function"){t(i);continue}var r=t.func;typeof r=="number"?t.arg===void 0?vt(r)():vt(r)(t.arg):r(t.arg===void 0?null:t.arg)}}var ht=[];function vt(e){var t=ht[e];return t||(e>=ht.length&&(ht.length=e+1),ht[e]=t=pr.get(e)),t}function hn(e,t,r,n){Le("Assertion failed: "+M(e)+", at: "+[t?M(t):"unknown filename",r,n?M(n):"unknown function"])}function vn(e){return ft(e+24)+24}function gn(e){this.excPtr=e,this.ptr=e-24,this.set_type=function(t){H[this.ptr+4>>>2]=t},this.get_type=function(){return H[this.ptr+4>>>2]},this.set_destructor=function(t){H[this.ptr+8>>>2]=t},this.get_destructor=function(){return H[this.ptr+8>>>2]},this.set_refcount=function(t){A[this.ptr>>>2]=t},this.set_caught=function(t){t=t?1:0,Z[this.ptr+12>>>0]=t},this.get_caught=function(){return Z[this.ptr+12>>>0]!=0},this.set_rethrown=function(t){t=t?1:0,Z[this.ptr+13>>>0]=t},this.get_rethrown=function(){return Z[this.ptr+13>>>0]!=0},this.init=function(t,r){this.set_adjusted_ptr(0),this.set_type(t),this.set_destructor(r),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var t=A[this.ptr>>>2];A[this.ptr>>>2]=t+1},this.release_ref=function(){var t=A[this.ptr>>>2];return A[this.ptr>>>2]=t-1,t===1},this.set_adjusted_ptr=function(t){H[this.ptr+16>>>2]=t},this.get_adjusted_ptr=function(){return H[this.ptr+16>>>2]},this.get_exception_ptr=function(){var t=Ur(this.get_type());if(t)return H[this.excPtr>>>2];var r=this.get_adjusted_ptr();return r!==0?r:this.excPtr}}var mn=0,yn=0;function wn(e,t,r){var n=new gn(e);throw n.init(t,r),mn=e,yn++,e}var Qe={varargs:void 0,get:function(){Qe.varargs+=4;var e=A[Qe.varargs-4>>>2];return e},getStr:function(e){var t=M(e);return t}};function bn(e,t,r){return Qe.varargs=r,0}function Tn(e,t,r){}function Cn(e,t,r){}function En(e,t,r){return Qe.varargs=r,0}function An(e,t,r,n){Qe.varargs=n}function On(e,t){}function Sn(e,t,r){}var gt={};function Vt(e){for(;e.length;){var t=e.pop(),r=e.pop();r(t)}}function et(e){return this.fromWireType(H[e>>>2])}var ze={},Ie={},mt={},Pn=48,Rn=57;function yt(e){if(e===void 0)return"_unknown";e=e.replace(/[^a-zA-Z0-9_]/g,"$");var t=e.charCodeAt(0);return t>=Pn&&t<=Rn?"_"+e:e}function wt(e,t){return e=yt(e),new Function("body","return function "+e+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(t)}function Mt(e,t){var r=wt(t,function(n){this.name=t,this.message=n;var l=new Error(n).stack;l!==void 0&&(this.stack=this.toString()+`
`+l.replace(/^Error(:[^\n]*)?\n/,""))});return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},r}var br=void 0;function bt(e){throw new br(e)}function ke(e,t,r){e.forEach(function(u){mt[u]=t});function n(u){var d=r(u);d.length!==e.length&&bt("Mismatched type converter count");for(var g=0;g<e.length;++g)ge(e[g],d[g])}var l=new Array(t.length),c=[],f=0;t.forEach((u,d)=>{Ie.hasOwnProperty(u)?l[d]=Ie[u]:(c.push(u),ze.hasOwnProperty(u)||(ze[u]=[]),ze[u].push(()=>{l[d]=Ie[u],++f,f===c.length&&n(l)}))}),c.length===0&&n(l)}function xn(e){var t=gt[e];delete gt[e];var r=t.rawConstructor,n=t.rawDestructor,l=t.fields,c=l.map(f=>f.getterReturnType).concat(l.map(f=>f.setterArgumentType));ke([e],c,f=>{var u={};return l.forEach((d,g)=>{var E=d.fieldName,C=f[g],T=d.getter,I=d.getterContext,W=f[g+l.length],Y=d.setter,Q=d.setterContext;u[E]={read:R=>C.fromWireType(T(I,R)),write:(R,p)=>{var w=[];Y(Q,R,W.toWireType(w,p)),Vt(w)}}}),[{name:t.name,fromWireType:function(d){var g={};for(var E in u)g[E]=u[E].read(d);return n(d),g},toWireType:function(d,g){for(var E in u)if(!(E in g))throw new TypeError('Missing field:  "'+E+'"');var C=r();for(E in u)u[E].write(C,g[E]);return d!==null&&d.push(n,C),C},argPackAdvance:8,readValueFromPointer:et,destructorFunction:n}]})}function kn(e,t,r,n,l){}function Tt(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}function jn(){for(var e=new Array(256),t=0;t<256;++t)e[t]=String.fromCharCode(t);Tr=e}var Tr=void 0;function X(e){for(var t="",r=e;U[r>>>0];)t+=Tr[U[r++>>>0]];return t}var Ye=void 0;function D(e){throw new Ye(e)}function ge(e,t,r={}){if(!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var n=t.name;if(e||D('type "'+n+'" must have a positive integer typeid pointer'),Ie.hasOwnProperty(e)){if(r.ignoreDuplicateRegistrations)return;D("Cannot register type '"+n+"' twice")}if(Ie[e]=t,delete mt[e],ze.hasOwnProperty(e)){var l=ze[e];delete ze[e],l.forEach(c=>c())}}function Fn(e,t,r,n,l){var c=Tt(r);t=X(t),ge(e,{name:t,fromWireType:function(f){return!!f},toWireType:function(f,u){return u?n:l},argPackAdvance:8,readValueFromPointer:function(f){var u;if(r===1)u=Z;else if(r===2)u=ve;else if(r===4)u=A;else throw new TypeError("Unknown boolean type size: "+t);return this.fromWireType(u[f>>>c])},destructorFunction:null})}function $n(e){if(!(this instanceof je)||!(e instanceof je))return!1;for(var t=this.$$.ptrType.registeredClass,r=this.$$.ptr,n=e.$$.ptrType.registeredClass,l=e.$$.ptr;t.baseClass;)r=t.upcast(r),t=t.baseClass;for(;n.baseClass;)l=n.upcast(l),n=n.baseClass;return t===n&&r===l}function Dn(e){return{count:e.count,deleteScheduled:e.deleteScheduled,preservePointerOnDelete:e.preservePointerOnDelete,ptr:e.ptr,ptrType:e.ptrType,smartPtr:e.smartPtr,smartPtrType:e.smartPtrType}}function Ut(e){function t(r){return r.$$.ptrType.registeredClass.name}D(t(e)+" instance already deleted")}var Ht=!1;function Cr(e){}function In(e){e.smartPtr?e.smartPtrType.rawDestructor(e.smartPtr):e.ptrType.registeredClass.rawDestructor(e.ptr)}function Er(e){e.count.value-=1;var t=e.count.value===0;t&&In(e)}function Ar(e,t,r){if(t===r)return e;if(r.baseClass===void 0)return null;var n=Ar(e,t,r.baseClass);return n===null?null:r.downcast(n)}var Or={};function Nn(){return Object.keys(nt).length}function Vn(){var e=[];for(var t in nt)nt.hasOwnProperty(t)&&e.push(nt[t]);return e}var tt=[];function Wt(){for(;tt.length;){var e=tt.pop();e.$$.deleteScheduled=!1,e.delete()}}var rt=void 0;function Mn(e){rt=e,tt.length&&rt&&rt(Wt)}function Un(){i.getInheritedInstanceCount=Nn,i.getLiveInheritedInstances=Vn,i.flushPendingDeletes=Wt,i.setDelayFunction=Mn}var nt={};function Hn(e,t){for(t===void 0&&D("ptr should not be undefined");e.baseClass;)t=e.upcast(t),e=e.baseClass;return t}function Wn(e,t){return t=Hn(e,t),nt[t]}function Ct(e,t){(!t.ptrType||!t.ptr)&&bt("makeClassHandle requires ptr and ptrType");var r=!!t.smartPtrType,n=!!t.smartPtr;return r!==n&&bt("Both smartPtrType and smartPtr must be specified"),t.count={value:1},it(Object.create(e,{$$:{value:t}}))}function Ln(e){var t=this.getPointee(e);if(!t)return this.destructor(e),null;var r=Wn(this.registeredClass,t);if(r!==void 0){if(r.$$.count.value===0)return r.$$.ptr=t,r.$$.smartPtr=e,r.clone();var n=r.clone();return this.destructor(e),n}function l(){return this.isSmartPointer?Ct(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:t,smartPtrType:this,smartPtr:e}):Ct(this.registeredClass.instancePrototype,{ptrType:this,ptr:e})}var c=this.registeredClass.getActualType(t),f=Or[c];if(!f)return l.call(this);var u;this.isConst?u=f.constPointerType:u=f.pointerType;var d=Ar(t,this.registeredClass,u.registeredClass);return d===null?l.call(this):this.isSmartPointer?Ct(u.registeredClass.instancePrototype,{ptrType:u,ptr:d,smartPtrType:this,smartPtr:e}):Ct(u.registeredClass.instancePrototype,{ptrType:u,ptr:d})}function it(e){return typeof FinalizationRegistry>"u"?(it=t=>t,e):(Ht=new FinalizationRegistry(t=>{Er(t.$$)}),it=t=>{var r=t.$$,n=!!r.smartPtr;if(n){var l={$$:r};Ht.register(t,l,t)}return t},Cr=t=>Ht.unregister(t),it(e))}function zn(){if(this.$$.ptr||Ut(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var e=it(Object.create(Object.getPrototypeOf(this),{$$:{value:Dn(this.$$)}}));return e.$$.count.value+=1,e.$$.deleteScheduled=!1,e}function Yn(){this.$$.ptr||Ut(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&D("Object already scheduled for deletion"),Cr(this),Er(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Gn(){return!this.$$.ptr}function Bn(){return this.$$.ptr||Ut(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&D("Object already scheduled for deletion"),tt.push(this),tt.length===1&&rt&&rt(Wt),this.$$.deleteScheduled=!0,this}function qn(){je.prototype.isAliasOf=$n,je.prototype.clone=zn,je.prototype.delete=Yn,je.prototype.isDeleted=Gn,je.prototype.deleteLater=Bn}function je(){}function Sr(e,t,r){if(e[t].overloadTable===void 0){var n=e[t];e[t]=function(){return e[t].overloadTable.hasOwnProperty(arguments.length)||D("Function '"+r+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[t].overloadTable+")!"),e[t].overloadTable[arguments.length].apply(this,arguments)},e[t].overloadTable=[],e[t].overloadTable[n.argCount]=n}}function Lt(e,t,r){i.hasOwnProperty(e)?((r===void 0||i[e].overloadTable!==void 0&&i[e].overloadTable[r]!==void 0)&&D("Cannot register public name '"+e+"' twice"),Sr(i,e,e),i.hasOwnProperty(r)&&D("Cannot register multiple overloads of a function with the same number of arguments ("+r+")!"),i[e].overloadTable[r]=t):(i[e]=t,r!==void 0&&(i[e].numArguments=r))}function Jn(e,t,r,n,l,c,f,u){this.name=e,this.constructor=t,this.instancePrototype=r,this.rawDestructor=n,this.baseClass=l,this.getActualType=c,this.upcast=f,this.downcast=u,this.pureVirtualFunctions=[]}function zt(e,t,r){for(;t!==r;)t.upcast||D("Expected null or instance of "+r.name+", got an instance of "+t.name),e=t.upcast(e),t=t.baseClass;return e}function Xn(e,t){if(t===null)return this.isReference&&D("null is not a valid "+this.name),0;t.$$||D('Cannot pass "'+Jt(t)+'" as a '+this.name),t.$$.ptr||D("Cannot pass deleted object as a pointer of type "+this.name);var r=t.$$.ptrType.registeredClass,n=zt(t.$$.ptr,r,this.registeredClass);return n}function Zn(e,t){var r;if(t===null)return this.isReference&&D("null is not a valid "+this.name),this.isSmartPointer?(r=this.rawConstructor(),e!==null&&e.push(this.rawDestructor,r),r):0;t.$$||D('Cannot pass "'+Jt(t)+'" as a '+this.name),t.$$.ptr||D("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&t.$$.ptrType.isConst&&D("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);var n=t.$$.ptrType.registeredClass;if(r=zt(t.$$.ptr,n,this.registeredClass),this.isSmartPointer)switch(t.$$.smartPtr===void 0&&D("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:t.$$.smartPtrType===this?r=t.$$.smartPtr:D("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:r=t.$$.smartPtr;break;case 2:if(t.$$.smartPtrType===this)r=t.$$.smartPtr;else{var l=t.clone();r=this.rawShare(r,V.toHandle(function(){l.delete()})),e!==null&&e.push(this.rawDestructor,r)}break;default:D("Unsupporting sharing policy")}return r}function Kn(e,t){if(t===null)return this.isReference&&D("null is not a valid "+this.name),0;t.$$||D('Cannot pass "'+Jt(t)+'" as a '+this.name),t.$$.ptr||D("Cannot pass deleted object as a pointer of type "+this.name),t.$$.ptrType.isConst&&D("Cannot convert argument of type "+t.$$.ptrType.name+" to parameter type "+this.name);var r=t.$$.ptrType.registeredClass,n=zt(t.$$.ptr,r,this.registeredClass);return n}function Qn(e){return this.rawGetPointee&&(e=this.rawGetPointee(e)),e}function ei(e){this.rawDestructor&&this.rawDestructor(e)}function ti(e){e!==null&&e.delete()}function ri(){me.prototype.getPointee=Qn,me.prototype.destructor=ei,me.prototype.argPackAdvance=8,me.prototype.readValueFromPointer=et,me.prototype.deleteObject=ti,me.prototype.fromWireType=Ln}function me(e,t,r,n,l,c,f,u,d,g,E){this.name=e,this.registeredClass=t,this.isReference=r,this.isConst=n,this.isSmartPointer=l,this.pointeeType=c,this.sharingPolicy=f,this.rawGetPointee=u,this.rawConstructor=d,this.rawShare=g,this.rawDestructor=E,!l&&t.baseClass===void 0?n?(this.toWireType=Xn,this.destructorFunction=null):(this.toWireType=Kn,this.destructorFunction=null):this.toWireType=Zn}function Pr(e,t,r){i.hasOwnProperty(e)||bt("Replacing nonexistant public symbol"),i[e].overloadTable!==void 0&&r!==void 0?i[e].overloadTable[r]=t:(i[e]=t,i[e].argCount=r)}function ni(e,t,r){var n=i["dynCall_"+e];return r&&r.length?n.apply(null,[t].concat(r)):n.call(null,t)}function ii(e,t,r){return e.includes("j")?ni(e,t,r):vt(t).apply(null,r)}function si(e,t){var r=[];return function(){return r.length=0,Object.assign(r,arguments),ii(e,t,r)}}function re(e,t){e=X(e);function r(){return e.includes("j")?si(e,t):vt(t)}var n=r();return typeof n!="function"&&D("unknown function pointer with signature "+e+": "+t),n}var Rr=void 0;function xr(e){var t=Mr(e),r=X(t);return Ae(t),r}function Et(e,t){var r=[],n={};function l(c){if(!n[c]&&!Ie[c]){if(mt[c]){mt[c].forEach(l);return}r.push(c),n[c]=!0}}throw t.forEach(l),new Rr(e+": "+r.map(xr).join([", "]))}function oi(e,t,r,n,l,c,f,u,d,g,E,C,T){E=X(E),c=re(l,c),u&&(u=re(f,u)),g&&(g=re(d,g)),T=re(C,T);var I=yt(E);Lt(I,function(){Et("Cannot construct "+E+" due to unbound types",[n])}),ke([e,t,r],n?[n]:[],function(W){W=W[0];var Y,Q;n?(Y=W.registeredClass,Q=Y.instancePrototype):Q=je.prototype;var R=wt(I,function(){if(Object.getPrototypeOf(this)!==p)throw new Ye("Use 'new' to construct "+E);if(w.constructor_body===void 0)throw new Ye(E+" has no accessible constructor");var Ne=w.constructor_body[arguments.length];if(Ne===void 0)throw new Ye("Tried to invoke ctor of "+E+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(w.constructor_body).toString()+") parameters instead!");return Ne.apply(this,arguments)}),p=Object.create(Q,{constructor:{value:R}});R.prototype=p;var w=new Jn(E,R,p,T,Y,c,u,g),ee=new me(E,w,!0,!1,!1),B=new me(E+"*",w,!1,!1,!1),ye=new me(E+" const*",w,!1,!0,!1);return Or[e]={pointerType:B,constPointerType:ye},Pr(I,R),[ee,B,ye]})}function Yt(e,t){for(var r=[],n=0;n<e;n++)r.push(A[(t>>2)+n>>>0]);return r}function kr(e,t){if(!(e instanceof Function))throw new TypeError("new_ called with constructor type "+typeof e+" which is not a function");var r=wt(e.name||"unknownFunctionName",function(){});r.prototype=e.prototype;var n=new r,l=e.apply(n,t);return l instanceof Object?l:n}function Gt(e,t,r,n,l){var c=t.length;c<2&&D("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var f=t[1]!==null&&r!==null,u=!1,d=1;d<t.length;++d)if(t[d]!==null&&t[d].destructorFunction===void 0){u=!0;break}for(var g=t[0].name!=="void",E="",C="",d=0;d<c-2;++d)E+=(d!==0?", ":"")+"arg"+d,C+=(d!==0?", ":"")+"arg"+d+"Wired";var T="return function "+yt(e)+"("+E+`) {
if (arguments.length !== `+(c-2)+`) {
throwBindingError('function `+e+" called with ' + arguments.length + ' arguments, expected "+(c-2)+` args!');
}
`;u&&(T+=`var destructors = [];
`);var I=u?"destructors":"null",W=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],Y=[D,n,l,Vt,t[0],t[1]];f&&(T+="var thisWired = classParam.toWireType("+I+`, this);
`);for(var d=0;d<c-2;++d)T+="var arg"+d+"Wired = argType"+d+".toWireType("+I+", arg"+d+"); // "+t[d+2].name+`
`,W.push("argType"+d),Y.push(t[d+2]);if(f&&(C="thisWired"+(C.length>0?", ":"")+C),T+=(g?"var rv = ":"")+"invoker(fn"+(C.length>0?", ":"")+C+`);
`,u)T+=`runDestructors(destructors);
`;else for(var d=f?1:2;d<t.length;++d){var Q=d===1?"thisWired":"arg"+(d-2)+"Wired";t[d].destructorFunction!==null&&(T+=Q+"_dtor("+Q+"); // "+t[d].name+`
`,W.push(Q+"_dtor"),Y.push(t[d].destructorFunction))}g&&(T+=`var ret = retType.fromWireType(rv);
return ret;
`),T+=`}
`,W.push(T);var R=kr(Function,W).apply(null,Y);return R}function ai(e,t,r,n,l,c){N(t>0);var f=Yt(t,r);l=re(n,l),ke([],[e],function(u){u=u[0];var d="constructor "+u.name;if(u.registeredClass.constructor_body===void 0&&(u.registeredClass.constructor_body=[]),u.registeredClass.constructor_body[t-1]!==void 0)throw new Ye("Cannot register multiple constructors with identical number of parameters ("+(t-1)+") for class '"+u.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return u.registeredClass.constructor_body[t-1]=()=>{Et("Cannot construct "+u.name+" due to unbound types",f)},ke([],f,function(g){return g.splice(1,0,null),u.registeredClass.constructor_body[t-1]=Gt(d,g,null,l,c),[]}),[]})}function li(e,t,r,n,l,c,f,u){var d=Yt(r,n);t=X(t),c=re(l,c),ke([],[e],function(g){g=g[0];var E=g.name+"."+t;t.startsWith("@@")&&(t=Symbol[t.substring(2)]),u&&g.registeredClass.pureVirtualFunctions.push(t);function C(){Et("Cannot call "+E+" due to unbound types",d)}var T=g.registeredClass.instancePrototype,I=T[t];return I===void 0||I.overloadTable===void 0&&I.className!==g.name&&I.argCount===r-2?(C.argCount=r-2,C.className=g.name,T[t]=C):(Sr(T,t,E),T[t].overloadTable[r-2]=C),ke([],d,function(W){var Y=Gt(E,W,g,c,f);return T[t].overloadTable===void 0?(Y.argCount=r-2,T[t]=Y):T[t].overloadTable[r-2]=Y,[]}),[]})}var Bt=[],_e=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function qt(e){e>4&&--_e[e].refcount===0&&(_e[e]=void 0,Bt.push(e))}function ui(){for(var e=0,t=5;t<_e.length;++t)_e[t]!==void 0&&++e;return e}function ci(){for(var e=5;e<_e.length;++e)if(_e[e]!==void 0)return _e[e];return null}function fi(){i.count_emval_handles=ui,i.get_first_emval=ci}var V={toValue:e=>(e||D("Cannot use deleted val. handle = "+e),_e[e].value),toHandle:e=>{switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var t=Bt.length?Bt.pop():_e.length;return _e[t]={refcount:1,value:e},t}}}};function _i(e,t){t=X(t),ge(e,{name:t,fromWireType:function(r){var n=V.toValue(r);return qt(r),n},toWireType:function(r,n){return V.toHandle(n)},argPackAdvance:8,readValueFromPointer:et,destructorFunction:null})}function di(e,t,r){switch(t){case 0:return function(n){var l=r?Z:U;return this.fromWireType(l[n>>>0])};case 1:return function(n){var l=r?ve:xe;return this.fromWireType(l[n>>>1])};case 2:return function(n){var l=r?A:H;return this.fromWireType(l[n>>>2])};default:throw new TypeError("Unknown integer type: "+e)}}function pi(e,t,r,n){var l=Tt(r);t=X(t);function c(){}c.values={},ge(e,{name:t,constructor:c,fromWireType:function(f){return this.constructor.values[f]},toWireType:function(f,u){return u.value},argPackAdvance:8,readValueFromPointer:di(t,l,n),destructorFunction:null}),Lt(t,c)}function st(e,t){var r=Ie[e];return r===void 0&&D(t+" has unknown type "+xr(e)),r}function hi(e,t,r){var n=st(e,"enum");t=X(t);var l=n.constructor,c=Object.create(n.constructor.prototype,{value:{value:r},constructor:{value:wt(n.name+"_"+t,function(){})}});l.values[r]=c,l[t]=c}function Jt(e){if(e===null)return"null";var t=typeof e;return t==="object"||t==="array"||t==="function"?e.toString():""+e}function vi(e,t){switch(t){case 2:return function(r){return this.fromWireType(_r[r>>>2])};case 3:return function(r){return this.fromWireType(Dt[r>>>3])};default:throw new TypeError("Unknown float type: "+e)}}function gi(e,t,r){var n=Tt(r);t=X(t),ge(e,{name:t,fromWireType:function(l){return l},toWireType:function(l,c){return c},argPackAdvance:8,readValueFromPointer:vi(t,n),destructorFunction:null})}function mi(e,t,r,n,l,c){var f=Yt(t,r);e=X(e),l=re(n,l),Lt(e,function(){Et("Cannot call "+e+" due to unbound types",f)},t-1),ke([],f,function(u){var d=[u[0],null].concat(u.slice(1));return Pr(e,Gt(e,d,null,l,c),t-1),[]})}function yi(e,t,r){switch(t){case 0:return r?function(l){return Z[l>>>0]}:function(l){return U[l>>>0]};case 1:return r?function(l){return ve[l>>>1]}:function(l){return xe[l>>>1]};case 2:return r?function(l){return A[l>>>2]}:function(l){return H[l>>>2]};default:throw new TypeError("Unknown integer type: "+e)}}function wi(e,t,r,n,l){t=X(t),l===-1&&(l=4294967295);var c=Tt(r),f=C=>C;if(n===0){var u=32-8*r;f=C=>C<<u>>>u}var d=t.includes("unsigned"),g=(C,T)=>{},E;d?E=function(C,T){return g(T,this.name),T>>>0}:E=function(C,T){return g(T,this.name),T},ge(e,{name:t,fromWireType:f,toWireType:E,argPackAdvance:8,readValueFromPointer:yi(t,c,n!==0),destructorFunction:null})}function bi(e,t,r){var n=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],l=n[t];function c(f){f=f>>2;var u=H,d=u[f>>>0],g=u[f+1>>>0];return new l(se,g,d)}r=X(r),ge(e,{name:r,fromWireType:c,argPackAdvance:8,readValueFromPointer:c},{ignoreDuplicateRegistrations:!0})}function Ti(e,t,r,n,l,c,f,u,d,g,E,C){r=X(r),c=re(l,c),u=re(f,u),g=re(d,g),C=re(E,C),ke([e],[t],function(T){T=T[0];var I=new me(r,T.registeredClass,!1,!1,!0,T,n,c,u,g,C);return[I]})}function Ci(e,t){t=X(t);var r=t==="std::string";ge(e,{name:t,fromWireType:function(n){var l=H[n>>>2],c;if(r)for(var f=n+4,u=0;u<=l;++u){var d=n+4+u;if(u==l||U[d>>>0]==0){var g=d-f,E=M(f,g);c===void 0?c=E:(c+=String.fromCharCode(0),c+=E),f=d+1}}else{for(var C=new Array(l),u=0;u<l;++u)C[u]=String.fromCharCode(U[n+4+u>>>0]);c=C.join("")}return Ae(n),c},toWireType:function(n,l){l instanceof ArrayBuffer&&(l=new Uint8Array(l));var c,f=typeof l=="string";f||l instanceof Uint8Array||l instanceof Uint8ClampedArray||l instanceof Int8Array||D("Cannot pass non-string to std::string"),r&&f?c=()=>ie(l):c=()=>l.length;var u=c(),d=ft(4+u+1);if(d>>>=0,H[d>>>2]=u,r&&f)ce(l,d+4,u+1);else if(f)for(var g=0;g<u;++g){var E=l.charCodeAt(g);E>255&&(Ae(d),D("String has UTF-16 code units that do not fit in 8 bits")),U[d+4+g>>>0]=E}else for(var g=0;g<u;++g)U[d+4+g>>>0]=l[g];return n!==null&&n.push(Ae,d),d},argPackAdvance:8,readValueFromPointer:et,destructorFunction:function(n){Ae(n)}})}function Ei(e,t,r){r=X(r);var n,l,c,f,u;t===2?(n=We,l=Ft,f=$t,c=()=>xe,u=1):t===4&&(n=oe,l=he,f=Re,c=()=>H,u=2),ge(e,{name:r,fromWireType:function(d){for(var g=H[d>>>2],E=c(),C,T=d+4,I=0;I<=g;++I){var W=d+4+I*t;if(I==g||E[W>>>u]==0){var Y=W-T,Q=n(T,Y);C===void 0?C=Q:(C+=String.fromCharCode(0),C+=Q),T=W+t}}return Ae(d),C},toWireType:function(d,g){typeof g!="string"&&D("Cannot pass non-string to C++ string type "+r);var E=f(g),C=ft(4+E+t);return C>>>=0,H[C>>>2]=E>>u,l(g,C+4,E+t),d!==null&&d.push(Ae,C),C},argPackAdvance:8,readValueFromPointer:et,destructorFunction:function(d){Ae(d)}})}function Ai(e,t,r,n,l,c){gt[e]={name:X(t),rawConstructor:re(r,n),rawDestructor:re(l,c),fields:[]}}function Oi(e,t,r,n,l,c,f,u,d,g){gt[e].fields.push({fieldName:X(t),getterReturnType:r,getter:re(n,l),getterContext:c,setterArgumentType:f,setter:re(u,d),setterContext:g})}function Si(e,t){t=X(t),ge(e,{isVoid:!0,name:t,argPackAdvance:0,fromWireType:function(){},toWireType:function(r,n){}})}function Pi(){return Date.now()}var Ri=!0;function xi(){return Ri}function ki(e,t,r){e=V.toValue(e),t=st(t,"emval::as");var n=[],l=V.toHandle(n);return A[r>>>2]=l,t.toWireType(n,e)}function jr(e,t){for(var r=new Array(e),n=0;n<e;++n)r[n]=st(H[t+n*o>>>2],"parameter "+n);return r}function ji(e,t,r,n){e=V.toValue(e);for(var l=jr(t,r),c=new Array(t),f=0;f<t;++f){var u=l[f];c[f]=u.readValueFromPointer(n),n+=u.argPackAdvance}var d=e.apply(void 0,c);return V.toHandle(d)}function Fi(e){var t=[];return A[e>>>2]=V.toHandle(t),t}var $i={};function ot(e){var t=$i[e];return t===void 0?X(e):t}var At=[];function Di(e,t,r,n,l){return e=At[e],t=V.toValue(t),r=ot(r),e(t,r,Fi(n),l)}function Ii(e,t,r,n){e=At[e],t=V.toValue(t),r=ot(r),e(t,r,null,n)}function Fr(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function Ni(e){return e===0?V.toHandle(Fr()):(e=ot(e),V.toHandle(Fr()[e]))}function Vi(e){var t=At.length;return At.push(e),t}var $r=[];function Mi(e,t){var r=jr(e,t),n=r[0],l=n.name+"_$"+r.slice(1).map(function(W){return W.name}).join("_")+"$",c=$r[l];if(c!==void 0)return c;for(var f=["retType"],u=[n],d="",g=0;g<e-1;++g)d+=(g!==0?", ":"")+"arg"+g,f.push("argType"+g),u.push(r[1+g]);for(var E=yt("methodCaller_"+l),C="return function "+E+`(handle, name, destructors, args) {
`,T=0,g=0;g<e-1;++g)C+="    var arg"+g+" = argType"+g+".readValueFromPointer(args"+(T?"+"+T:"")+`);
`,T+=r[g+1].argPackAdvance;C+="    var rv = handle[name]("+d+`);
`;for(var g=0;g<e-1;++g)r[g+1].deleteObject&&(C+="    argType"+g+".deleteObject(arg"+g+`);
`);n.isVoid||(C+=`    return retType.toWireType(destructors, rv);
`),C+=`};
`,f.push(C);var I=kr(Function,f).apply(null,u);return c=Vi(I),$r[l]=c,c}function Ui(e){return e=ot(e),V.toHandle(i[e])}function Hi(e,t){return e=V.toValue(e),t=V.toValue(t),V.toHandle(e[t])}function Wi(e){e>4&&(_e[e].refcount+=1)}function Li(e,t){return e=V.toValue(e),t=V.toValue(t),e instanceof t}function zi(e){for(var t="",r=0;r<e;++r)t+=(r!==0?", ":"")+"arg"+r;for(var n="return function emval_allocator_"+e+`(constructor, argTypes, args) {
`,r=0;r<e;++r)n+="var argType"+r+" = requireRegisteredType(Module['HEAP32'][(argTypes >>> 2) + "+r+'], "parameter '+r+`");
var arg`+r+" = argType"+r+`.readValueFromPointer(args);
args += argType`+r+`['argPackAdvance'];
`;return n+="var obj = new constructor("+t+`);
return valueToHandle(obj);
}
`,new Function("requireRegisteredType","Module","valueToHandle",n)(st,i,V.toHandle)}var Dr={};function Yi(e,t,r,n){e=V.toValue(e);var l=Dr[t];return l||(l=zi(t),Dr[t]=l),l(e,r,n)}function Gi(){return V.toHandle([])}function Bi(e){return V.toHandle(ot(e))}function qi(){return V.toHandle({})}function Ji(e){var t=V.toValue(e);Vt(t),qt(e)}function Xi(e,t,r){e=V.toValue(e),t=V.toValue(t),r=V.toValue(r),e[t]=r}function Zi(e,t){e=st(e,"_emval_take_value");var r=e.readValueFromPointer(t);return V.toHandle(r)}function Ki(e){return e=V.toValue(e),V.toHandle(typeof e)}function Qi(e,t){var r=new Date(A[e>>>2]*1e3);A[t>>>2]=r.getSeconds(),A[t+4>>>2]=r.getMinutes(),A[t+8>>>2]=r.getHours(),A[t+12>>>2]=r.getDate(),A[t+16>>>2]=r.getMonth(),A[t+20>>>2]=r.getFullYear()-1900,A[t+24>>>2]=r.getDay();var n=new Date(r.getFullYear(),0,1),l=(r.getTime()-n.getTime())/(1e3*60*60*24)|0;A[t+28>>>2]=l,A[t+36>>>2]=-(r.getTimezoneOffset()*60);var c=new Date(r.getFullYear(),6,1).getTimezoneOffset(),f=n.getTimezoneOffset(),u=(c!=f&&r.getTimezoneOffset()==Math.min(f,c))|0;A[t+32>>>2]=u}function es(e,t,r,n,l,c){return-52}function ts(e,t,r,n,l,c){e>>>=0}function rs(e,t,r){var n=new Date().getFullYear(),l=new Date(n,0,1),c=new Date(n,6,1),f=l.getTimezoneOffset(),u=c.getTimezoneOffset(),d=Math.max(f,u);A[e>>>2]=d*60,A[t>>>2]=Number(f!=u);function g(W){var Y=W.toTimeString().match(/\(([A-Za-z ]+)\)$/);return Y?Y[1]:"GMT"}var E=g(l),C=g(c),T=ae(E),I=ae(C);u<f?(H[r>>>2]=T,H[r+4>>>2]=I):(H[r>>>2]=I,H[r+4>>>2]=T)}function Xt(e,t,r){Xt.called||(Xt.called=!0,rs(e,t,r))}function ns(){Le("")}var Zt=[];function is(e,t){Zt.length=0;var r;for(t>>=2;r=U[e++>>>0];)t+=r!=105&t,Zt.push(r==105?A[t>>>0]:Dt[t++>>>1]),++t;return Zt}function ss(e,t,r){var n=is(t,r);return pn[e].apply(null,n)}function Ir(){return 4294901760}function os(){return Ir()}var Kt;Je?Kt=()=>{var e=process.hrtime();return e[0]*1e3+e[1]/1e6}:Kt=()=>performance.now();function as(e,t,r){U.copyWithin(e>>>0,t>>>0,t+r>>>0)}function ls(e){try{return O.grow(e-se.byteLength+65535>>>16),dr(O.buffer),1}catch{}}function us(e){var t=U.length;e=e>>>0;var r=Ir();if(e>r)return!1;let n=(d,g)=>d+(g-d%g)%g;for(var l=1;l<=4;l*=2){var c=t*(1+.2/l);c=Math.min(c,e+100663296);var f=Math.min(r,n(Math.max(e,c),65536)),u=ls(f);if(u)return!0}return!1}var Qt={};function cs(){return L||"./this.program"}function at(){if(!at.strings){var e=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:e,_:cs()};for(var r in Qt)Qt[r]===void 0?delete t[r]:t[r]=Qt[r];var n=[];for(var r in t)n.push(r+"="+t[r]);at.strings=n}return at.strings}function fs(e,t){var r=0;return at().forEach(function(n,l){var c=t+r;H[e+l*4>>>2]=c,le(n,c),r+=n.length+1}),0}function _s(e,t){var r=at();H[e>>>2]=r.length;var n=0;return r.forEach(function(l){n+=l.length+1}),H[t>>>2]=n,0}function ds(e){return 52}function ps(e,t,r,n){return 52}function hs(e,t,r,n,l){return 70}var vs=[null,[],[]];function gs(e,t){var r=vs[e];t===0||t===10?((e===1?Ce:Ee)(z(r,0)),r.length=0):r.push(t)}function ms(e,t,r,n){for(var l=0,c=0;c<r;c++){var f=H[t>>>2],u=H[t+4>>>2];t+=8;for(var d=0;d<u;d++)gs(e,U[f+d>>>0]);l+=u}return H[n>>>2]=l,0}function ys(e){_(e)}function Ge(e){return e%4===0&&(e%100!==0||e%400===0)}function er(e,t){for(var r=0,n=0;n<=t;r+=e[n++]);return r}var lt=[31,29,31,30,31,30,31,31,30,31,30,31],ut=[31,28,31,30,31,30,31,31,30,31,30,31];function ct(e,t){for(var r=new Date(e.getTime());t>0;){var n=Ge(r.getFullYear()),l=r.getMonth(),c=(n?lt:ut)[l];if(t>c-r.getDate())t-=c-r.getDate()+1,r.setDate(1),l<11?r.setMonth(l+1):(r.setMonth(0),r.setFullYear(r.getFullYear()+1));else return r.setDate(r.getDate()+t),r}return r}function Nr(e,t,r,n){var l=A[n+40>>>2],c={tm_sec:A[n>>>2],tm_min:A[n+4>>>2],tm_hour:A[n+8>>>2],tm_mday:A[n+12>>>2],tm_mon:A[n+16>>>2],tm_year:A[n+20>>>2],tm_wday:A[n+24>>>2],tm_yday:A[n+28>>>2],tm_isdst:A[n+32>>>2],tm_gmtoff:A[n+36>>>2],tm_zone:l?M(l):""},f=M(r),u={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var d in u)f=f.replace(new RegExp(d,"g"),u[d]);var g=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],E=["January","February","March","April","May","June","July","August","September","October","November","December"];function C(p,w,ee){for(var B=typeof p=="number"?p.toString():p||"";B.length<w;)B=ee[0]+B;return B}function T(p,w){return C(p,w,"0")}function I(p,w){function ee(ye){return ye<0?-1:ye>0?1:0}var B;return(B=ee(p.getFullYear()-w.getFullYear()))===0&&(B=ee(p.getMonth()-w.getMonth()))===0&&(B=ee(p.getDate()-w.getDate())),B}function W(p){switch(p.getDay()){case 0:return new Date(p.getFullYear()-1,11,29);case 1:return p;case 2:return new Date(p.getFullYear(),0,3);case 3:return new Date(p.getFullYear(),0,2);case 4:return new Date(p.getFullYear(),0,1);case 5:return new Date(p.getFullYear()-1,11,31);case 6:return new Date(p.getFullYear()-1,11,30)}}function Y(p){var w=ct(new Date(p.tm_year+1900,0,1),p.tm_yday),ee=new Date(w.getFullYear(),0,4),B=new Date(w.getFullYear()+1,0,4),ye=W(ee),Ne=W(B);return I(ye,w)<=0?I(Ne,w)<=0?w.getFullYear()+1:w.getFullYear():w.getFullYear()-1}var Q={"%a":function(p){return g[p.tm_wday].substring(0,3)},"%A":function(p){return g[p.tm_wday]},"%b":function(p){return E[p.tm_mon].substring(0,3)},"%B":function(p){return E[p.tm_mon]},"%C":function(p){var w=p.tm_year+1900;return T(w/100|0,2)},"%d":function(p){return T(p.tm_mday,2)},"%e":function(p){return C(p.tm_mday,2," ")},"%g":function(p){return Y(p).toString().substring(2)},"%G":function(p){return Y(p)},"%H":function(p){return T(p.tm_hour,2)},"%I":function(p){var w=p.tm_hour;return w==0?w=12:w>12&&(w-=12),T(w,2)},"%j":function(p){return T(p.tm_mday+er(Ge(p.tm_year+1900)?lt:ut,p.tm_mon-1),3)},"%m":function(p){return T(p.tm_mon+1,2)},"%M":function(p){return T(p.tm_min,2)},"%n":function(){return`
`},"%p":function(p){return p.tm_hour>=0&&p.tm_hour<12?"AM":"PM"},"%S":function(p){return T(p.tm_sec,2)},"%t":function(){return"	"},"%u":function(p){return p.tm_wday||7},"%U":function(p){var w=p.tm_yday+7-p.tm_wday;return T(Math.floor(w/7),2)},"%V":function(p){var w=Math.floor((p.tm_yday+7-(p.tm_wday+6)%7)/7);if((p.tm_wday+371-p.tm_yday-2)%7<=2&&w++,w){if(w==53){var B=(p.tm_wday+371-p.tm_yday)%7;B!=4&&(B!=3||!Ge(p.tm_year))&&(w=1)}}else{w=52;var ee=(p.tm_wday+7-p.tm_yday-1)%7;(ee==4||ee==5&&Ge(p.tm_year%400-1))&&w++}return T(w,2)},"%w":function(p){return p.tm_wday},"%W":function(p){var w=p.tm_yday+7-(p.tm_wday+6)%7;return T(Math.floor(w/7),2)},"%y":function(p){return(p.tm_year+1900).toString().substring(2)},"%Y":function(p){return p.tm_year+1900},"%z":function(p){var w=p.tm_gmtoff,ee=w>=0;return w=Math.abs(w)/60,w=w/60*100+w%60,(ee?"+":"-")+String("0000"+w).slice(-4)},"%Z":function(p){return p.tm_zone},"%%":function(){return"%"}};f=f.replace(/%%/g,"\0\0");for(var d in Q)f.includes(d)&&(f=f.replace(new RegExp(d,"g"),Q[d](c)));f=f.replace(/\0\0/g,"%");var R=Vr(f,!1);return R.length>t?0:(te(R,e),R.length-1)}function ws(e,t,r,n){return Nr(e,t,r,n)}function ue(e){return parseInt(e)}function bs(e,t,r){for(var n=M(t),l="\\!@#$^&*()+=-[]/{}|:<>?,.",c=0,f=l.length;c<f;++c)n=n.replace(new RegExp("\\"+l[c],"g"),"\\"+l[c]);var u={"%A":"%a","%B":"%b","%c":"%a %b %d %H:%M:%S %Y","%D":"%m\\/%d\\/%y","%e":"%d","%F":"%Y-%m-%d","%h":"%b","%R":"%H\\:%M","%r":"%I\\:%M\\:%S\\s%p","%T":"%H\\:%M\\:%S","%x":"%m\\/%d\\/(?:%y|%Y)","%X":"%H\\:%M\\:%S"};for(var d in u)n=n.replace(d,u[d]);var g={"%a":"(?:Sun(?:day)?)|(?:Mon(?:day)?)|(?:Tue(?:sday)?)|(?:Wed(?:nesday)?)|(?:Thu(?:rsday)?)|(?:Fri(?:day)?)|(?:Sat(?:urday)?)","%b":"(?:Jan(?:uary)?)|(?:Feb(?:ruary)?)|(?:Mar(?:ch)?)|(?:Apr(?:il)?)|May|(?:Jun(?:e)?)|(?:Jul(?:y)?)|(?:Aug(?:ust)?)|(?:Sep(?:tember)?)|(?:Oct(?:ober)?)|(?:Nov(?:ember)?)|(?:Dec(?:ember)?)","%C":"\\d\\d","%d":"0[1-9]|[1-9](?!\\d)|1\\d|2\\d|30|31","%H":"\\d(?!\\d)|[0,1]\\d|20|21|22|23","%I":"\\d(?!\\d)|0\\d|10|11|12","%j":"00[1-9]|0?[1-9](?!\\d)|0?[1-9]\\d(?!\\d)|[1,2]\\d\\d|3[0-6]\\d","%m":"0[1-9]|[1-9](?!\\d)|10|11|12","%M":"0\\d|\\d(?!\\d)|[1-5]\\d","%n":"\\s","%p":"AM|am|PM|pm|A\\.M\\.|a\\.m\\.|P\\.M\\.|p\\.m\\.","%S":"0\\d|\\d(?!\\d)|[1-5]\\d|60","%U":"0\\d|\\d(?!\\d)|[1-4]\\d|50|51|52|53","%W":"0\\d|\\d(?!\\d)|[1-4]\\d|50|51|52|53","%w":"[0-6]","%y":"\\d\\d","%Y":"\\d\\d\\d\\d","%%":"%","%t":"\\s"},E={JAN:0,FEB:1,MAR:2,APR:3,MAY:4,JUN:5,JUL:6,AUG:7,SEP:8,OCT:9,NOV:10,DEC:11},C={SUN:0,MON:1,TUE:2,WED:3,THU:4,FRI:5,SAT:6},T={MON:0,TUE:1,WED:2,THU:3,FRI:4,SAT:5,SUN:6};for(var I in g)n=n.replace(I,"("+I+g[I]+")");for(var W=[],c=n.indexOf("%");c>=0;c=n.indexOf("%"))W.push(n[c+1]),n=n.replace(new RegExp("\\%"+n[c+1],"g"),"");var Y=new RegExp("^"+n,"i").exec(M(e));function Q(){function Fe($e,rr,zr){return typeof $e!="number"||isNaN($e)?rr:$e>=rr?$e<=zr?$e:zr:rr}return{year:Fe(A[r+20>>>2]+1900,1970,9999),month:Fe(A[r+16>>>2],0,11),day:Fe(A[r+12>>>2],1,31),hour:Fe(A[r+8>>>2],0,23),min:Fe(A[r+4>>>2],0,59),sec:Fe(A[r>>>2],0,59)}}if(Y){var R=Q(),p,w=Fe=>{var $e=W.indexOf(Fe);if($e>=0)return Y[$e+1]};if((p=w("S"))&&(R.sec=ue(p)),(p=w("M"))&&(R.min=ue(p)),p=w("H"))R.hour=ue(p);else if(p=w("I")){var ee=ue(p);(p=w("p"))&&(ee+=p.toUpperCase()[0]==="P"?12:0),R.hour=ee}if(p=w("Y"))R.year=ue(p);else if(p=w("y")){var B=ue(p);(p=w("C"))?B+=ue(p)*100:B+=B<69?2e3:1900,R.year=B}if((p=w("m"))?R.month=ue(p)-1:(p=w("b"))&&(R.month=E[p.substring(0,3).toUpperCase()]||0),p=w("d"))R.day=ue(p);else if(p=w("j"))for(var ye=ue(p),Ne=Ge(R.year),St=0;St<12;++St){var Wr=er(Ne?lt:ut,St-1);ye<=Wr+(Ne?lt:ut)[St]&&(R.day=ye-Wr)}else if(p=w("a")){var Lr=p.substring(0,3).toUpperCase();if(p=w("U")){var _t=C[Lr],dt=ue(p),Oe=new Date(R.year,0,1),Se;Oe.getDay()===0?Se=ct(Oe,_t+7*(dt-1)):Se=ct(Oe,7-Oe.getDay()+_t+7*(dt-1)),R.day=Se.getDate(),R.month=Se.getMonth()}else if(p=w("W")){var _t=T[Lr],dt=ue(p),Oe=new Date(R.year,0,1),Se;Oe.getDay()===1?Se=ct(Oe,_t+7*(dt-1)):Se=ct(Oe,7-Oe.getDay()+1+_t+7*(dt-1)),R.day=Se.getDate(),R.month=Se.getMonth()}}var we=new Date(R.year,R.month,R.day,R.hour,R.min,R.sec,0);return A[r>>>2]=we.getSeconds(),A[r+4>>>2]=we.getMinutes(),A[r+8>>>2]=we.getHours(),A[r+12>>>2]=we.getDate(),A[r+16>>>2]=we.getMonth(),A[r+20>>>2]=we.getFullYear()-1900,A[r+24>>>2]=we.getDay(),A[r+28>>>2]=er(Ge(we.getFullYear())?lt:ut,we.getMonth()-1)+we.getDate()-1,A[r+32>>>2]=0,e+Vr(Y[0]).length-1}return 0}br=i.InternalError=Mt(Error,"InternalError"),jn(),Ye=i.BindingError=Mt(Error,"BindingError"),qn(),Un(),ri(),Rr=i.UnboundTypeError=Mt(Error,"UnboundTypeError"),fi();function Vr(e,t,r){var n=r>0?r:ie(e)+1,l=new Array(n),c=q(e,l,0,l.length);return t&&(l.length=c),l}var Ts={a:hn,i:vn,h:wn,M:bn,T:Tn,X:Cn,da:En,N:An,aa:On,V:Sn,F:xn,U:kn,la:Fn,q:oi,v:ai,d:li,ka:_i,Q:pi,u:hi,O:gi,p:mi,B:wi,x:bi,y:Ti,P:Ci,J:Ei,G:Ai,A:Oi,ma:Si,ga:Pi,fa:xi,l:ki,pa:ji,o:Di,r:Ii,b:qt,s:Ni,k:Mi,w:Ui,m:Hi,e:Wi,R:Li,t:Yi,H:Gi,n:Bi,L:qi,g:Ji,C:Xi,j:Zi,D:Ki,ha:Qi,Y:es,Z:ts,ia:Xt,f:ns,c:ss,W:os,ea:Kt,ja:as,I:us,_:fs,$:_s,E:ds,ca:ps,S:hs,ba:ms,K:ys,oa:Nr,z:ws,na:bs},io=dn(),Cs=i.___wasm_call_ctors=function(){return(Cs=i.___wasm_call_ctors=i.asm.ra).apply(null,arguments)},ft=i._malloc=function(){return(ft=i._malloc=i.asm.sa).apply(null,arguments)},Ae=i._free=function(){return(Ae=i._free=i.asm.ta).apply(null,arguments)},Mr=i.___getTypeName=function(){return(Mr=i.___getTypeName=i.asm.va).apply(null,arguments)},Es=i.___embind_register_native_and_builtin_types=function(){return(Es=i.___embind_register_native_and_builtin_types=i.asm.wa).apply(null,arguments)},Ur=i.___cxa_is_pointer_type=function(){return(Ur=i.___cxa_is_pointer_type=i.asm.xa).apply(null,arguments)},As=i.dynCall_ji=function(){return(As=i.dynCall_ji=i.asm.ya).apply(null,arguments)},Os=i.dynCall_viij=function(){return(Os=i.dynCall_viij=i.asm.za).apply(null,arguments)},Ss=i.dynCall_viiij=function(){return(Ss=i.dynCall_viiij=i.asm.Aa).apply(null,arguments)},Ps=i.dynCall_viiijj=function(){return(Ps=i.dynCall_viiijj=i.asm.Ba).apply(null,arguments)},Rs=i.dynCall_viji=function(){return(Rs=i.dynCall_viji=i.asm.Ca).apply(null,arguments)},xs=i.dynCall_viiji=function(){return(xs=i.dynCall_viiji=i.asm.Da).apply(null,arguments)},ks=i.dynCall_viijji=function(){return(ks=i.dynCall_viijji=i.asm.Ea).apply(null,arguments)},js=i.dynCall_viijj=function(){return(js=i.dynCall_viijj=i.asm.Fa).apply(null,arguments)},Fs=i.dynCall_viijij=function(){return(Fs=i.dynCall_viijij=i.asm.Ga).apply(null,arguments)},$s=i.dynCall_viiiijii=function(){return($s=i.dynCall_viiiijii=i.asm.Ha).apply(null,arguments)},Ds=i.dynCall_vijjji=function(){return(Ds=i.dynCall_vijjji=i.asm.Ia).apply(null,arguments)},Is=i.dynCall_jiji=function(){return(Is=i.dynCall_jiji=i.asm.Ja).apply(null,arguments)},Ns=i.dynCall_viijii=function(){return(Ns=i.dynCall_viijii=i.asm.Ka).apply(null,arguments)},Vs=i.dynCall_iiiiij=function(){return(Vs=i.dynCall_iiiiij=i.asm.La).apply(null,arguments)},Ms=i.dynCall_iiiiijj=function(){return(Ms=i.dynCall_iiiiijj=i.asm.Ma).apply(null,arguments)},Us=i.dynCall_iiiiiijj=function(){return(Us=i.dynCall_iiiiiijj=i.asm.Na).apply(null,arguments)},Ot;function Hr(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}Ke=function e(){Ot||tr(),Ot||(Ke=e)};function tr(e){if(e=e||k,De>0||(rn(),De>0))return;function t(){Ot||(Ot=!0,i.calledRun=!0,!P&&(nn(),y(i),i.onRuntimeInitialized&&i.onRuntimeInitialized(),sn()))}i.setStatus?(i.setStatus("Running..."),setTimeout(function(){setTimeout(function(){i.setStatus("")},1),t()},1)):t()}if(i.run=tr,i.preInit)for(typeof i.preInit=="function"&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();return tr(),s.ready}})(),Br=Ls;var Pt={};Ws(Pt,{COLUMN_SEPARATOR_STRING:()=>de,CONFIG_ALIASES:()=>Be,CONFIG_VALID_KEYS:()=>sr,DATA_TYPES:()=>zs,FILTER_OPERATORS:()=>F,SORT_ORDERS:()=>Gs,SORT_ORDER_IDS:()=>Bs,TYPE_AGGREGATES:()=>qs,TYPE_FILTERS:()=>Zs});var zs={integer:"integer",float:"float",string:"string",boolean:"boolean",date:"date",datetime:"datetime",object:"object"},Be={row_pivot:"group_by","row-pivot":"group_by","row-pivots":"group_by",col_pivot:"split_by",col_pivots:"split_by",column_pivot:"split_by","column-pivot":"split_by","column-pivots":"split_by",filters:"filter",sorts:"sort"},sr=["viewport","group_by","split_by","aggregates","columns","filter","sort","computed_columns","expressions","group_by_depth","split_by_depth","filter_op"],qr=["any","avg","abs sum","count","distinct count","dominant","first by index","last by index","last minus first","last","high","join","low","high minus low","mean","median","pct sum parent","pct sum grand total","stddev","sum","sum abs","sum not null","unique","var"],ir=["any","count","distinct count","distinct leaf","dominant","first by index","join","last by index","last","unique"],Ys=["any","count","distinct count","distinct leaf","dominant","first by index","last by index","last","unique"],Gs=["none","asc","desc","col asc","col desc","asc abs","desc abs","col asc abs","col desc abs"],Bs=[2,0,1,0,1,3,4,3,4],qs={string:ir,float:qr,integer:qr,boolean:Ys,datetime:ir,date:ir},F={lessThan:"<",greaterThan:">",equals:"==",lessThanOrEquals:"<=",greaterThanOrEquals:">=",doesNotEqual:"!=",isNull:"is null",isNotNull:"is not null",isIn:"in",isNotIn:"not in",contains:"contains",bitwiseAnd:"&",bitwiseOr:"|",and:"and",or:"or",beginsWith:"begins with",endsWith:"ends with"},Js=[F.bitwiseAnd,F.bitwiseOr,F.equals,F.doesNotEqual,F.or,F.and,F.isNull,F.isNotNull],Jr=[F.lessThan,F.greaterThan,F.equals,F.lessThanOrEquals,F.greaterThanOrEquals,F.doesNotEqual,F.isNull,F.isNotNull],Xs=[F.equals,F.contains,F.doesNotEqual,F.isIn,F.isNotIn,F.beginsWith,F.endsWith,F.isNull,F.isNotNull],Xr=[F.lessThan,F.greaterThan,F.equals,F.lessThanOrEquals,F.greaterThanOrEquals,F.doesNotEqual,F.isNull,F.isNotNull],de="|",Zs={string:Xs,float:Jr,integer:Jr,boolean:Js,datetime:Xr,date:Xr};var or={types:{float:{filter_operator:"==",aggregate:"sum",format:{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}},string:{filter_operator:"==",aggregate:"count"},integer:{filter_operator:"==",aggregate:"sum",format:{}},boolean:{filter_operator:"==",aggregate:"count"},datetime:{filter_operator:"==",aggregate:"count",format:{dateStyle:"short",timeStyle:"medium"},null_value:-1},date:{filter_operator:"==",aggregate:"count",format:{dateStyle:"short"},null_value:-1}}};function Ve(h){let s={};if(Zr().types[h]&&Object.assign(s,Zr().types[h]),s.type){let i=Ve(s.type);return Object.assign(i,s),i}else return s}function ar(h){return h&&typeof h=="object"&&!Array.isArray(h)}function Rt(h,...s){if(!s.length)return h;let i=s.shift();if(ar(h)&&ar(i))for(let y in i)ar(i[y])?(h[y]||Object.assign(h,{[y]:{}}),Rt(h[y],i[y])):Object.assign(h,{[y]:i[y]});return Rt(h,...s)}function Kr(h){globalThis.__PERSPECTIVE_CONFIG__&&console.warn("Config already initialized!"),globalThis.__PERSPECTIVE_CONFIG__=Rt(or,h)}function Zr(){return globalThis.__PERSPECTIVE_CONFIG__||(globalThis.__PERSPECTIVE_CONFIG__=Rt(or,globalThis.__TEMPLATE_CONFIG__||{})),globalThis.__PERSPECTIVE_CONFIG__}function xt(h){if(h>=1&&h<=8)return"integer";if(h===19)return"string";if(h===10||h===9)return"float";if(h===11)return"boolean";if(h===12)return"datetime";if(h===13)return"date";console.warn(`Unknown type for value ${h} with JS type ${typeof h}`)}function lr(h){let s=h;do for(let i of Object.getOwnPropertyNames(s)){let y=h[i];i!=="constructor"&&typeof y=="function"&&(h[i]=y.bind(h))}while(s=s!==Object&&Object.getPrototypeOf(s))}String.prototype.includes||(String.prototype.includes=function(h,s){return typeof s!="number"&&(s=0),s+h.length>this.length?!1:this.indexOf(h,s)!==-1});Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(h,s){if(this==null)throw new TypeError('"this" is null or not defined');var i=Object(this),y=i.length>>>0;if(y===0)return!1;var $=s|0,x=Math.max($>=0?$:y-Math.abs($),0);function k(L,J){return L===J||typeof L=="number"&&typeof J=="number"&&isNaN(L)&&isNaN(J)}for(;x<y;){if(k(i[x],h))return!0;x++}return!1}});var kt=class{constructor(){this.data_formats={row:0,column:1,schema:2},this.format=void 0,this.data=void 0,this.names=void 0,this.types=void 0,this.row_count=void 0}is_format(s){if(Array.isArray(s))return this.data_formats.row;if(Array.isArray(s[Object.keys(s)[0]]))return this.data_formats.column;if(typeof s[Object.keys(s)[0]]=="string"||typeof s[Object.keys(s)[0]]=="function")return this.data_formats.schema;throw`Could not determine data format for ${JSON.stringify(s)}, with JS typeof ${typeof s}`}count_rows(s){return this.format===this.data_formats.row?s.length:this.format===this.data_formats.column?s[Object.keys(s)[0]].length:0}get_format(){return this.format}get(s,i){let y;if(this.format===this.data_formats.row){let $=this.data[i];$.hasOwnProperty(s)&&(y=$[s])}else if(this.format===this.data_formats.column)this.data.hasOwnProperty(s)&&(y=this.data[s][i]);else if(this.format===this.data_formats.schema)y=void 0;else throw`Could not get() from dataset - ${this.data} is poorly formatted.`;return y}marshal(s,i,y){let $=this.names[s],x=Ks(this.get($,i));if(x===null)return null;if(!(typeof x>"u")){switch(xt(y.value)){case"float":case"integer":{x=Number(x);break}case"boolean":{typeof x=="string"?x.toLowerCase()==="true"?x=!0:x=!1:x=!!x;break}case"datetime":case"date":break;default:x+=""}return x}}clean(){this.names=void 0,this.types=void 0}init(s){this.data=s,this.format=this.is_format(this.data),this.row_count=this.count_rows(this.data);let i={};if(this.format===this.data_formats.row)s.length>0?this.names=Object.keys(s[0]):this.clean.names=[];else if(this.format===this.data_formats.column)this.names=Object.keys(s);else if(this.format===this.data_formats.schema){this.names=Object.keys(s);for(let y of this.names){let $=Ve(s[y]);$.type&&(console.debug(`Converting "${s[y]}" to "${$.type}"`),i[y]=s[y],s[y]=$.type)}}else throw`Could not initialize - failed to determine format for ${s}`;return i}};function Ks(h){return h===null||h==="null"?null:h===void 0||h==="undefined"?void 0:h}var ur=function(h){let s=[];for(let i=0;i<h.size();i++){let y=h.get(i);s.push(y)}return h.delete(),s},cr=function(h){let s={},i=h.keys();for(let y=0;y<i.size();y++){let $=i.get(y);s[$]=h.get($)}return h.delete(),i.delete(),s},qe=function(h,s){for(let i of s)h.push_back(i);return h};function Qs(h){let s={};return typeof h!="string"?Object.getOwnPropertyNames(h).forEach(i=>{s[i]=h[i]},h):s.message=h,s}var pt=class{constructor(s){this.perspective=s,this._tables={},this._views={},this._callback_cache=new Map}init(s){s.config&&Kr(s.config),s.data=["wait_for_response"],this.post(s)}post(s){throw new Error(`Posting ${s} failed - post() not implemented!`)}process(s,i){switch(s.cmd){case"init_profile_thread":this.perspective.initialize_profile_thread();break;case"memory_usage":this.post({id:s.id,data:this.perspective.memory_usage()});break;case"init":this.init(s);break;case"table":if(typeof s.args[0]>"u")this._tables[s.name]=[];else try{let k=this._tables[s.name],L=this.perspective.table(s.args[0],s.options);if(L&&L.then)L.then(J=>{if(this._tables[s.name]=J,k)for(let pe of k)this.process(pe);this.post({id:s.id,data:s.name})}).catch(J=>this.process_error(s,J));else{if(this._tables[s.name]=L,k)for(let J of k)this.process(J);this.post({id:s.id,data:s.name})}}catch(k){this.process_error(s,k);return}break;case"table_generate":(0,eval)(s.args)(function(k){this._tables[s.name]=k,this.post({id:s.id,data:"created!"})});break;case"table_execute":(0,eval)(s.f)(this._tables[s.name]);break;case"table_method":case"view_method":this.process_method_call(s);break;case"view":let x=this._tables[s.table_name];if(x&&Array.isArray(x))x.push(s),this._views[s.view_name]=[];else try{let k=this._views[s.view_name],L=this._tables[s.table_name].view(s.config);if(L&&L.then)L.then(J=>{if(this._views[s.view_name]=J,this._views[s.view_name].client_id=i,k)for(let pe of k)this.process(pe);this.post({id:s.id,data:s.view_name})}).catch(J=>this.process_error(s,J));else{if(this._views[s.view_name]=L,this._views[s.view_name].client_id=i,k)for(let J of k)this.process(J);this.post({id:s.id,data:s.view_name})}}catch(k){this.process_error(s,k);return}break}}process_subscribe(s,i){try{let y;s.method.slice(0,2)==="on"?(y=$=>{let x={id:s.id,data:$};try{if(s.args&&s.args[0]&&s.method==="on_update"&&s.args[0].mode==="row"){this.post(x,[$.delta]);return}this.post(x)}catch{console.error(`Removing failed callback to \`${s.method}()\` (presumably due to failed connection)`);let L=s.method.substring(3);i[`remove_${L}`](y)}},s.callback_id&&this._callback_cache.set(s.callback_id,y)):s.callback_id&&(y=this._callback_cache.get(s.callback_id),this._callback_cache.delete(s.callback_id)),y?i[s.method](y,...s.args):console.error(`Callback not found for remote call "${JSON.stringify(s)}"`)}catch(y){this.process_error(s,y);return}}process_method_call(s){let i,y,$=s.view_name||s.name;if(s.cmd==="table_method"?i=this._tables[$]:i=this._views[$],!i&&s.cmd==="view_method"){this.process_error(s,{message:"View method cancelled"});return}if(i&&i.push){i.push(s);return}try{if(s.subscribe){this.process_subscribe(s,i);return}else y=i[s.method].apply(i,s.args),y instanceof Promise?y.then(x=>this.process_method_call_response(s,x)).catch(x=>this.process_error(s,x)):this.process_method_call_response(s,y)}catch(x){this.process_error(s,x);return}}process_method_call_response(s,i){s.method==="delete"&&delete this._views[s.name],s.method==="to_arrow"?this.post({id:s.id,data:i},[i]):this.post({id:s.id,data:i})}process_error(s,i){this.post({id:s.id,error:Qs(i)})}clear_views(s){for(let i of Object.keys(this._views))if(this._views[i].client_id===s){try{this._views[i].delete()}catch(y){console.error(y)}delete this._views[i]}console.debug(`GC ${Object.keys(this._views).length} views in memory`)}};var eo={initDataValue:()=>[],initRowValue:()=>({}),initColumnValue:(h,s,i)=>s[i]=[],setColumnValue:(h,s,i,y)=>s[i]=y,addColumnValue:(h,s,i,y)=>s[i].unshift(y),addRow:(h,s)=>h.push(s),formatData:h=>h,slice:(h,s)=>h.slice(s)},to={initDataValue:()=>new Object,initRowValue:()=>{},setColumnValue:(h,s,i,y)=>{h[i]=h[i]||[],h[i].push(y)},addColumnValue:(h,s,i,y)=>{h[i]=h[i]||[],h[i][h[i].length-1].unshift(y)},initColumnValue:(h,s,i)=>{h[i]=h[i]||[],h[i].push([])},addRow:()=>{},formatData:h=>h,slice:(h,s)=>{let i={};for(let y in h)i[y]=h[y].slice(s);return i}},fr={jsonFormatter:eo,jsonTableFormatter:to};typeof self<"u"&&self.performance===void 0&&(self.performance={now:Date.now});var jt=new Set;function Qr(h){let s=h,i=new kt,y=["zero","one","two"],$={};function x(o,a){$[a]?o.delete():($[a]=o,setTimeout(()=>k(a)))}function k(o){let a=$[o];a&&(a._process(),L(o))}function L(o){$[o]?.delete(),delete $[o]}function J(){let o=performance.memory?JSON.parse(JSON.stringify(performance.memory,["totalJSHeapSize","usedJSHeapSize","jsHeapSizeLimit"])):process.memoryUsage();return o.wasmHeap=s.HEAP8.length,o}function pe(o,a,_,v,m,O,P,b,N){_||(_=""),v||(v=4294967295),a=s.make_table(a,o,v,_,m,O,P,b,N);let S=a.get_pool(),z=a.get_id();return O||m==s.t_op.OP_DELETE?x(S,z):(S._process(),S.delete()),a}function j(o,a,_,v,m){this.name=m,this._View=void 0,this.table=o,this.config=_||{},this.view_config=v||new v,this.is_unit_context=this.table.index===""&&a===0&&this.view_config.group_by.length===0&&this.view_config.split_by.length===0&&this.view_config.filter.length===0&&this.view_config.sort.length===0&&this.view_config.expressions.length===0,this.is_unit_context?this._View=s.make_view_unit(o._Table,m,de,this.view_config,null):a===0?this._View=s.make_view_zero(o._Table,m,de,this.view_config,null):a===1?this._View=s.make_view_one(o._Table,m,de,this.view_config,null):a===2&&(this._View=s.make_view_two(o._Table,m,de,this.view_config,null)),this.ctx=this._View.get_context(),this.column_only=this._View.is_column_only(),this.update_callbacks=this.table.update_callbacks,this.overridden_types=this.table.overridden_types,this._delete_callbacks=[],lr(this)}j.prototype.get_config=function(){return JSON.parse(JSON.stringify(this.config))},j.prototype.delete=function(){L(this.table.get_id()),this._View.delete(),this.ctx.delete(),this.table.views.splice(this.table.views.indexOf(this),1),this.table=void 0;let o=0,a=0;for(;o<this.update_callbacks.length;){let _=this.update_callbacks[o];_.view!==this&&(this.update_callbacks[a++]=_),o++}this.update_callbacks.length=a,this._delete_callbacks.forEach(_=>_())},j.prototype.sides=function(){return this._View.sides()},j.prototype._num_hidden=function(){let o=0;for(let a of this.config.sort)this.config.columns.indexOf(a[0])===-1&&o++;return o};function Je(o){let a=[];for(let _=0;_<o.size();_++){let v=o.get(_);a.push(s.scalar_to_val(v,!1,!0)),v.delete()}return o.delete(),a}let K=function(o){let a=[];for(let _=0;_<o.size();_++){let v=o.get(_);a.push(Je(v))}return o.delete(),a};j.prototype.schema=function(o=!0){let a=cr(this._View.schema());if(o)for(let _ of Object.keys(a)){let v=_.split(de);v=v[v.length-1],this.overridden_types[v]&&Ve(this.overridden_types[v]).type===a[_]&&(a[_]=this.overridden_types[v])}return a},j.prototype.expression_schema=function(o=!0){let a=cr(this._View.expression_schema());if(o)for(let _ of Object.keys(a)){let v=_.split(de);v=v[v.length-1],this.overridden_types[v]&&Ve(this.overridden_types[v]).type===a[_]&&(a[_]=this.overridden_types[v])}return a},j.prototype._column_names=function(o=!1,a=0){return K(this._View.column_names(o,a)).map(_=>_.join(de))},j.prototype.column_paths=function(){return K(this._View.column_paths()).map(o=>o.join(de))},j.prototype.get_data_slice=function(o,a,_,v){if(this.is_unit_context)return s.get_data_slice_unit(this._View,o,a,_,v);{let m=this.sides(),O=y[m];return s[`get_data_slice_${O}`](this._View,o,a,_,v)}};let Xe=function(o){o=o||{};let a=this._View.num_columns()+(this.sides()===0?0:1),_=this._View.num_rows(),v=this._num_hidden(),m=this.sides()>0||this.column_only?1:0,O=this.config.viewport?this.config.viewport:{},P=o.start_row||(O.top?O.top:0),b=Math.min(_,o.end_row!==void 0?o.end_row:O.height?P+O.height:_),N=o.start_col||(O.left?O.left:0),S=Math.min(a,(o.end_col!==void 0?o.end_col+m:O.width?N+O.width:a)*(v+1));return o.start_row=Math.floor(P),o.end_row=Math.ceil(b),o.start_col=Math.floor(N),o.end_col=Math.ceil(S),o};j.prototype.get_min_max=function(o){if(this.is_unit_context)return s.get_min_max_unit(this._View,o);{let a=this.sides(),_=y[a];return s[`get_min_max_${_}`](this._View,o)}};let Me=function(o,a){k(this.table.get_id()),o=Xe.bind(this)(o);let _=o.start_row,v=o.end_row,m=o.start_col,O=o.end_col,P=this._num_hidden(),b=o.formatted,N=!!o.index,S=!!o.id,z=!!o.leaves_only,M=this.sides(),q=M!==0&&!this.column_only,ce=y[M],ie;this.is_unit_context?ie=s.get_from_data_slice_unit:ie=s[`get_from_data_slice_${ce}`];let fe=this.get_data_slice(_,v,m,O),We=fe.get_column_names(),Ft=K(We).map(he=>he.join(de)),$t=this.schema(),oe=a.initDataValue();for(let he=_;he<v;he++){let Re=q?fe.get_row_path(he):void 0;if(q&&z&&Re.size()<this.config.group_by.length){Re.delete();continue}let ae=a.initRowValue();S&&a.initColumnValue(oe,ae,"__ID__");for(let te=m;te<O;te++){let le=Ft[te],se=$t[le],Z=Ve(se);if(te===m&&M!==0){if(!this.column_only){a.initColumnValue(oe,ae,"__ROW_PATH__");for(let U=0;U<Re.size();U++){let ve=Re.get(U),xe=s.scalar_to_val(ve,!1,!1);ve.delete(),a.addColumnValue(oe,ae,"__ROW_PATH__",xe),S&&a.addColumnValue(oe,ae,"__ID__",xe)}}}else{if((te-(M>0?1:0))%(this.config.columns.length+P)>=this.config.columns.length)continue;{let U=ie(fe,he,te);b&&U!==null&&U!==void 0&&(se==="datetime"||se==="date")&&(U=new Date(U),U=U.toLocaleString([],Z.format)),a.setColumnValue(oe,ae,le,U)}}}if(N){let te=fe.get_pkeys(he,0);a.initColumnValue(oe,ae,"__INDEX__");for(let le=0;le<te.size();le++){let se=te.get(le),Z=s.scalar_to_val(se,!1,!1);se.delete(),a.addColumnValue(oe,ae,"__INDEX__",Z)}te.delete()}if(S&&M===0){let te=fe.get_pkeys(he,0);for(let le=0;le<te.size();le++){let se=te.get(le),Z=s.scalar_to_val(se,!1,!1);se.delete(),a.addColumnValue(oe,ae,"__ID__",Z)}te.delete()}Re&&Re.delete(),a.addRow(oe,ae)}return fe.delete(),a.formatData(oe,o.config)},Ue=function(o,a,_){let v=this.num_rows(),m=a.start_row||0,O=a.end_row||v,b=this._column_names().indexOf(o);if(b===-1)return;this.sides()>0&&b++;let S,z;a.data_slice?S=a.data_slice.get_column_slice(b):(z=this.get_data_slice(m,O,b,b+1),S=z.get_slice());let M=this._View.get_column_dtype(b),q=_(S,M,b);return S.delete(),z&&z.delete(),q};j.prototype.to_columns=function(o){return Me.call(this,o,fr.jsonTableFormatter)},j.prototype.to_json=function(o){return Me.call(this,o,fr.jsonFormatter)},j.prototype.to_csv=function(o){k(this.table.get_id()),o=Xe.bind(this)(o);let a=o.start_row,_=o.end_row,v=o.start_col,m=o.end_col,O=this.sides();if(this.is_unit_context)return s.to_csv_unit(this._View,a,_,v,m);if(O===0)return s.to_csv_zero(this._View,a,_,v,m);if(O===1)return s.to_csv_one(this._View,a,_,v,m);if(O===2)return s.to_csv_two(this._View,a,_,v,m)},j.prototype.col_to_js_typed_array=function(o,a={}){k(this.table.get_id());let _=s.col_to_js_typed_array;return Ue.call(this,o,a,_)},j.prototype.to_arrow=function(o={}){k(this.table.get_id()),o=Xe.bind(this)(o);let a=o.start_row,_=o.end_row,v=o.start_col,m=o.end_col,O=this.sides();if(this.is_unit_context)return s.to_arrow_unit(this._View,a,_,v,m);if(O===0)return s.to_arrow_zero(this._View,a,_,v,m);if(O===1)return s.to_arrow_one(this._View,a,_,v,m);if(O===2)return s.to_arrow_two(this._View,a,_,v,m)},j.prototype.num_rows=function(){return k(this.table.get_id()),this._View.num_rows()},j.prototype.num_columns=function(){let o=this._View.num_columns(),a=this._num_hidden();return o-o/(this.config.columns.length+a)*a},j.prototype.get_row_expanded=function(o){return this._View.get_row_expanded(o)},j.prototype.expand=function(o){return this._View.expand(o,this.config.group_by.length)},j.prototype.collapse=function(o){return this._View.collapse(o)},j.prototype.set_depth=function(o){return this._View.set_depth(o,this.config.group_by.length)},j.prototype._get_step_delta=async function(){let o=this._View.get_step_delta(0,2147483647),a;if(o.cells.size()===0)a=this.to_json();else{let _={};for(let m=0;m<o.cells.size();m++)_[o.cells.get(m).row]=!0;_=Object.keys(_);let v=_.map(m=>this.to_json({start_row:Number.parseInt(m),end_row:Number.parseInt(m)+1}));a=[].concat.apply([],v)}return o.cells.delete(),a},j.prototype._get_row_delta=async function(){if(this.is_unit_context)return s.get_row_delta_unit(this._View);{let o=this.sides(),a=y[o];return s[`get_row_delta_${a}`](this._View)}},j.prototype.on_update=function(o,{mode:a="none"}={}){if(k(this.table.get_id()),["none","row"].indexOf(a)===-1)throw new Error(`Invalid update mode "${a}" - valid modes are "none" and "row".`);a==="row"&&(this._View._get_deltas_enabled()||this._View._set_deltas_enabled(!0)),this.update_callbacks.push({view:this,orig_callback:o,callback:async(_,v)=>{v[_]===void 0&&(v[_]={});let m={port_id:_};a==="row"&&(v[_].row_delta===void 0&&(v[_].row_delta=await this._get_row_delta()),m.delta=v[_].row_delta),o(m)}})};function Pe(o,a){let _=0,v=0;for(;_<o.length;){let m=o[_];a(m,_,o)&&(o[v++]=m),_++}return o.length=v,o}j.prototype.remove_update=function(o){k(this.table.get_id());let a=this.update_callbacks.length;Pe(this.update_callbacks,_=>_.orig_callback!==o),console.assert(a>this.update_callbacks.length,'"callback" does not match a registered updater')},j.prototype.on_delete=function(o){this._delete_callbacks.push(o)},j.prototype.remove_delete=function(o){let a=this._delete_callbacks.length;Pe(this._delete_callbacks,_=>_!==o),console.assert(a>this._delete_callbacks.length,'"callback" does not match a registered delete callbacks')};function be(o){this.group_by=o.group_by||[],this.split_by=o.split_by||[],this.aggregates=o.aggregates||{},this.columns=o.columns,this.filter=o.filter||[],this.sort=o.sort||[],this.expressions=o.expressions||[],this.filter_op=o.filter_op||"and",this.group_by_depth=o.group_by_depth,this.split_by_depth=o.split_by_depth}be.prototype.get_group_by=function(){let o=s.make_string_vector();return qe(o,this.group_by)},be.prototype.get_split_by=function(){let o=s.make_string_vector();return qe(o,this.split_by)},be.prototype.get_columns=function(){let o=s.make_string_vector();return qe(o,this.columns)},be.prototype.get_filter=function(){let o=s.make_2d_val_vector();for(let a of this.filter){let _=s.make_val_vector(),v=qe(_,a);o.push_back(v)}return o},be.prototype.get_sort=function(){let o=s.make_2d_string_vector();for(let a of this.sort){let _=s.make_string_vector(),v=qe(_,a);o.push_back(v)}return o},be.prototype.get_expressions=function(){let o=s.make_2d_val_vector();for(let a of this.expressions){let _=s.make_val_vector();for(let v of a)_.push_back(v);o.push_back(_)}return o};function G(o,a,_,v){this._Table=o;let m=this._Table.get_gnode();this.gnode_id=m.get_id(),m.delete();let O=this._Table.get_pool();O.set_update_delegate(this),O.delete(),this.name=Math.random()+"",this.initialized=!1,this.index=a,this.limit=_,this.update_callbacks=[],this._delete_callbacks=[],this.views=[],this.overridden_types=v,lr(this)}G.prototype.get_id=function(){return this._Table.get_id()},G.prototype.get_pool=function(){return this._Table.get_pool()},G.prototype.make_port=function(){return this._Table.make_port()},G.prototype.remove_port=function(){this._Table.remove_port()},G.prototype._update_callback=function(o){let a={};for(let _ in this.update_callbacks)this.update_callbacks[_].callback(o,a)},G.prototype.get_index=function(){return this.index},G.prototype.get_limit=function(){return this.limit},G.prototype.clear=function(){L(this.get_id()),this._Table.reset_gnode(this.gnode_id)},G.prototype.replace=function(o){L(this.get_id()),this._Table.reset_gnode(this.gnode_id),this.update(o),k(this.get_id())},G.prototype.delete=function(){if(this.views.length>0)throw`Cannot delete Table as it still has ${this.views.length} registered View(s).`;L(this.get_id()),this._Table.unregister_gnode(this.gnode_id),this._Table.delete();for(let o of this._delete_callbacks)o()},G.prototype.on_delete=function(o){this._delete_callbacks.push(o)},G.prototype.remove_delete=function(o){let a=this._delete_callbacks.length;Pe(this._delete_callbacks,_=>_!==o),console.assert(a>this._delete_callbacks.length,'"callback" does not match a registered delete callbacks')},G.prototype.size=function(){return k(this._Table.get_id()),this._Table.size()},G.prototype.schema=function(o=!0){let a=this._Table.get_schema(),_=a.columns(),v=a.types(),m={};for(let O=0;O<_.size();O++){let P=_.get(O);P!=="psp_okey"&&(o&&this.overridden_types[P]?m[P]=this.overridden_types[P]:m[P]=xt(v.get(O).value))}return a.delete(),_.delete(),v.delete(),m};function He(o){let a=[],_={};for(let v of o){if(v.includes('""')){console.error(`Skipping expression '${v}', as it cannot reference an empty column!`);continue}let m={},O={},P=0,b,N=v.match(/^\/\/(?<alias>.+?)\n/);N?.groups?.alias&&(b=N.groups.alias.trim()),(!b||b.length==0)&&(b=v);let S=v.replace(/([a-zA-Z_]+[a-zA-Z0-9_]*)/g,q=>q=="true"?"True":q=="false"?"False":q);S=S.replace(/\"(.*?[^\\])\"/g,(q,ce)=>{if(ce=ce.replace(/\\"/g,'"'),m[ce]===void 0){let ie=`COLUMN${P}`;m[ce]=ie,O[ie]=ce}return P++,m[ce]}),S=S.replace(/'(.*?[^\\])'/g,q=>`intern(${q})`);let z=(q,ce,ie,fe)=>{let We=q.indexOf(ie);return`${q.substring(0,We)}'${fe}'${q.substring(We+ie.length)}`};S=S.replace(/(bucket|match|match_all|search|indexof)\(.*?,\s*(intern\(\'(.+)\'\)).*\)/g,z),S=S.replace(/(replace_all|replace)\(.*?,\s*(intern\(\'(.*)\'\)),.*\)/g,z);let M=[b,v,S,O];if(_[b]!==void 0){let q=_[b];a[q]=M}else a.push(M),_[b]=a.length-1}return a}G.prototype.validate_expressions=function(o,a=!0){let _={expression_schema:{},expression_alias:{},errors:{}};if(!o||o.length===0)return _;o=He(o);let v=s.make_2d_val_vector();for(let S of o){let z=s.make_val_vector();for(let M of S)z.push_back(M);v.push_back(z),_.expression_alias[S[0]]=S[1]}let m=s.validate_expressions(this._Table,v),O=m.get_expression_schema(),P=m.get_expression_errors(),b=O.keys();for(let S=0;S<b.size();S++){let z=b.get(S),M=O.get(z);a&&this.overridden_types[z]&&(M=this.overridden_types[z]),_.expression_schema[z]=M}let N=P.keys();for(let S=0;S<N.size();S++){let z=N.get(S),M=P.get(z);_.errors[z]=M}return N.delete(),b.delete(),P.delete(),O.delete(),m.delete(),_},G.prototype.is_valid_filter=function(o){if(o[1]===Ce.FILTER_OPERATORS.isNull||o[1]===Ce.FILTER_OPERATORS.isNotNull)return!0;let a=o[2];if(a===null)return!1;let _=this.schema();return _[o[0]]&&(_[o[0]]==="date"||_[o[0]]==="datetime")?s.is_valid_datetime(o[2]):typeof a<"u"&&a!==null},G.prototype.view=function(o={}){k(this._Table.get_id());let a={};for(let b of Object.keys(o))if(Be[b])if(!a[Be[b]])jt.has(b)||(console.warn(`Deprecated: "${b}" config parameter, please use "${Be[b]}" instead`),jt.add(b)),a[Be[b]]=o[b];else throw new Error(`Duplicate configuration parameter "${b}"`);else if(b==="aggregate"){jt.has("aggregate")||(console.warn('Deprecated: "aggregate" config parameter has been replaced by "aggregates" and "columns"'),jt.add("aggregate")),a.aggregates={},a.columns=[];for(let N of o.aggregate)a.aggregates[N.column]=N.op,a.columns.push(N.column)}else if(sr.indexOf(b)>-1)a[b]=o[b];else throw new Error(`Unrecognized config parameter "${b}"`);a.group_by=a.group_by||[],a.split_by=a.split_by||[],a.aggregates=a.aggregates||{},a.filter=a.filter||[],a.sort=a.sort||[],a.expressions=a.expressions||[];let _=this.schema();if(a.expressions.length>0&&(a.expressions=He(a.expressions)),a.columns===void 0&&(a.columns=this.columns(),a.expressions.length>0))for(let b of a.expressions)a.columns.push(b[0]);if(a.filter.length>0)for(let b of a.filter){let N=_[b[0]];b[1]!==Ce.FILTER_OPERATORS.isNull&&b[1]!==Ce.FILTER_OPERATORS.isNotNull&&(N==="date"||N==="datetime")&&(b[2]=new Date(b[2]))}let v=Math.random()+"",m;a.group_by.length>0||a.split_by.length>0?a.split_by&&a.split_by.length>0?m=2:m=1:m=0;let O=new be(a),P=new j(this,m,a,O,v);return this.views.push(P),P};let Te;function Ze(){if(Te===void 0){let o=0,a=performance.now();setTimeout(function _(){let v=performance.now();console.log(`${(1e3*o/(v-a)).toFixed(2)} msgs/sec`),o=0,a=v,setTimeout(_,5e3)},5e3),Te=function(v){o+=v},console.log("Profiling initialized")}}G.prototype.update=function(o,a){a=a||{},a.port_id=a.port_id||0;let _,v=this.columns(),m=this._Table.get_schema(),O=m.types(),P=!1,b=!1;if(_=i,o instanceof ArrayBuffer?(_=new Uint8Array(o),P=!0):typeof o=="string"?(o[0]===","&&(o="_"+o),b=!0,P=!0,_=o):(i.init(o),i.names=v.concat(i.names.filter(N=>N==="__INDEX__")),i.types=ur(O).slice(0,v.length),Te&&Te(i.row_count)),!P){if(_.row_count===0){console.warn("table.update called with no data - ignoring");return}i.names.indexOf("__INDEX__")!=-1&&(!!this.index?i.types.push(i.types[i.names.indexOf(this.index)]):i.types.push(s.t_dtype.DTYPE_INT32))}try{let N=s.t_op.OP_INSERT;pe(_,this._Table,this.index,this.limit,N,!0,P,b,a.port_id).delete(),this.initialized=!0}catch(N){console.error(`Update failed: ${N}`)}finally{m.delete()}},G.prototype.remove=function(o,a){if(!this.index){console.error("Cannot call `remove()` on a Table without a user-specified index.");return}a=a||{},a.port_id=a.port_id||0;let _,v=this.columns(),m=this._Table.get_schema(),O=m.types(),P=!1;o=o.map(b=>({[this.index]:b})),o instanceof ArrayBuffer?(_=new Uint8Array(o),P=!0):(i.init(o),i.names=[this.index],i.types=[ur(O)[v.indexOf(this.index)]],_=i);try{let b=s.t_op.OP_DELETE;pe(_,this._Table,this.index,this.limit,b,!1,P,!1,a.port_id).delete(),this.initialized=!0}catch(b){console.error("Remove failed",b)}finally{m.delete()}},G.prototype.columns=function(){let o=this._Table.get_schema(),a=o.columns(),_=[];for(let v=0;v<a.size();v++){let m=a.get(v);m!=="psp_okey"&&_.push(m)}return o.delete(),a.delete(),_},G.prototype.execute=function(o){o(this)};let Ce={__module__:s,Server:pt,worker:function(){return this},initialize_profile_thread:Ze,memory_usage:J,table:function(o,a){a=a||{},a.index=a.index||null,a.limit=a.limit||null;let _,v=!1,m={},O=!1;if(o instanceof ArrayBuffer||typeof Buffer<"u"&&o instanceof Buffer?(_=new Uint8Array(o),v=!0):typeof o=="string"?(o[0]===","&&(o="_"+o),O=!0,v=!0,_=o):(i.clean(),m=i.init(o),_=i),a.index&&a.limit)throw`Cannot specify both index '${a.index}' and limit '${a.limit}'.`;let P;try{let b=s.t_op.OP_INSERT;return P=pe(_,void 0,a.index,a.limit,b,!1,v,O,0),new G(P,a.index,a.limit,m)}catch(b){throw P&&P.delete(),console.error(`Table initialization failed: ${b}`),b}}};for(let o of Object.keys(Pt))Ce[o]=Pt[o];class Ee extends pt{constructor(a){super(a),self.addEventListener("message",_=>this.process(_.data),!1)}post(a,_){self.postMessage(a,_)}init(a){if(typeof WebAssembly>"u")throw new Error("WebAssembly not supported");s({wasmBinary:a.buffer,wasmJSMethod:"native-wasm"}).then(_=>{s=_,s.init(),ro(),super.init(a)})}}return typeof self<"u"&&self.addEventListener&&new Ee(Ce),Ce}function ro(){if(typeof self<"u")try{if(self.dispatchEvent&&!self._perspective_initialized&&self.document!==null){self._perspective_initialized=!0;let h=self.document.createEvent("Event");h.initEvent("perspective-ready",!1,!0),self.dispatchEvent(h)}else!self.document&&self.postMessage&&self.postMessage({})}catch{}}var jo=globalThis.perspective=Qr(Br);})();
