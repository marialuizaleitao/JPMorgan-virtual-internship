var Ao=Object.defineProperty;var et=(e,t)=>{for(var r in t)Ao(e,r,{get:t[r],enumerable:!0})};Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(t!==null&&t.nodeType===1);return null});import*as Jr from"d3fc";import*as ce from"d3fc";var A={none:"none",ordinal:"ordinal",time:"time",linear:"linear"},Ne=e=>{let t="crossValues",r=null,o=null,n=()=>{let a=l=>{let s=r?e[t].filter(u=>r==u.name):e[t];return t=="crossValues"&&s.length>1?!1:s.some(u=>l.includes(u.type))};return e[t].length===0?A.none:o!=A.time&&a(["datetime","date"])?A.time:o!=A.linear&&a(["integer","float"])||o==A.ordinal?A.linear:A.ordinal};return n.settingName=(...a)=>a.length?(t=a[0],n):t,n.settingValue=(...a)=>a.length?(r=a[0],n):r,n.excludeType=(...a)=>a.length?(o=a[0],n):o,n};var Ft={};et(Ft,{domain:()=>Eo,labelFunction:()=>Pt,scale:()=>zo});import*as fr from"d3";var pr=e=>{let t=r=>(o,n)=>o===void 0?n:n===void 0?o:r(o,n);return e.reduce((r,o)=>[t(Math.min)(r[0],o[0]),t(Math.max)(r[1],o[1])],[void 0,void 0])},ae=e=>Array.isArray(e)?e.flat(1/0):[e];import{rebindAll as To}from"d3fc";var ko=1,tt=e=>{let t=r=>e(r);return To(t,e),t.bandwidth=(...r)=>r.length?(e.bandwidth(...r),t):Math.max(e.bandwidth(),ko),t};import{rebindAll as Lo}from"d3fc";var dr=e=>{let t=r=>e(r);return Lo(t,e),t.ticks=function(){return[]},t};var zo=()=>dr(tt(fr.scaleBand())),Eo=()=>{let e=["crossValue"],t="horizontal",r=n=>{let a=ae(n);return o([...new Set(a.map(l=>l[e[0]]))])},o=n=>t=="vertical"?n.reverse():n;return r.valueName=(...n)=>n.length?(e=[n[0]],r):e[0],r.valueNames=(...n)=>n.length?(e=n[0],r):e,r.orient=(...n)=>n.length?(t=n[0],r):t,r},Pt=e=>t=>t[e].join("|");var It={};et(It,{component:()=>Mo,domain:()=>Bt,labelFunction:()=>$t,scale:()=>Oo,tickFormatFunction:()=>Do});import*as je from"d3";import*as K from"d3fc";import*as le from"d3-array";var rt=()=>{let e=[0,0],t="percent",r=o=>{switch(t){case"domain":{o[0]-=e[0],o[1]+=e[1];break}case"percent":{let n=o[1]-o[0];o[0]-=e[0]*n,o[1]+=e[1]*n;break}default:throw new Error("Unknown padUnit: "+t)}return o};return r.pad=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],r):e},r.padUnit=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],r):t},r};var hr=function(){let e=[function(a){return a}],t=null,r=[],o=rt(),n=function(l){let s=new Array(l.length),u=!0,i=!1,m,f=e[Symbol.iterator]();try{for(let p;!(u=(p=f.next()).done);u=!0){let d=p.value;for(let h=0;h<l.length;h++){let g=d(l[h],h);Array.isArray(g)?s.push.apply(s,Rt(g)):s.push(g)}}}catch(p){i=!0,m=p}finally{try{!u&&f.return&&f.return()}finally{if(i)throw m}}let c=[le.min(s),le.max(s)];if(c[0]=c[0]==null?le.min(r):le.min([c[0]].concat(Rt(r))),c[1]=c[1]==null?le.max(r):le.max([c[1]].concat(Rt(r))),t!=null){let p=Math.max(Math.abs(c[1]-t),Math.abs(c[0]-t));c[0]=t-p,c[1]=t+p}return o(c)};return n.accessors=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],n):e},n.pad=function(){return arguments.length?(o.pad(arguments.length<=0?void 0:arguments[0]),n):o.pad},n.padUnit=function(){return arguments.length?(o.padUnit(arguments.length<=0?void 0:arguments[0]),n):o.padUnit},n.include=function(){return arguments.length?(r=arguments.length<=0?void 0:arguments[0],n):r},n.symmetricalAbout=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],n):t},n.paddingStrategy=function(){return arguments.length?(o=arguments.length<=0?void 0:arguments[0],n):o},n},Rt=function(e){if(Array.isArray(e)){let t=Array(e.length);for(let r=0;r<e.length;r++)t[r]=e[r];return t}else return Array.from(e)};import*as nt from"d3";var No=1e7,ot=e=>Math.abs(e)>=No?nt.format(".3s")(e):Number.isInteger(e)?nt.format(",.0f")(e):nt.format(",.2f")(e);function Oe(e){return e.getRootNode().host}function ie(e){return e.closest("#container.chart")}var Oo=()=>je.scaleLinear(),Bt=()=>{let e=hr().pad([0,.1]).padUnit("percent"),t=["crossValue"],r=a=>(e.accessors(t.map(l=>s=>parseFloat(s[l]))),n(ae(a)));K.rebindAll(r,e);let o=a=>{let l=t.map(s=>a.map(u=>u[s]).sort((u,i)=>u-i).filter((u,i,m)=>i===0||u!==m[i-1]).reduce((u,i,m,f)=>m===0||u<=i-f[m-1]?u:Math.abs(i-f[m-1])));return Math.min(...l)},n=a=>{if(e.padUnit()=="domain"){let l=o(a);return e.pad([l/2,l/2])(a)}else return e(a)};return r.valueName=(...a)=>a.length?(t=[a[0]],r):t[0],r.valueNames=(...a)=>a.length?(t=a[0],r):t,r},$t=e=>t=>t[e][0],Do=ot,Mo=e=>{let t=null,r="horizontal",o=null,n=(i,m)=>{try{return ie(i.node()).querySelector(".cartesian-chart").querySelector(`.${m}-axis`)}catch{return null}},a=i=>{let m=je.select(i).select("text").node();m.style.fontSize="80%"},l=(i,m)=>{let f=i.getBoundingClientRect();m.each((c,p,d)=>{let h=je.select(d[p]).node().getBoundingClientRect();(r=="vertical"&&f.width<h.width||r=="horizontal"&&f.height<h.height)&&a(d[p])})},s=(i,m,f)=>{let c=n(i,m);c&&l(c,i)},u=()=>({bottom:K.axisBottom,left:K.axisLeft,top:K.axisTop,right:K.axisRight,decorate:s});return u.domain=(...i)=>i.length?(t=i[0],u):t,u.orient=(...i)=>i.length?(r=i[0],u):r,u.settingName=(...i)=>i.length?(o=i[0],u):o,u};var Gt={};et(Gt,{domain:()=>Fo,labelFunction:()=>Ht,scale:()=>Po});import*as gr from"d3";import*as De from"d3fc";var Po=()=>gr.scaleTime(),Fo=()=>{let e=De.extentTime(),t=["crossValue"],r=a=>(e.accessors(t.map(l=>s=>new Date(s[l]))),n(ae(a)));De.rebindAll(r,e,De.exclude("include","paddingStrategy"));let o=a=>{let l=t.map(s=>a.map(u=>new Date(u[s]).getTime()).sort((u,i)=>u-i).filter((u,i,m)=>i===0||u!==m[i-1]).reduce((u,i,m,f)=>m===0||Math.abs(u)<=Math.abs(i-f[m-1])?Math.abs(u):Math.abs(i-f[m-1])));return Math.min(...l)},n=a=>{let l=Math.abs(o(a));return e.padUnit("domain").pad([l/2,l/2])(a)};return r.valueName=(...a)=>a.length?(t=[a[0]],r):t[0],r.valueNames=(...a)=>a.length?(t=a[0],r):t,r},Ht=e=>t=>new Date(t[e][0]);var Wt={};et(Wt,{component:()=>Yo,domain:()=>Wo,labelFunction:()=>jt,scale:()=>jo});import*as We from"d3";import*as se from"d3fc";import{select as xr,line as Ro}from"d3";import{axisOrdinalTop as Bo,axisOrdinalBottom as $o,axisOrdinalLeft as Io,axisOrdinalRight as Ho,dataJoin as br,rebindAll as vr,exclude as Go}from"d3fc";var yr=(...e)=>{let t={},r=o=>{for(let n of Object.keys(t))o[n](t[n]);return o};for(let o of e)r[o]=(...n)=>n.length?(t[o]=n[0],r):t[o];return r};var at=(e,t,r)=>{let o=6,n=6,a=yr("tickFormat","ticks","tickArguments","tickValues","tickPadding"),l=()=>{},s=null,u=br("g","group"),i=br("path","domain"),m=(h,g)=>c()?`translate(${g}, ${h})`:`translate(${h}, ${g})`,f=h=>c()?h.map(g=>[g[1],g[0]]):h,c=()=>e==="left"||e==="right",p=h=>{if(!s){a(t(r).decorate(l))(h);return}h.each((g,y,x)=>{let v=x[y],b=xr(v),_=e==="bottom"||e==="right"?1:-1,S=r.range(),k=f([[S[0],_*o],[S[0],0],[S[1],0],[S[1],_*o]]);i(b,[g]).attr("d",Ro()(k)).attr("stroke","#000").attr("fill","none");let H=u(b,s),E=V=>Array.isArray(n)?n[V]:n,z=V=>{let C=0;for(let N=0;N<V;N++)C+=E(N);return C};H.attr("transform",(V,C)=>m(0,_*z(C))).each((V,C,N)=>{let U=xr(N[C]),Q=d(r,V);a(t(Q)).decorate((ee,oe)=>l(ee,oe,C)).tickSizeInner(E(C)).tickOffset(ee=>Q.step(ee)/2)(U),U.select("path.domain").attr("visibility","hidden")}),H.exit().attr("transform",(V,C)=>m(0,_*z(C)))})},d=(h,g)=>{function y(x){let v=x.domain;return v.reduce((b,_)=>b+h(_),0)/v.length}return y.ticks=()=>g,y.tickFormat=()=>x=>x.text,y.copy=()=>d(h,g),y.step=x=>x.domain.length*h.step(),vr(y,h,Go("ticks","step","copy")),y};return p.tickSize=(...h)=>h.length?(n=o=Number(h[0]),p):n,p.tickSizeInner=(...h)=>h.length?(n=Array.isArray(h[0])?h[0]:Number(h[0]),p):n,p.tickSizeOuter=(...h)=>h.length?(o=Number(h[0]),p):o,p.decorate=(...h)=>h.length?(l=h[0],p):l,p.groups=(...h)=>h.length?(s=h[0],p):s,vr(p,a),p},wr=e=>at("top",Bo,e),_r=e=>at("bottom",$o,e),Sr=e=>at("left",Io,e),Vr=e=>at("right",Ho,e);var jo=()=>tt(We.scaleBand()).padding(.5),Wo=()=>{let e=["crossValue"],t="horizontal",r=n=>{let a=ae(n);return o([...Array.from(new Set(a.map(l=>l[e[0]])))])},o=n=>t=="vertical"?n.reverse():n;return r.valueName=(...n)=>n.length?(e=[n[0]],r):e[0],r.valueNames=(...n)=>n.length?(e=n[0],r):e,r.orient=(...n)=>n.length?(t=n[0],r):t,r},jt=e=>t=>t[e].join("|"),Yo=e=>{let t="horizontal",r="crossValues",o=null,n=()=>{let c=e[r].length>1,p=l(o),d=p.map(s),h=c?d.map(b=>b.size):d[0].size,g=d.reduce((b,_)=>b+_.size,0),y=b=>_=>{let S=b(_);return c&&S.groups(p).tickSizeInner(h).tickSizeOuter(g),t!=="horizontal"&&S.tickPadding(10),S},x=(b,_,S)=>{let k=d[S].rotation;t==="horizontal"&&f(b,k),u(b,k)},v=a(c);return{bottom:y(v.bottom),left:y(v.left),right:y(v.right),top:y(v.top),size:`${g+10}px`,decorate:x}},a=c=>c?{bottom:_r,left:Sr,top:wr,right:Vr}:{bottom:se.axisOrdinalBottom,left:se.axisOrdinalLeft,top:se.axisOrdinalTop,right:se.axisOrdinalRight},l=c=>{let p=[];return c.forEach(d=>{(d&&d.split?d.split("|"):[d]).forEach((g,y)=>{for(;p.length<=y;)p.push([]);let x=p[y];x.length>0&&x[x.length-1].text===g?x[x.length-1].domain.push(d):x.push({text:g,domain:[d]})})}),p.reverse()},s=c=>{let p=e.size.width,d=Math.max(...c.map(h=>h.text?h.text.length:0));return t==="horizontal"?c&&c.length*16>p-100?{size:d*5+10,rotation:90}:c&&c.length*(d*6+10)>p-100?{size:d*3+20,rotation:45}:{size:25,rotation:0}:{size:d*5+10,rotation:0}},u=(c,p)=>{let d=_=>{let S=_.indexOf(",")!==-1?",":" ",k=_.substring(_.indexOf("(")+1,_.indexOf(")")).split(S).map(B=>parseInt(B));for(;k.length<2;)k.push(0);return k},y=p?(_,S)=>_.x+_.width+14>S.x+S.width:(_,S)=>_.x<=S.x+S.width&&S.x<=_.x+_.width&&_.y<=S.y+S.height&&S.y<=_.y+_.height,x=(_,S)=>_.x>=S.x&&_.x+_.width<=S.x+S.width&&_.y>=S.y&&_.y+_.height<=S.y+S.height,v=t=="horizontal"?i(c):null,b=[];c.each((_,S,k)=>{let B=We.select(k[S]),H=d(B.attr("transform")),E=B.node().getBBox(),z={x:E.x+H[0],y:E.y+H[1],width:E.width,height:E.height},C=b.some(N=>y(N,z))||v&&!x(z,v);B.attr("visibility",C?"hidden":""),C||b.push(z)})},i=c=>{let p=ie(c.node());if(p===null)return;let d=p.querySelector(".cartesian-chart"),h=d.querySelector(".x-axis"),g=d.getBoundingClientRect(),y=h.getBoundingClientRect();return{x:g.left-y.left,width:g.width,y:g.top-y.top,height:g.height}},m=c=>c?c<60?`rotate(-${c} 5 5)`:`rotate(-${c} 3 7)`:"translate(0, 8)",f=(c,p)=>{let d=m(p),h=p?"end":"";c.each((g,y,x)=>{We.select(x[y]).select("text").attr("transform",d).style("text-anchor",h)})};return n.orient=(...c)=>c.length?(t=c[0],n):t,n.settingName=(...c)=>c.length?(r=c[0],n):r,n.domain=(...c)=>c.length?(o=c[0],n):o,n};var Uo={none:Ft,ordinal:Wt,time:Gt,linear:It},T=e=>{let t=null,r="horizontal",o="crossValues",n=null,a=["crossValue"],l=null,s=["include","paddingStrategy","pad"],u={},i=c=>{let p=Ne(e).excludeType(t).settingName(o).settingValue(n)(),d=Uo[p],h=d.domain().valueNames(a);s.forEach(x=>{u[x]&&h[x]&&h[x](u[x])}),h.orient&&h.orient(r);let g=h(c);l!==null&&(g=l(g));let y=d.component?m(d,g,c):f();return{scale:d.scale(),domain:g,domainFunction:h,labelFunction:d.labelFunction,component:{bottom:y.bottom,left:y.left,top:y.top,right:y.right},size:y.size,decorate:y.decorate,label:e[o].map(x=>x.name).join(", "),tickFormatFunction:d.tickFormatFunction}},m=(c,p,d)=>c.component(e).orient(r).settingName(o).domain(p)(d),f=()=>({bottom:ce.axisBottom,left:ce.axisLeft,top:ce.axisTop,right:ce.axisRight,decorate:()=>{}});return i.excludeType=(...c)=>c.length?(t=c[0],i):t,i.orient=(...c)=>c.length?(r=c[0],i):r,i.settingName=(...c)=>c.length?(o=c[0],i):o,i.settingValue=(...c)=>c.length?(n=c[0],i):n,i.valueName=(...c)=>c.length?(a=[c[0]],i):a[0],i.valueNames=(...c)=>c.length?(a=c[0],i):a,i.modifyDomain=(...c)=>c.length?(l=c[0],i):l,s.forEach(c=>{i[c]=(...p)=>p.length?(u[c]=p[0],i):u[c]}),i};import*as ue from"d3";import*as Se from"d3fc";var j=(e,t)=>Cr(e,t,(r,o)=>r.svgPlotArea(o),!1),Me=(e,t)=>Cr(e,t,(r,o)=>r.canvasPlotArea(o).svgPlotArea(Se.seriesSvgPoint()),!0),Cr=(e,t,r,o)=>{let n=null,a=null,l=Se.chartCartesian({xScale:e.scale,yScale:t.scale,xAxis:e.component,yAxis:t.component}).xDomain(e.domain).xLabel(e.label).xAxisHeight(e.size).xDecorate(e.decorate).xTickFormat(e.tickFormatFunction).yDomain(t.domain).yLabel(t.label).yAxisWidth(t.size).yDecorate(t.decorate).yOrient("left").yTickFormat(t.tickFormatFunction);e.decorate&&l.xDecorate(e.decorate),t.decorate&&l.yDecorate(t.decorate),l.xPaddingInner&&l.xPaddingInner(1),l.xPaddingOuter&&l.xPaddingOuter(.5),l.yPaddingInner&&l.yPaddingInner(1),l.yPaddingOuter&&l.yPaddingOuter(.5),l.axisSplitter=(...u)=>u.length?(n=u[0],l):n,l.altAxis=(...u)=>u.length?(a=u[0],l):a,l.plotArea=function(...u){return u.length==0?o?this.canvasPlotArea():this.svgPlotArea():r(this,...u)};let s=l.decorate();return l.decorate((u,i)=>{let m=u.select("d3fc-svg.plot-area"),f=m.select("svg").node();f.setAttribute("viewBox",`0 0 ${m.node().clientWidth} ${m.node().clientHeight}`),f.setAttribute("preserveAspectRatio","none");for(let c of["x-axis","y-axis"])u.select(`d3fc-svg.${c} svg`).node().setAttribute("preserveAspectRatio","none");if(s(u,i),o){let c=u.select(".svg-plot-area").node(),p=u.select(".canvas-plot-area").node();ue.selectAll([c,p]).order()}if(!!n){if(n.haveSplit()){let c=n.altData(),p=Se.dataJoin("d3fc-svg","y2-axis").key(y=>y),d=Se.dataJoin("g","y-series").key(y=>y);u.append("div").attr("class","y-label right-label").style("grid-column",5).style("-ms-grid-column",5).style("grid-row",3).style("-ms-grid-row",3).style("width",a.size||"1em").style("display","flex").style("align-items","center").style("justify-content","center").append("span").attr("class","y-label splitter-label").style("transform","rotate(-90deg)");let h=a.scale.domain(a.domain),g=a.component.right(h);if(g.tickFormat(a.tickFormatFunction),a.decorate&&g.decorate(a.decorate),p(u,["right"]).attr("class",y=>`y-axis ${y}-axis`).on("measure",function(y,x){let{width:v,height:b}=y.detail;x==="left"&&ue.select(y.currentTarget).select("svg").attr("viewBox",`${-v} 0 ${v} ${b}`).attr("preserveAspectRatio","none"),h.range([b,0])}).on("draw",function(y,x){ue.select(y.currentTarget).select("svg").call(g)}),o){let y=x=>{let v=l.plotArea();v.context(x.node().getContext("2d")).xScale(e.scale);let b=[t.scale,h];[i,c].forEach((_,S)=>{v.yScale(b[S]),v(_)})};u.select("d3fc-canvas.plot-area").on("draw",function(x,v){y(ue.select(x.currentTarget).select("canvas"))})}else{let y=function(x){let v=l.plotArea();v.xScale(e.scale);let b=[t.scale,h];d(x,[i,c]).each((_,S,k)=>{v.yScale(b[S]),ue.select(k[S]).datum(_).call(v)})};u.select("d3fc-svg.plot-area").on("draw",function(x,v){y(ue.select(x.currentTarget).select("svg"))})}}n(u)}}),l};import*as re from"d3fc";import{select as Xt}from"d3";function O(e,t,r){let o=e.select(t);return o.size()>0?o:r()}function X(e,t,r="right"){if(r==="right"||r==="bottom")return e[r]<t[r];if(r==="left"||r==="top")return e[r]>t[r];throw`Direction being checked for overflow is invalid: ${r}`}function Yt(e,t,r,o=0){let n=e==="x"?"width":"height",a=t[e],l=t[e]+t[n],s=r[e],u=r[e]+r[n],i=s+o>a&&s-o<l,m=u+o>a&&u-o<l,f=s+o<a&&u-o>l;return i||m||f}var Ar=`<ul id="tooltip-values"></ul>
`;import{select as Xo}from"d3";var Tr={types:{float:{filter_operator:"==",aggregate:"sum",format:{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}},string:{filter_operator:"==",aggregate:"count"},integer:{filter_operator:"==",aggregate:"sum",format:{}},boolean:{filter_operator:"==",aggregate:"count"},datetime:{filter_operator:"==",aggregate:"count",format:{dateStyle:"short",timeStyle:"medium"},null_value:-1},date:{filter_operator:"==",aggregate:"count",format:{dateStyle:"short"},null_value:-1}}};function Pe(e){let t={};if(kr().types[e]&&Object.assign(t,kr().types[e]),t.type){let r=Pe(t.type);return Object.assign(r,t),r}else return t}function Ut(e){return e&&typeof e=="object"&&!Array.isArray(e)}function Kt(e,...t){if(!t.length)return e;let r=t.shift();if(Ut(e)&&Ut(r))for(let o in r)Ut(r[o])?(e[o]||Object.assign(e,{[o]:{}}),Kt(e[o],r[o])):Object.assign(e,{[o]:r[o]});return Kt(e,...t)}function kr(){return globalThis.__PERSPECTIVE_CONFIG__||(globalThis.__PERSPECTIVE_CONFIG__=Kt(Tr,globalThis.__TEMPLATE_CONFIG__||{})),globalThis.__PERSPECTIVE_CONFIG__}function me(e,t){switch(e){case"date":case"datetime":return t instanceof Date?t:new Date(parseInt(t)).toLocaleString([],Pe(e).format);case"integer":return parseInt(t,10);case"float":return parseFloat(t)}return t}function lt(e,t){return t.crossValues.length===0?[]:e.crossValue.length===0?[]:((e.crossValue.split?e.crossValue.split("|"):[e.crossValue])||[e.key]).map((o,n)=>({name:t.crossValues[n].name,value:me(t.crossValues[n].type,o)}))}function it(e,t){if(t.splitValues.length===0)return[];let r=[e.mainValue];return e.key?r=e.key.split("|"):e.mainValue?.split&&(r=e.mainValue.split("|")),t.splitValues.map((o,n)=>({name:o.name,value:me(o.type,r[n])}))}function st(e,t){return t.mainValues.length>1?e.mainValue?[{name:e.key,value:e.mainValue-(e.baseValue||0)}]:t.mainValues.map((r,o)=>({name:r.name,value:me(r.type,e.mainValues[o])})):[{name:t.mainValues[0].name,value:me(t.mainValues[0].type,e.colorValue||e.mainValue-e.baseValue||e.mainValue||e.mainValues)}]}function Lr(e,t,r){let o=lt(t,r).concat(it(t,r)).concat(st(t,r));qo(e,o)}function qo(e,t){e.select("#tooltip-values").selectAll("li").data(t).join("li").each(function(r){Xo(this).text(`${r.name}: `).append("b").text(Zo(r.value))})}var Zo=e=>e==null?"-":e.toLocaleString(void 0,{style:"decimal",minimumFractionDigits:Pe("float").precision,maximumFractionDigits:Pe("float").precision});var zr=e=>[e.name,"==",e.value],Ye=(e,t,r)=>{let o=st(t,r).map(s=>s.name),n=lt(t,r).map(zr),a=it(t,r).map(zr),l=r.filter.concat(n).concat(a);e.dispatchEvent(new CustomEvent("perspective-click",{bubbles:!0,composed:!0,detail:{column_names:o,config:{filter:l},row:t.row}}))},Er=()=>{let e=null,t=r=>{let o=r.node();r.on("click",(n,a)=>Ye(o,a,e))};return t.settings=(...r)=>r.length?(e=r[0],t):e,t};var pe=()=>{let e=!1,t=null,r=null,o=!1,n=a=>{let l=a.node();if(!l||!l.isConnected){Nr(t);return}let s=Xt(ie(l));t=Jo(s);let u=function(m,f){Lr(t,f,r);let c=a.nodes(),p=c.indexOf(this);Qo(s.node(),c[p],t,o),Xt(c[p]).style("opacity","0.7")},i=function(m,f){Nr(t);let c=a.nodes(),p=c.indexOf(this);c&&Xt(c[p]).style("opacity","1")};e?a.each(function(m){return u.call(this,void 0,m)}):(a.on("mouseover",u).on("mouseout",i),Er().settings(r)(a))};return n.alwaysShow=(...a)=>a.length?(e=a[0],n):e,n.centered=(...a)=>a.length?(o=a[0],n):o,n.settings=(...a)=>a.length?(r=a[0],n):r,n};function Jo(e){return O(e,"div.tooltip",()=>e.append("div").attr("class","tooltip").style("z-index",3).style("opacity",0).html(Ar))}function Qo(e,t,r,o){let n=e.getBoundingClientRect(),a=t.getBoundingClientRect(),l=a.left+a.width/2-n.left,s=a.top-n.top+e.scrollTop;o&&(s=a.top+a.height/2-n.top+e.scrollTop),r.style("left",`${l}px`).style("top",`${s}px`).style("opacity",.9),o&&([l,s]=ea(r,n)),ta(r,n,l,s,o)}function ea(e,t){let r=e.node().getBoundingClientRect(),o=r.width/2,n=r.left-o-t.left;e.style("left",`${n}px`);let a=r.height/2,l=r.top-a-t.top;return e.style("top",`${l}px`),[n,l]}function ta(e,t,r,o,n=!1){let a=e.node().getBoundingClientRect();if(X(t,a)){let l=a.right-t.right;e.style("left",`${r-l}px`)}if(X(t,a,"bottom")){let l=a.bottom-t.bottom;e.style("top",`${o-l}px`)}if(!!n){if(X(t,a,"left")){let l=a.left-t.left;e.style("left",`${r-l}px`)}if(X(t,a,"top")){let l=a.top-t.top;e.style("top",`${o-l}px`)}}}function Nr(e){e&&e.style("opacity",0)}function ct(e,t){let r=e.mainValues.length>1?re.seriesSvgGrouped(re.seriesSvgBar()):re.seriesSvgBar();return r=r.decorate(o=>{pe().settings(e)(o),o.style("fill",n=>t(n.key))}),re.autoBandwidth(ra(r)).crossValue(o=>o.crossValue).mainValue(o=>o.mainValue?o.mainValue:0).baseValue(o=>o.baseValue)}var ra=e=>{let t=r=>e(r);return re.rebindAll(t,e),t.bandwidth=(...r)=>r.length?(e.bandwidth(Math.max(r[0],1)),t):e.bandwidth(),t};import*as ut from"d3";function de(e){return e.split("|").slice(0,-1).join("|")}function q(e){let t=e.data&&e.data.length>0?e.data[0]:{},r=Object.keys(t).filter(o=>o!=="__ROW_PATH__");return fe().settings(e).domain(r)()}function mt(e,t){let r=Array.from(new Set(t));return fe().settings(e).domain(r)()}function pt(e){let t=e.data&&e.data.length>0?e.data[0]:{},r=[];return Object.keys(t).forEach(o=>{if(o!=="__ROW_PATH__"){let n=de(o);r.includes(n)||r.push(n)}}),fe().settings(e).domain(r)()}function fe(){let e=null,t=null,r={},o=a=>Ve(a,r.colorStyles&&r.colorStyles.opacity),n=()=>{let a=r.colorStyles,l=t||[a.series];if(l||e.length>1){let s=e.length>1?a.scheme:l;return ut.scaleOrdinal(s.map(o)).domain(e)}return null};return n.domain=(...a)=>a.length?(e=a[0],n):e,n.defaultColors=(...a)=>a.length?(t=a[0],n):t,n.mapFunction=(...a)=>a.length?(o=a[0],n):o,n.settings=(...a)=>a.length?(r=a[0],n):r,n}function Z(e){return Ce(1)(e)}function Ve(e,t=.5){return Ce(t)(e)}function Ce(e){return t=>{let r=ut.color(t);return r.opacity=e,r+""}}import{rebindAll as na}from"d3fc";var oa={none:Pt,ordinal:jt,time:Ht,linear:$t},W=e=>{let t=Ne(e),r="__ROW_PATH__",o=(n,a)=>oa[t()](r)(n,a);return na(o,t),o.valueName=(...n)=>n.length?(r=n[0],o):r,o};function Ae(e,t,{stack:r=!1,excludeEmpty:o=!1}={}){let n=t||e.data;return e.splitValues.length>0?aa(e,n,{stack:r,excludeEmpty:o}):[n]}function aa(e,t,{stack:r=!1,excludeEmpty:o=!1}){let n={};return t.forEach(a=>{let l={},s={};Object.keys(a).filter(u=>u!=="__ROW_PATH__").filter(u=>!o||a[u]!=null&&a[u]!=null).forEach(u=>{let i=u.split("|"),m=i[i.length-1],f=a[u]||0,c=`${m}${f>=0?"+ve":"-ve"}`,p=i.slice(0,i.length-1).join("|"),d=s[p]=s[p]||{__ROW_PATH__:a.__ROW_PATH__},h=l[c]||0;d.__KEY__=p,r?(d[m]=h+f,d[`__BASE_VALUE__${m}`]=h,l[c]=d[m]):d[m]=f,d.row=a}),Object.keys(s).forEach(u=>{(n[u]=n[u]||[]).push(s[u])})}),Object.keys(n).map(a=>{let l=n[a];return l.key=a,l})}function Or(e,t){let r={stack:!1},o=Ae(e,t,r).map(n=>Dr(e,n,r));return e.mainValues.length>1?o.reduce((a,l)=>a.concat(l)):o}function dt(e,t){let r={stack:!0};return Ae(e,t,r).map(o=>Dr(e,o,r))}function la(e,t,{stack:r=!1}){let o=W(e);return n=>{let a=s=>r&&s[`__BASE_VALUE__${n.name}`]||0,l=t.map((s,u)=>({crossValue:o(s,u),mainValue:s[n.name]?s[n.name]:null,baseValue:a(s),key:s.__KEY__?`${s.__KEY__}|${n.name}`:n.name,row:s.row||s}));return l.key=l[0].key,l}}function Dr(e,t,{stack:r=!1}){let o=la(e,t,{stack:r});return e.mainValues.length>1?e.mainValues.map(o):o(e.mainValues[0])}import*as ft from"d3";import*as ht from"d3-svg-legend";import*as Yr from"d3-svg-legend";import{rebindAll as ya}from"d3fc";var Mr=`<span id="up-arrow">&#9650;</span>
<span id="page-text"></span>
<span id="down-arrow">&#9660;</span>
`;function Pr(e){let t=e.select("g.legendCells"),r=e.node().getBoundingClientRect();if(!X(r,t.node().getBoundingClientRect()))return;let o=e.select(".legend");t.selectAll(".label").text((n,a,l)=>{let s=l[a];if(X(r,s.getBoundingClientRect())){let u=sa(s,o,r);return`${n.substring(0,u-3)}...`}else return n})}function sa(e,t,r){let o=e.getBoundingClientRect(),n=t.node().createSVGPoint(),a=3;return n.x=r.right-o.left-a,n.y=0,e.getCharNumAtPosition(n)}import*as ke from"d3";import*as Fr from"d3";var Te=10;function he(e,t,r){let o=Fr.select(Oe(e).getContainer()).node().getBoundingClientRect(),n=e.getBoundingClientRect(),a={top:n.top+r-Te,right:n.right+t+Te,bottom:n.bottom+r+Te,left:n.left+t-Te},l={x:t,y:r};return[{edge:"right",dimension:"x"},{edge:"left",dimension:"x"},{edge:"top",dimension:"y"},{edge:"bottom",dimension:"y"}].forEach(u=>{if(X(o,a,u.edge)){let i=a[u.edge]-o[u.edge];l[u.dimension]=l[u.dimension]-i}}),l}var qt="resize.for-dragging";function Rr(){let e=!0,t=null,r=o=>{let n=o.node(),a=n.getRootNode().host.closest("perspective-viewer");n.style.cursor="move",t.legend&&(n.style.left=t.legend.left,n.style.top=t.legend.top);let l=ke.drag().on("drag",function(s){let u=he(this,s.dx,s.dy);this.style.left=`${this.offsetLeft+u.x}px`,this.style.top=`${this.offsetTop+u.y}px`;let i={left:this.style.left,top:this.style.top};t.legend={...t.legend,...i},e=ma(n)?ua(n):ca(n,e)});l.on("end",function(s){ke.select(window).on(qt,null),a?.dispatchEvent(new Event("perspective-config-update"))}),o.call(l)};return r.settings=(...o)=>o.length?(t=o[0],r):t,r}function ca(e,t){return t!==!1&&ke.select(window).on(qt,function(){let r=he(e,0,0);e.style.left=`${e.offsetLeft+r.x}px`,e.style.top=`${e.offsetTop+r.y}px`}),!1}function ua(e){return ke.select(window).on(qt,null),e.style.left="auto",!0}function ma(e){let t=e.getBoundingClientRect(),r=ke.select(ie(e)).node().getBoundingClientRect(),o=5;return t.right+Te+o>=r.right&&t.top-Te-o<=r.top}import*as Ue from"d3";var Br="horizontal-drag-handle",$r="vertical-drag-handle",pa="corner-drag-handle",Hr="dragHandles",Ir=0,ge="resize";function Gr(){let e=9,t=3,r=null,o={height:100,width:100},n={height:null,width:null},a=[],l=(m,f)=>a.filter(c=>c.event===m).forEach(c=>c.execute(f)),s=m=>{if(fa(m))return;let f={left:w=>l(ge,{horizontal:U(w),vertical:!1}),top:w=>l(ge,{horizontal:!1,vertical:_e(w)}),right:w=>l(ge,{horizontal:Q(w),vertical:!1}),bottom:w=>l(ge,{horizontal:!1,vertical:ee(w)}),topleft:w=>l(ge,{horizontal:U(w),vertical:_e(w)}),topright:w=>l(ge,{horizontal:Q(w),vertical:_e(w)}),bottomright:w=>l(ge,{horizontal:Q(w),vertical:ee(w)}),bottomleft:w=>l(ge,{horizontal:U(w),vertical:ee(w)})},c=m.node();r.legend&&(c.style.height=r.legend.height,c.style.width=r.legend.width);let p=c.getBoundingClientRect(),d=m.append("svg").attr("id",Hr).attr("width",p.width).attr("height",p.height),h=d.append("g"),g=w=>w==="left"||w==="right",y={left:0,top:e,right:p.width-e,bottom:e},x={left:e,top:0,right:e,bottom:p.height-e},v=["left","top","right","bottom"],[b,_,S,k]=v.map(w=>h.append("rect").attr("id",`drag${w}`).attr("class",g(w)?$r:Br).attr("y",x[w]).attr("x",y[w]).attr("height",g(w)?p.height-e*2:e).attr("width",g(w)?e:p.width-e*2).attr("fill",g(w)?"lightgreen":"lightblue").attr("fill-opacity",Ir).style("z-index",t).attr("cursor",g(w)?"ew-resize":"ns-resize").call(Ue.drag().on("drag",f[w]))),B=w=>`${w[0]}${w[1]}`,H={topleft:"nwse",topright:"nesw",bottomright:"nwse",bottomleft:"nesw"},E=[["top","left"],["top","right"],["bottom","right"],["bottom","left"]],[z,V,C,N]=E.map(w=>h.append("rect").attr("id",`drag${B(w)}`).attr("class",`${pa} ${w[0]} ${w[1]}`).attr("height",e).attr("width",e).attr("fill","red").attr("fill-opacity",Ir).style("z-index",t).attr("cursor",`${H[B(w)]}-resize`).call(Ue.drag().on("drag",f[B(w)])));mr("height","y",k),mr("width","x",S),ur(d);function U(w){let L=i(he(b.node(),w.x,0).x,d,"width",(G,te)=>G-te);return c.style.left=`${c.offsetLeft+L}px`,c.style.width=`${c.offsetWidth-L}px`,oe(),Ge(S,L,"width","x")}function Q(w){let L=-i(he(S.node(),w.dx,0).x,d,"width",(G,te)=>G+te);return u(L,"x",S,w)?!1:(c.style.width=`${c.offsetWidth-L}px`,oe(),Ge(S,L,"width","x"))}function _e(w){let L=i(he(_.node(),0,w.y).y,d,"height",(G,te)=>G-te);return c.style.top=`${c.offsetTop+L}px`,c.style.height=`${c.offsetHeight-L}px`,oe(),Ge(k,L,"height","y")}function ee(w){let L=-i(he(k.node(),0,w.dy).y,d,"height",(G,te)=>G+te);return u(L,"y",k,w)?!1:(c.style.height=`${c.offsetHeight-L}px`,oe(),Ge(k,L,"height","y"))}function oe(){let w={top:c.style.top,left:c.style.left,height:c.style.height,width:c.style.width};r.legend={...r.legend,...w}}function Ge(w,L,G,te){return ga(d,G,L),ha(w,te,L),da(d,L,G,G==="height"?$r:Br),ur(d),L!=0}function ur(w){z.attr("y",0,"x",0),V.attr("y",0).attr("x",w.attr("width")-e),C.attr("y",w.attr("height")-e).attr("x",w.attr("width")-e),N.attr("y",w.attr("height")-e).attr("x",0)}function mr(w,L,G){!!n[w]&&n[w]<p[w]&&(c.style[w]=`${n[w]}px`,Ge(G,p[w]-n[w],w,L))}};s.on=(m,f)=>(a.push({event:m,execute:f}),s),s.zIndex=m=>(t=m,s),s.settings=(...m)=>m.length?(r=m[0],s):r,s.minWidth=m=>(o.width=m,n.width&&(n.width=Math.max(o.width,n.width)),s),s.minHeight=m=>(o.height=m,n.height&&(n.height=Math.max(o.height,n.height)),s),s.handleWidth=m=>(e=m,s),s.maxWidth=m=>(n.width=m,o.width=Math.min(o.width,n.width),s),s.maxHeight=m=>(n.height=m,o.height=Math.min(o.height,n.height),s);function u(m,f,c,p){let d=(g,y,x,v)=>g<0&&v[y]<Number(x.attr(y)),h=(g,y,x,v)=>g>0&&v[y]>Number(x.attr(y));return d(m,f,c,p)||h(m,f,c,p)}function i(m,f,c,p){let d=p(Number(f.attr(c)),m);if(d<o[c]){let h=o[c]-d;return p(m,h)}if(!!n[c]&&d>n[c]){let h=n[c]-d;return p(m,h)}return m}return s}var da=(e,t,r,o)=>{e.selectAll(`.${o}`).each((a,l,s)=>{let u=s[l];Ue.select(u).attr(r,u.getBoundingClientRect()[r]-t)})},fa=e=>e.select(`#${Hr}`).size()>0,ha=(e,t,r)=>e.attr(t,Number(e.attr(t))-r),ga=(e,t,r)=>e.attr(t,e.node().getBoundingClientRect()[t]-r);var jr=16,Wr=20,Zt=(e,t)=>{let r=e||Yr.legendColor(),o=[],n=1,a,l=t.legend&&t.legend.pageIndex?t.legend.pageIndex:0,s=()=>{},u=Rr().settings(t),i,m=b=>{o=r.scale().domain(),i=Gr().settings(t).maxHeight(o.length*jr+Wr).on("resize",()=>f(b)),i(b),u(b),f(b)},f=b=>{g(b),c(b),p(b),Pr(b)},c=b=>{let _=x(b);_.style("display",n<=1?"none":"block"),_.select("#page-text").text(`${l+1}/${n}`),_.select("#up-arrow").attr("class",l===0?"disabled":"").on("click",()=>{l>0&&(d(l-1),f(b))}),_.select("#down-arrow").attr("class",l>=n-1?"disabled":"").on("click",()=>{l<n-1&&(d(l+1),f(b))})},p=b=>{n>1&&r.cellFilter(h()),b.select("g.legendCells").remove();let _=v(b);_.call(r);let S=b.select("g.legendCells").node().getBBox();_.attr("height",S.height+Wr),s(b)},d=b=>{l=b,t.legend={...t.legend,pageIndex:l}},h=()=>(b,_)=>_>=a*l&&_<a*l+a,g=b=>{let _=b.node().getBoundingClientRect(),S=Math.floor(_.height/jr)-1;a=S<o.length?S-1:S,n=y(S),l=Math.min(l,n-1)},y=b=>Math.ceil(o.length/b),x=b=>O(b,".legend-controls",()=>b.append("g").attr("class","legend-controls").html(Mr)),v=b=>O(b,".legend",()=>b.append("svg").attr("class","legend"));return m.decorate=(...b)=>b.length?(s=b[0],m):s,ya(m,r),m};var Ur=e=>Zt(ht.legendColor().shape("circle").shapeRadius(6),e),xa=e=>Zt(ht.legendSymbol().shapePadding(1).labelOffset(3),e),$=()=>Jt(Ur),gt=()=>Jt(xa,Xr),Kr=()=>Jt(Ur,Xr);function Xr(e){if(!e)return null;let t=e.domain(),r=e.range().map(o=>ft.symbol().type(o)());return ft.scaleOrdinal().domain(t).range(r)}function Jt(e,t){let r={},o=null,n=null;function a(l){if(o&&o.range().length>1){let s=e(r);s.scale(o).orient("vertical").on("cellclick",function(i){let m=this.__data__;r.hideKeys=r.hideKeys||[],r.hideKeys.includes(m)?r.hideKeys=r.hideKeys.filter(f=>f!==m):r.hideKeys.push(m),Oe(this)._draw()}),s.labels(i=>{let m=i.domain[i.i].split("|");return r.mainValues.length<=1&&m.length>1?m.slice(0,m.length-1).join("|"):i.domain[i.i]});let u=O(l,"div.legend-container",()=>l.append("div"));s.decorate(i=>{let m=c=>r.hideKeys&&r.hideKeys.includes(c),f=i.select("g.legendCells").attr("transform","translate(20,20)").selectAll("g.cell");f.classed("hidden",m),f.append("title").html(c=>c),n&&f.select("circle, path").style("fill",c=>m(c)?null:n(c)).style("stroke",c=>m(c)?null:Z(n(c)))}),u.attr("class","legend-container").attr("borderbox-on-hover",!0).style("z-index","2").call(s)}}return a.settings=(...l)=>l.length?(r=l[0],a):r,a.scale=(...l)=>l.length?(o=t?t(l[0]):l[0],a):o,a.color=(...l)=>l.length?(n=l[0],a):n,a}function Y(e,t){let r=t||e.data;return e.hideKeys&&e.hideKeys.length>0?r.map(o=>{let n={...o};return e.hideKeys.forEach(a=>{delete n[a]}),n}):r}function Fe(e,t){let r=t||e.data;return e.hideKeys&&e.hideKeys.length>0?r.map(o=>{let n={};return Object.keys(o).map(a=>{e.hideKeys.includes(de(a))||(n[a]=o[a])}),n}):r}import*as ye from"d3fc";var ba=e=>t=>t.style("stroke-width","1.0").style("stroke",e?e.colorStyles.grid.gridLineColor:"#bbb"),va=e=>t=>{t.strokeStyle=e?e.colorStyles.grid.gridLineColor:"#bbb",t.lineWidth=1},wa=e=>e.style("display","none"),_a=e=>t=>{t.lineWidth=1,t.strokeStyle=e?e.colorStyles.grid.gridLineColor:"#bbb"},D=(e,t)=>{let r="both",o=!1,n=null,a=null,l=null,s=ye.seriesSvgMulti(),u=ye.annotationSvgGridline(),i=ba(t),m=wa,f=function(...c){o&&(s=ye.seriesCanvasMulti().context(l),u=ye.annotationCanvasGridline(),i=va(t),m=_a(t));let p=s.xScale(n).yScale(a),d=r==="vertical"?m:i,h=r==="horizontal"?m:i,g=u.xDecorate(d).yDecorate(h);return p.series([g,e])(...c)};return f.orient=(...c)=>c.length?(r=c[0],f):r,f.canvas=(...c)=>c.length?(o=c[0],f):o,f.xScale=(...c)=>c.length?(n=c[0],f):n,f.yScale=(...c)=>c.length?(a=c[0],f):a,f.context=(...c)=>c.length?(l=c[0],f):l,f};import*as qr from"d3fc";var P=()=>{let e=rt(),t=r=>{let o=e.pad(),n=e.padUnit(),a=1;switch(n){case"domain":break;case"percent":{a=r[1]-r[0];break}default:throw new Error("Unknown padUnit: "+n)}let l=r[0]-o[0]*a,s=r[1]+o[1]*a;return r[0]=r[0]>=0&&l<0?0:l,r[1]=r[1]<=0&&s>0?0:s,r};return qr.rebindAll(t,e),t};import*as Re from"d3";var Zr=`<button id="zoom-reset">Reset zoom</button>
<button id="one-year">1 Year</button>
<button id="six-months">6 Months</button>
<button id="one-month">1 Month</button>
`;var M=()=>{let e=null,t=null,r=null,o=null,n=null,a=null,l=!1,s=!1,u=()=>{};function i(p){let d=`d3fc-${s?"canvas":"svg"}.plot-area`;if(r||n){let h=o&&o.domain()[0]instanceof Date,g=Re.zoom().on("zoom",x=>{let{transform:v}=x;t.zoom={k:v.k,x:v.x,y:v.y},m(v),p.call(e);let b=v.k===1&&v.x===0&&v.y===0,_=f(p).style("display",b?"none":"");_.select("#zoom-reset").on("click",()=>p.select(d).call(g.transform,Re.zoomIdentity));let S=_.select("#one-year").style("display",h?"":"none"),k=_.select("#six-months").style("display",h?"":"none"),B=_.select("#one-month").style("display",h?"":"none");if(h){let H=E=>()=>{let z=new Date(r.domain()[0]),V=new Date(z);E(z,V);let C=o.range(),N=(C[1]-C[0])/(o(V)-o(z)),U=-o(z)*N,Q=0;if(n){let _e=n.domain().reduce((ee,oe)=>ee+oe)/2;Q=-a(_e)*N+n(_e)}p.select(d).call(g.transform,Re.zoomIdentity.translate(U,Q).scale(N))};S.on("click",H((E,z)=>z.setYear(E.getFullYear()+1))),k.on("click",H((E,z)=>z.setMonth(E.getMonth()+6))),B.on("click",H((E,z)=>z.setMonth(E.getMonth()+1)))}}),y=e.decorate();e.decorate((x,v)=>{if(y(x,v),!l){l=!0;let b=x.select(d),_=s?window.devicePixelRatio:1;b.on("measure.zoom-range",S=>{if(o&&o.range([0,S.detail.width/_]),a&&a.range([0,S.detail.height/_]),t.zoom){let k=Re.zoomIdentity.translate(t.zoom.x,t.zoom.y).scale(t.zoom.k);b.call(g.transform,k)}}).call(g)}})}p.call(e)}i.chart=(...p)=>p.length?(e=p[0],i):e,i.settings=(...p)=>p.length?(t=p[0],i):t,i.xScale=(...p)=>p.length?(r=c(p[0]),o=r?r.copy():null,i):r,i.yScale=(...p)=>{if(!p.length)return n;if(n=c(p[0]),a=n?n.copy():null,a){let d=a.domain();a.domain([d[1],d[0]])}return i},i.canvas=(...p)=>p.length?(s=p[0],i):s,i.onChange=(...p)=>p.length?(u=p[0],i):u;let m=p=>{let d={...p};if(r&&(r.domain(p.rescaleX(o).domain()),d.xDomain=r.domain()),n){let h=p.rescaleY(a).domain();n.domain([h[1],h[0]]),d.yDomain=n.domain()}u(d)},f=p=>O(p,".zoom-controls",()=>p.append("div").attr("class","zoom-controls").style("display","none").html(Zr)),c=p=>p&&p.nice?p:null;return i};function Qr(e,t){let r=dt(t,Y(t)),o=q(t),n=$().settings(t).scale(o),a=ct(t,o).orient("horizontal"),l=Jr.seriesSvgMulti().mapping((f,c)=>f[c]).series(r.map(()=>a)),s=T(t).settingName("mainValues").valueName("mainValue").excludeType(A.ordinal).include([0]).paddingStrategy(P())(r),u=T(t).excludeType(A.linear).settingName("crossValues").valueName("crossValue").orient("vertical")(r),i=j(s,u).plotArea(D(l,t).orient("horizontal"));i.yPaddingInner&&(i.yPaddingInner(.5),i.yPaddingOuter(.25),a.align("left")),i.xNice&&i.xNice();let m=M().chart(i).settings(t).yScale(u.scale);e.datum(r).call(m),e.call(n)}Qr.plugin={name:"X Bar",category:"X Chart",max_cells:1e3,max_columns:50,render_warning:!0};var en=Qr;import*as cn from"d3fc";var on=(e,t)=>{if(!tn(e)||!tn(t))return;let r=rn(e),o=rn(t);r>o?t[0]=nn(t,r):e[0]=nn(e,o)},tn=e=>e.length===2&&!isNaN(e[0])&&!isNaN(e[1])&&e[0]!==e[1],rn=e=>(0-e[0])/(e[1]-e[0]),nn=(e,t)=>t*e[1]/(t-1);import*as an from"d3fc";var ln=e=>{let t=[],r=!1,o,n=l=>{l.text("");let s=an.dataJoin("span","splitter-label").key(m=>m),u=!r&&t.length===1,i=o&&e.splitValues.length===0;s(l,t).classed("disabled",u).text(m=>m.name).style("color",m=>i?Z(o(m.name)):void 0).on("click",(m,f)=>{u||(r?e.splitMainValues=e.splitMainValues.filter(c=>c!=f.name):e.splitMainValues=[f.name].concat(e.splitMainValues||[]),m.target.getRootNode().host.closest("perspective-viewer")?.dispatchEvent(new Event("perspective-config-update")),a(l))})},a=l=>{let s=Oe(l.node());s._container.innerHTML="",s._draw()};return n.labels=(...l)=>l.length?(t=l[0],n):t,n.alt=(...l)=>l.length?(r=l[0],n):r,n.color=(...l)=>l.length?(o=l[0],n):o,n};var xe=(e,t,r=Va)=>{let o,n,a,l=e.splitMainValues||[],s=m=>{let f=m.split("|");return l.includes(f[f.length-1])},u=e.mainValues.some(m=>s(m.name));n=u?r(t,m=>!s(m)):t,a=u?r(t,s):null;let i=m=>{if(e.mainValues.length===1)return;let f=e.mainValues.map((h,g)=>({index:g,name:h.name})),c=f.filter(h=>!s(h.name)),p=f.filter(h=>s(h.name)),d=()=>ln(e).color(o);m.select(".y-label.left-label").call(d().labels(c)),m.select(".y-label.right-label").call(d().labels(p).alt(!0))};return i.color=(...m)=>m.length?(o=m[0],i):o,i.haveSplit=()=>u,i.data=(...m)=>m.length?(n=m[0],i):n,i.altData=(...m)=>m.length?(a=m[0],i):a,i},Va=(e,t)=>e.map(r=>r.filter(o=>t(o.key))),Qt=(e,t)=>e.map(r=>t(r.key)?r:r.map(o=>Object.assign({},o,{mainValue:null}))),sn=(e,t)=>e.map(r=>Qt(r,t));function un(e,t){let r=dt(t,Y(t)),o=q(t),n=$().settings(t).scale(o),a=ct(t,o).orient("vertical"),l=cn.seriesSvgMulti().mapping((h,g)=>h[g]).series(r.map(()=>a)),s=T(t).excludeType(A.linear).settingName("crossValues").valueName("crossValue")(r),u=T(t).settingName("mainValues").valueName("mainValue").excludeType(A.ordinal).orient("vertical").include([0]).paddingStrategy(P()),i=t.mainValues.length>1?sn:Qt,m=xe(t,r,i).color(o),f=u(m.data()),c=m.haveSplit()?l:D(l,t).orient("vertical"),p=j(s,f).axisSplitter(m).plotArea(c);p.xPaddingInner&&(p.xPaddingInner(.5),p.xPaddingOuter(.25),a.align("left")),p.yNice&&p.yNice();let d=M().chart(p).settings(t).xScale(s.scale);if(m.haveSplit()){let h=u(m.altData());on(f.domain,h.domain),p.yDomain(f.domain).altAxis(h)}e.datum(m.data()).call(d),e.call(n)}un.plugin={name:"Y Bar",category:"Y Chart",max_cells:1e3,max_columns:50,render_warning:!0};var mn=un;import*as fn from"d3fc";import*as pn from"d3fc";function Be(e,t){let r=pn.seriesSvgLine(),o=e.data.length*(e.data?.length>0?Object.keys(e.data[0]).length-(e.crossValues?.length>0?1:0):0),n=Math.max(1,Math.min(3,Math.floor(e.size.width/o/2)));return r=r.decorate(a=>{a.style("stroke",l=>Z(t(l[0]&&l[0].key))).style("stroke-width",n)}),r.crossValue(a=>a.crossValue).mainValue(a=>a.mainValue)}function dn(e,t){let r=W(e);return t.map((o,n)=>Object.keys(o).filter(a=>a!=="__ROW_PATH__").map(a=>({key:a,crossValue:r(o,n),mainValue:o[a],row:o})))}var yt=function(e){let t=[];for(let r of e)for(let o=0;o<r.length;o++)r[o].mainValue!==null&&(t[o]=t[o]||[],t[o].push(r[o]));return t};import*as xt from"d3fc";var er=(e,t,r=Math.min)=>{let o=l=>l.reduce((s,u)=>{let i=n(u,t);return i&&(!s||r(s.value,i.value)===i.value)?i:s},null),n=l=>{if(Array.isArray(l))return o(l,t);let s=t(l);return s!==null?{item:l,value:s}:null},a=o(e,t);return a?a.item:null};var I=()=>{let e=pe().alwaysShow(!0),t=null,r=null,o=null,n=null,a=!1,l=null,s="crossValue",u="mainValue",i=null,m=1;function f(d){let h=`d3fc-${a?"canvas":"svg"}.plot-area`;if(t||r){let g=null,y=xt.pointer().on("point",x=>{let v=x.length?p(x[0]):null;g=v?[v.data]:[];let b=v?v.scale:r;c(d,g,b)});d.select(h).on("measure.nearbyTip",()=>c(d,[])).on("click",()=>{g.length&&Ye(d.node(),g[0],e.settings())}).call(y)}}let c=(d,h,g=r)=>{let y=d.select("d3fc-svg.plot-area svg").selectAll("circle.nearbyTip").data(h);y.exit().remove(),y.enter().append("circle").attr("class","nearbyTip").merge(y).attr("r",x=>n?m*Math.sqrt(n(x.size)):10).attr("transform",x=>`translate(${t(x[s])},${g(x[u])})`).style("stroke","none").style("fill",x=>o&&x.key&&Ve(o(x.key))),e(y)},p=d=>{let h=x=>v=>v[u]===void 0||v[u]===null||v[s]===void 0||v[s]===null?null:Math.sqrt(Math.pow(t(v[s])-d.x,2)+Math.pow(x(v[u])-d.y,2)),g=h(r),y=er(l,g,Math.min);if(i){let x=h(i.yScale),v=er(i.data,x,Math.min);return g(y)<=x(v)?{data:y,scale:r}:{data:v,scale:i.yScale}}return{data:y,scale:r}};return f.scaleFactor=(...d)=>d.length?(m=d[0],f):m,f.xScale=(...d)=>d.length?(t=d[0],f):t,f.yScale=(...d)=>d.length?(r=d[0],f):r,f.color=(...d)=>d.length?(o=d[0],f):o,f.size=(...d)=>d.length?(n=d[0]?d[0].copy().range([40,4e3]):null,f):n,f.canvas=(...d)=>d.length?(a=d[0],f):a,f.data=(...d)=>d.length?(l=d[0],f):l,f.xValueName=(...d)=>d.length?(s=d[0],f):s,f.yValueName=(...d)=>d.length?(u=d[0],f):u,f.altDataWithScale=(...d)=>d.length?(i=d[0],f):i,xt.rebindAll(f,e),f};function hn(e,t){let r=dn(t,Y(t)),o=q(t),n=$().settings(t).scale(o),a=fn.seriesSvgRepeat().series(Be(t,o)).orient("horizontal"),l=P().pad([.1,.1]).padUnit("percent"),s=T(t).excludeType(A.linear).settingName("crossValues").valueName("crossValue")(r),u=T(t).settingName("mainValues").valueName("mainValue").orient("vertical").paddingStrategy(l),i=xe(t,yt(r)).color(o),m=u(i.data()),f=i.haveSplit()?a:D(a,t).orient("vertical"),c=j(s,m).axisSplitter(i).plotArea(f);c.yNice&&c.yNice();let p=M().chart(c).settings(t).xScale(s.scale),d=I().settings(t).xScale(s.scale).yScale(m.scale).color(o).data(r);if(i.haveSplit()){let g=u(i.altData());c.altAxis(g),d.data(i.data()).altDataWithScale({yScale:g.scale,data:i.altData()})}let h=i.data();e.datum(h).call(p),e.call(d),e.call(n)}hn.plugin={name:"Y Line",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0};var gn=hn;import*as bn from"d3fc";import{seriesCanvasPoint as Aa}from"d3fc";import*as F from"d3";var Ca=[F.symbolCircle,F.symbolCross,F.symbolDiamond,F.symbolSquare,F.symbolStar,F.symbolTriangle,F.symbolWye];function bt(e){return e.length>1?F.scaleOrdinal().domain(e).range(Ca):null}var Ta=8,ka=1;function yn(e,t,r,o,n,a,l=1){let s=Aa().crossValue(u=>u.x).mainValue(u=>u.y);return r&&s.size(u=>Math.round(l*r(u.size))),a&&s.type(a(t)),s.decorate((u,i)=>{let m=o(i.colorValue!==void 0?i.colorValue:t),f=e.colorStyles&&e.colorStyles.opacity;if(n){u.fillStyle=e.textStyles.color,u.font=e.textStyles.font;let{type:c}=e.mainValues.find(g=>g.name===n),p=me(c,i.row[n]),d=0;r&&(d=Math.sqrt(l*r(i.size)/Math.PI)*ka);let h=d+Ta;u.fillText(p,h,4)}u.strokeStyle=Z(m),u.fillStyle=Ve(m,f)}),s}function vt(e){let t=e.data&&e.data.length>0?e.data[0]:{},r=[];return Object.keys(t).forEach(o=>{if(o!=="__ROW_PATH__"){let n=de(o);r.includes(n)||r.push(n)}}),bt(r)}function xn(e,t){let r=e.mainValues.length;return t.map(o=>{let n=Object.keys(o).filter(l=>l!=="__ROW_PATH__"),a=new Array(n.length/r);for(let l=0;l<n.length/r;l++)a[l]={key:de(n[l*r]),crossValue:o[n[l*r]],mainValue:o[n[l*r+1]],row:o};return a})}function vn(e,t){let r=yt(xn(t,Fe(t))),o=pt(t),n=vt(t),a=null;o.domain().length>=2&&(a=Kr().settings(t).scale(n).color(o));let l=bn.seriesSvgRepeat().series(Be(t,o)).orient("horizontal"),s=P().pad([.1,.1]).padUnit("percent"),u=T(t).settingName("mainValues").settingValue(t.mainValues[0].name).valueName("crossValue").paddingStrategy(s),m=T(t).settingName("mainValues").settingValue(t.mainValues[1].name).valueName("mainValue").orient("vertical").paddingStrategy(s)(r),f=u(r),c=D(l,t).orient("vertical"),p=j(f,m).xLabel(t.mainValues[0].name).yLabel(t.mainValues[1].name).plotArea(c);p.xNice&&p.xNice(),p.yNice&&p.yNice();let d=M().chart(p).settings(t).xScale(f.scale).yScale(m.scale),h=I().settings(t).xScale(f.scale).yScale(m.scale).color(o).data(r);e.datum(r).call(d),e.call(h),a&&e.call(a)}vn.plugin={name:"X/Y Line",category:"X/Y Chart",max_cells:5e4,max_columns:50,render_warning:!0,initial:{type:"number",count:2,names:["X Axis","Y Axis","Tooltip"]},selectMode:"toggle"};var wn=vn;import*as Ke from"d3fc";import*as _n from"d3fc";function Sn(e,t){let r=_n.seriesSvgArea();return r=r.decorate(o=>{o.style("fill",n=>t(n[0].key)).style("opacity",.5)}),r.crossValue(o=>o.crossValue).mainValue(o=>o.mainValue).baseValue(o=>o.baseValue)}function Vn(e,t){let r=W(e);return t.map((o,n)=>{let a={};return Object.keys(o).filter(l=>l!=="__ROW_PATH__").map(l=>{let s=l.split("|"),u=s[s.length-1],i=a[u]||0,m=i+o[l];return a[u]=m,{key:l,crossValue:r(o,n),mainValue:m,baseValue:i,row:o}})})}function Cn(e,t){let r=Vn(t,Y(t)),o=q(t),n=$().settings(t).scale(o),a=Ke.seriesSvgRepeat().series(Sn(t,o).orient("vertical")),l=Ke.seriesSvgRepeat().series(Be(t,o)).orient("vertical"),s=Ke.seriesSvgMulti().series([a,l]),u=T(t).excludeType(A.linear).settingName("crossValues").valueName("crossValue")(r),i=T(t).settingName("mainValues").valueName("mainValue").excludeType(A.ordinal).orient("vertical").include([0]).paddingStrategy(P()),m=xe(t,r).color(o),f=i(m.data()),c=m.haveSplit()?s:D(s,t).orient("vertical"),p=j(u,f).axisSplitter(m).plotArea(c);p.yNice&&p.yNice();let d=M().chart(p).settings(t).xScale(u.scale),h=I().settings(t).xScale(u.scale).yScale(f.scale).color(o).data(r);if(m.haveSplit()){let g=i(m.altData());p.altAxis(g),h.data(m.data()).altDataWithScale({yScale:g.scale,data:m.altData()})}e.datum(m.data()).call(d),e.call(h),e.call(n)}Cn.plugin={name:"Y Area",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0};var An=Cn;import*as zn from"d3fc";import*as Tn from"d3fc";function kn(e,t,r,o){let n=Tn.seriesSvgPoint().size(100),a=e.colorStyles&&e.colorStyles.opacity;return o&&n.type(o(t)),n.decorate(l=>{l.style("stroke",s=>Z(r(s.colorValue||t))).style("fill",s=>Ve(r(s.colorValue||t),a))}),n.crossValue(l=>l.crossValue).mainValue(l=>l.mainValue)}function Ln(e){let t=e.data&&e.data.length>0?e.data[0]:{},r=Object.keys(t).filter(o=>o!=="__ROW_PATH__");return bt(r)}function En(e,t){let r=Or(t,Y(t)),o=Ln(t),n=q(t),a=gt().settings(t).scale(o).color(n),l=zn.seriesSvgMulti().mapping((g,y)=>g[y]).series(r.map(g=>kn(t,g.key,n,o))),s=P().pad([.05,.05]).padUnit("percent"),u=T(t).excludeType(A.linear).settingName("crossValues").valueName("crossValue")(r),i=T(t).settingName("mainValues").valueName("mainValue").orient("vertical").paddingStrategy(s),m=xe(t,r).color(n),f=i(m.data()),c=m.haveSplit()?l:D(l,t).orient("vertical"),p=j(u,f).axisSplitter(m).plotArea(c);p.yNice&&p.yNice();let d=M().chart(p).settings(t).xScale(u.scale),h=I().settings(t).xScale(u.scale).yScale(f.scale).color(n).data(r);if(m.haveSplit()){let g=i(m.altData());p.altAxis(g),h.data(m.data()).altDataWithScale({yScale:g.scale,data:m.altData()})}e.datum(m.data()).call(d),e.call(h),a&&e.call(a)}En.plugin={name:"Y Scatter",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0};var Nn=En;import*as Pn from"d3fc";function On(e,t){return Ae(e,t,{excludeEmpty:!0}).map(r=>La(e,r))}function La(e,t){let r=W(e),o=t.map((n,a)=>({crossValue:r(n,a),mainValues:e.mainValues.map(l=>n[l.name]),x:n[e.mainValues[0].name],y:n[e.mainValues[1].name],colorValue:e.realValues[2]?n[e.realValues[2]]:void 0,size:e.realValues[3]?n[e.realValues[3]]:void 0,key:t.key,row:n}));return o.key=t.key,o}import*as $e from"d3";function Dn(e,t,r,o){return $e.scaleLinear().domain(Mn(t,r,o))}function be(e,t,r,o){let n=Mn(t,r,o),a=e.colorStyles.gradient.full;if(n[0]>=0)a=e.colorStyles.gradient.positive;else if(n[1]<=0)a=e.colorStyles.gradient.negative;else{let s=Math.max(-n[0],n[1]);n=[-s,s]}let l=za(a);return $e.scaleSequential(l).domain(n)}var Mn=(e,t,r)=>r||Bt().valueName(t).pad([0,0])(e),za=e=>{let t=e.slice(1).map((r,o)=>$e.interpolate(e[o][1],r[1]));return r=>{let o=e.findIndex((s,u)=>u<e.length-1&&r<=e[u+1][0]&&r>s[0]);if(o===-1)return r<=e[0][0]?e[0][1]:e[e.length-1][1];let n=t[o],[a]=e[o],[l]=e[o+1];return n((r-a)/(l-a))}};import*as Ie from"d3";import*as ve from"d3fc";function we(){let e=null;function t(r){let o=O(r,"div.legend-container",()=>r.append("div").attr("class","legend-container legend-color").style("z-index","2")),{width:n,height:a}=o.node().getBoundingClientRect(),l=Ie.scaleBand().domain([0,1]).range([0,n]),s=e.copy().nice().domain(),u=ve.extentLinear().pad([.1,.1]).padUnit("percent")(s),[i,m]=u,f=Ie.range(i,m,(m-i)/a),c=Ie.scaleLinear().domain(u).range([a,0]),p=ve.autoBandwidth(ve.seriesSvgBar()).xScale(l).yScale(c).crossValue(0).baseValue((b,_)=>f[Math.max(0,_-1)]).mainValue(b=>b).decorate(b=>{b.selectAll("path").style("fill",_=>e(_))}),d=s[0]<0&&s[1]>0?0:Math.round((s[1]+s[0])/2),h=[...s,d],g=ve.axisRight(c).tickValues(h).tickSizeOuter(0).tickFormat(b=>ot(b)),y=O(o,"svg",()=>o.append("svg")).style("width",n).style("height",a),x=O(y,"g",()=>y.append("g")).datum(f).call(p),v=Math.abs(x.node().getBBox().x);O(y,"#legend-axis",()=>y.append("g").attr("id","legend-axis")).attr("transform",`translate(${v})`).datum(f).call(g).select(".domain").attr("visibility","hidden")}return t.scale=(...r)=>r.length?(e=r[0],t):e,t}function Ea([e,t],[r,o]){let n=(o-t)/(r-e),a=o-n*r;return function(l){let s=l.node(),u=Math.min(s.clientWidth,s.clientHeight);return Math.min(o,Math.max(t,n*u+a))}}function Fn(e,t){let r=On(t,Fe(t)),o=vt(t),n=t.realValues.length<=2||t.realValues[2]===null,a=null,l=null;n?(a=pt(t),l=gt().settings(t).scale(o).color(n?a:null)):(a=be(t,r,"colorValue"),l=we().scale(a));let s=t.realValues[3]?Dn(t,r,"size").range([10,1e4]):null,u=t.realValues[4],i=Ea([600,.1],[1600,1])(e),m=Pn.seriesCanvasMulti().mapping((y,x)=>y[x]).series(r.map(y=>yn(t,y.key,s,a,u,o,i))),f=()=>T(t).settingName("mainValues").paddingStrategy(P()).pad([.1,.1]),c=f().settingValue(t.mainValues[0].name).valueName("x")(r),p=f().orient("vertical").settingValue(t.mainValues[1].name).valueName("y")(r),d=Me(c,p).xLabel(t.mainValues[0].name).yLabel(t.mainValues[1].name).plotArea(D(m,t).canvas(!0));d.xNice&&d.xNice(),d.yNice&&d.yNice();let h=M().chart(d).settings(t).xScale(c.scale).yScale(p.scale).canvas(!0),g=I().scaleFactor(i).settings(t).canvas(!0).xScale(c.scale).xValueName("x").yValueName("y").yScale(p.scale).color(n&&a).size(s).data(r);e.datum(r).call(h),e.call(g),l&&e.call(l)}Fn.plugin={name:"X/Y Scatter",category:"X/Y Chart",max_cells:5e4,max_columns:50,render_warning:!0,initial:{type:"number",count:2,names:["X Axis","Y Axis","Color","Size","Label","Tooltip"]},selectMode:"toggle"};var Rn=Fn;import*as wt from"d3fc";function Bn(e,t){let r=wt.seriesCanvasHeatmap();return r.decorate((o,n)=>{o.fillStyle=t(n.colorValue)}),wt.autoBandwidth(r).xValue(o=>o.crossValue).yValue(o=>o.mainValue).colorValue(o=>o.colorValue).colorInterpolate(t.interpolator()).widthFraction(1)}function $n(e,t){let r=W(e),o=Ne(e).excludeType(A.linear).settingName("splitValues")(),n=[];return t.forEach((a,l)=>{let s=r(a,l);Object.keys(a).filter(u=>u!=="__ROW_PATH__").forEach(u=>{let i=Na(u);n.push({crossValue:s,mainValue:o===A.time?new Date(i):i,colorValue:a[u],row:a})})}),n}function Na(e){let t=e.split("|");return t.pop(),t.join("|")}function In(e,t){let r=$n(t,Y(t)),o=be(t,r,"colorValue"),n=Bn(t,o),a=we().scale(o),l=T(t).excludeType(A.linear).settingName("crossValues").valueName("crossValue")(r),s=T(t).excludeType(A.linear).settingName("splitValues").valueName("mainValue").modifyDomain(f=>!isNaN(f[0])?f.reverse():f).orient("vertical")(r),u=Me(l,s).plotArea(D(n,t).canvas(!0));u.xPaddingInner&&(u.xPaddingInner(0),u.xPaddingOuter(0),n.xAlign("right")),u.yPaddingInner&&(u.yPaddingInner(0),u.yPaddingOuter(0),n.yAlign("top"));let i=M().chart(u).settings(t).xScale(l.scale).yScale(s.scale).canvas(!0),m=I().settings(t).canvas(!0).xScale(l.scale).yScale(s.scale).color(o).data(r);e.datum(r).call(i),e.call(a),e.call(m)}In.plugin={name:"Heatmap",category:"Hierarchial Chart",max_cells:5e4,max_columns:500,render_warning:!0};var Hn=In;import{seriesCanvasOhlc as Pa}from"d3fc";import*as _t from"d3fc";function Gn(e,t){return Ae(e,t,{excludeEmpty:!0}).map(r=>Oa(e,r))}function Oa(e,t){let r=W(e),o=a=>t[a<t.length-1?a+1:a][e.mainValues[0].name],n=t.map((a,l)=>{let s=e.mainValues.length>=1?a[e.mainValues[0].name]:void 0,u=e.mainValues.length>=2?a[e.mainValues[1].name]:o(l);return{crossValue:r(a,l),mainValues:e.mainValues.map(i=>a[i.name]),openValue:s,closeValue:u,highValue:e.mainValues.length>=3?a[e.mainValues[2].name]:Math.max(s,u),lowValue:e.mainValues.length>=4?a[e.mainValues[3].name]:Math.min(s,u),key:t.key,row:a}});return n.key=t.key,n}import*as He from"d3fc";var Da=e=>e.closeValue>=e.openValue;function jn(e,t,r){let o=r.domain(),n=fe().domain(o).settings(e).defaultColors([e.colorStyles["series-2"]]).mapFunction(Ce(.5))(),a=fe().settings(e).domain(o)(),l=t().crossValue(i=>i.crossValue).openValue(i=>i.openValue).highValue(i=>i.highValue).lowValue(i=>i.lowValue).closeValue(i=>i.closeValue).decorate((i,m)=>{let f=Da(m)?r(m.key):n(m.key);i.fillStyle=f,i.strokeStyle=f}),s=He.seriesCanvasLine().mainValue(i=>i.bollinger.average).crossValue(i=>i.crossValue).decorate((i,m)=>{i.strokeStyle=a(m[0].key)}),u=He.seriesCanvasArea().mainValue(i=>i.bollinger.upper).baseValue(i=>i.bollinger.lower).crossValue(i=>i.crossValue).decorate((i,m)=>{i.fillStyle=Ce(.25)(a(m[0].key))});return He.seriesCanvasMulti().series([u,l,s])}function Ma(e){return function(t,r){let o=Gn(r,Fe(r)),n=_t.indicatorBollingerBands().value(y=>y.openValue),a=o.map(y=>{let x=n(y);return y.map((v,b)=>Object.assign({bollinger:x[b]},v))}),l=o.map(y=>y.key).concat(r.hideKeys?r.hideKeys:[]).sort(),s=fe().domain(l).settings(r).mapFunction(Ce(1))(),u=$().settings(r).scale(l.length>1?s:null),i=jn(r,e,s),m=_t.seriesCanvasMulti().mapping((y,x)=>y[x]).series(a.map(()=>i)),f=P().pad([.1,.1]).padUnit("percent"),c=T(r).settingName("crossValues").valueName("crossValue")(a),p=T(r).settingName("mainValues").valueNames(["lowValue","highValue"]).orient("vertical").paddingStrategy(f)(a),d=Me(c,p).plotArea(D(m,r).orient("vertical").canvas(!0));d.yNice&&d.yNice();let h=M().chart(d).settings(r).xScale(c.scale).onChange(y=>{let x=a.map(v=>v.filter(b=>b.crossValue>=y.xDomain[0]&&b.crossValue<=y.xDomain[1]));d.yDomain(p.domainFunction(x))}).canvas(!0),g=I().settings(r).xScale(c.scale).yScale(p.scale).yValueName("closeValue").color(s).data(a).canvas(!0);t.datum(a).call(h),t.call(g),t.call(u)}}var St=Ma;var Wn=St(Pa);Wn.plugin={name:"OHLC",category:"Y Chart",max_cells:3500,max_columns:50,render_warning:!0,initial:{type:"number",count:4,names:["Open","Close","High","Low"]},selectMode:"toggle"};var Yn=Wn;import{seriesCanvasCandlestick as Fa}from"d3fc";var Un=St(Fa);Un.plugin={name:"Candlestick",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0,initial:{type:"number",count:4,names:["Open","Close","High","Low"]},selectMode:"toggle"};var Kn=Un;import{select as eo}from"d3";function Xn(e,t){if(e.realValues.length>1&&e.realValues[1]!==null){let r=e.realValues[1];if(e.mainValues.find(o=>o.name===r)?.type==="string"){let o=t.map(n=>n.data).filter(n=>n.height>0).map(n=>qn(n)).reduce((n,a)=>n.concat(a));return mt(e,o)}else return be(e,null,null,pr(t.map(o=>o.extents)))}}function qn(e,t=[]){return e.children&&e.children.length>0?e.children.forEach(r=>t.concat(qn(r,t))):e.data.color&&t.push(e.data.color),t}import*as Vt from"d3";function Ct(e){let t={},r=e.realValues.map(n=>n===null?null:e.mainValues.find(a=>a.name===n));return e.data.forEach((n,a)=>{let l=n.__ROW_PATH__;Ba(n).forEach(u=>{let i;t[u]||(t[u]=[]),i=t[u],l.forEach((m,f)=>{let c=i.find(p=>p.name===m);if(c||(c={name:m,children:[]},i.push(c)),e.realValues.length>1&&e.realValues[1]!==null){let p=f===l.length-1,d=Xe(p?n:e.agg_paths[a][f+1]||n,e.mainValues[1],u);d!==void 0&&(c.color=d)}if(e.realValues.length>2&&e.realValues[2]!==null){c.tooltip=[];for(let p=2;p<e.realValues.length;++p)c.tooltip.push(Xe(n,r[p],u))}if(f===l.length-1&&(c.name=l.slice(-1)[0],l.length===e.crossValues.length)){let p=Xe(n,e.mainValues[0],u);c.size=p>0?p:0}i=c.children})})}),Object.entries(t).map(n=>{let a={name:"root",children:n[1]},l=Vt.hierarchy(a).sum(u=>u.size),s=Vt.partition().size([2*Math.PI,l.height+1])(l);return s.each(u=>{u.current=u,u.mainValues=e.realValues.length===1||e.realValues[1]===null&&e.realValues[2]===null?u.value:[u.value,u.data.color].concat(u.data.tooltip||[]).filter(i=>i!==void 0),u.crossValue=u.ancestors().slice(0,-1).reverse().map(i=>i.data.name),u.key=n[0],u.label=me(e.crossValues[u.depth-1<0?0:u.depth-1].type,u.data.name)}),{split:n[0],data:s,extents:Ra(e,n)}})}var Xe=(e,t,r)=>r.length?e[`${r}|${t.name}`]:e[t.name];function Ra(e,[t,r]){if(e.realValues.length>1&&e.realValues[1]!==null){let o=Math.min(...e.data.map(a=>Xe(a,e.mainValues[1],t))),n=Math.max(...r.map(a=>a.color));return[o,n]}}function Ba(e){let t=[];return Object.keys(e).forEach(r=>{if(r!=="__ROW_PATH__"){let o=r.split("|").slice(0,-1).join("|");t.includes(o)||t.push(o)}}),t}import{arc as $a}from"d3";var At=e=>$a().startAngle(t=>t.x0).endAngle(t=>t.x1).padAngle(t=>Math.min((t.x1-t.x0)/2,.005)).padRadius(e).innerRadius(t=>Math.max(1,(t.y0-1)*e)).outerRadius(t=>Math.max((t.y0-1)*e,(t.y1-1)*e-1)),ne=e=>e.y0>=1&&e.x1>e.x0;import{select as Ia}from"d3";var qe=e=>e.y1<=3&&e.y0>=1&&(e.y1-e.y0)*(e.x1-e.x0)>.06;function Tt(e,t){let r=(e.x0+e.x1)/2*180/Math.PI,o=(e.y0-1+(e.y1-1))/2*t;return`rotate(${r-90}) translate(${o},0) rotate(${r<180?0:180})`}function Zn(e,t){let r=this.getBBox().width;if(r>t){let o=e.label,n=Ia(this);for(;r>t;)o=o.substring(0,o.length-1),n.text(()=>o),r=this.getBBox().width;n.text(()=>`${o.substring(0,o.length-3).replace(/\s+$/,"")}...`)}}import{interpolate as Ha}from"d3";var Jn=(e,t,r,o,n,a,l,s,u)=>(i,m)=>{u.sunburstLevel[s]=i.data.name,i.parent?(r.datum(i.parent),r.style("cursor","pointer"),o.html(`&#8682; ${i.label}`)):(r.datum(e),r.style("cursor","default"),o.html("")),e.each(c=>c.target={x0:Math.max(0,Math.min(1,(c.x0-i.x0)/(i.x1-i.x0)))*2*Math.PI,x1:Math.max(0,Math.min(1,(c.x1-i.x0)/(i.x1-i.x0)))*2*Math.PI,y0:Math.max(0,c.y0-i.depth),y1:Math.max(0,c.y1-i.depth)});let f=t.transition().duration(m?0:750);n.transition(f).tween("data",c=>{let p=Ha(c.current,c.target);return d=>c.current=p(d)}).filter(function(c){return+this.getAttribute("fill-opacity")||ne(c.target)}).attr("fill-opacity",c=>ne(c.target)?1:0).attr("user-select",c=>ne(c.target)?"initial":"none").style("pointer-events",c=>ne(c.target)?"initial":"none").attrTween("d",c=>()=>At(l)(c.current)),a.filter(function(c){return+this.getAttribute("fill-opacity")||qe(c.target)}).transition(f).attr("fill-opacity",c=>+qe(c.target)).attrTween("transform",c=>()=>Tt(c.current,l))};function Qn(){let e=null,t=null,r=null,o=null,n=null,a=l=>{let s=l.selectAll("g.segment").data(r.descendants().slice(1)),u=s.enter().append("g").attr("class","segment");u.append("path"),u.append("text").attr("class","segment").attr("dy","0.35em");let i=u.merge(s),m=i.select("path").attr("fill-opacity",h=>ne(h.current)?1:0).attr("user-select",h=>ne(h.current)?"initial":"none").style("pointer-events",h=>ne(h.current)?"initial":"none").attr("d",h=>At(n)(h.current));o&&m.style("fill",h=>o(h.data.color));let f=i.select("text").attr("fill-opacity",h=>+qe(h.current)).attr("transform",h=>Tt(h.current,n)).text(h=>h.label).each(function(h){Zn.call(this,h,n)}),c=l.select("text.parent"),p=l.select("circle").attr("r",n).datum(r),d=Jn(r,l,p,c,m,f,n,t,e);if(e.sunburstLevel){let h=r.descendants().find(g=>g.data.name===e.sunburstLevel[t]);h&&d(h,!0)}else e.sunburstLevel={};p.on("click",h=>d(h,!1)),m.filter(h=>h.children).style("cursor","pointer").on("click",h=>d(h,!1))};return a.settings=(...l)=>l.length?(e=l[0],a):e,a.split=(...l)=>l.length?(t=l[0],a):t,a.data=(...l)=>l.length?(r=l[0],a):r,a.color=(...l)=>l.length?(o=l[0],a):o,a.radius=(...l)=>l.length?(n=l[0],a):n,a}function kt(){let e="element-prefix-unset",t=null,r=null,o=null,n=null,a=null,l=null,s=u=>{let i=O(u,"div.inner-container",()=>u.append("div").attr("class","inner-container")),m=i.node().getBoundingClientRect(),f=m.height,c=m.width-(a?70:0),p=300,d=u.datum(),h=Math.max(1,Math.min(d.length,Math.floor(c/p))),g=Math.ceil(d.length/h);l={width:c/Math.max(h,1),height:Math.min(f,Math.max(f/g,c/Math.max(h,1)))},f/g>l.height*.75&&(l.height=f/g),d.length>1?(i.style("grid-template-columns",`repeat(${h}, ${100/h}%)`),i.style("grid-template-rows",`repeat(${g}, ${l.height}px)`)):(i.style("grid-template-columns","repeat(1, 100%)"),i.style("grid-template-rows","repeat(1, 100%)")),o=i.selectAll(`div.${e}-container`).data(d,y=>y.split),o.exit().remove(),r=o.enter().append("div").attr("class",`${e}-container`),n=r.append("div").attr("class","title-container").style("text-align","center").attr("display","inline-block").append("text").attr("class","title").style("text-align","left"),t=r.append("svg").append("g").attr("class",e)};return s.elementsPrefix=(...u)=>u.length?(e=u[0],s):e,s.chartContainer=()=>t,s.chartEnter=()=>r,s.chartDiv=()=>o,s.chartTitle=()=>n,s.containerSize=()=>l,s}function to(e,t){if(t.crossValues.length===0){console.warn("Unable to render a chart in the absence of any groups.");return}let r=Ct(t),o=Xn(t,r),n=kt().elementsPrefix("sunburst");if(e.datum(r).call(n),o){let m=t.realValues[1];if(t.mainValues.find(f=>f.name===m)?.type==="string"){let f=$().settings(t).scale(o);e.call(f)}else{let f=we().scale(o);e.call(f)}}let a=n.chartContainer(),l=n.chartEnter(),s=n.chartDiv(),u=n.chartTitle(),i=n.containerSize();u.each((m,f,c)=>eo(c[f]).text(m.split)),a.append("circle").attr("fill","none").style("pointer-events","all"),a.append("text").attr("class","parent"),l.merge(s).select("svg").select("g.sunburst").attr("transform",`translate(${i.width/2}, ${i.height/2})`).each(function({split:m,data:f}){let c=eo(this),p=this.parentNode,{width:d,height:h}=p.getBoundingClientRect(),g=(Math.min(d,h)-24)/(t.crossValues.length*2);Qn().settings(t).split(m).data(f).color(o).radius(g)(c),pe().settings(t)(c.selectAll("g.segment"))})}to.plugin={name:"Sunburst",category:"Hierarchial Chart",max_cells:7500,max_columns:50,render_warning:!0,initial:{type:"number",count:1,names:["Size","Color","Tooltip"]}};var ro=to;import*as Qe from"d3";function no(e,t){if(e.realValues.length<1||e.realValues[1]===null||e.realValues[1]===void 0)return;let r=e.realValues[1],o=t.filter(n=>n.height>0).map(n=>oo(n)).reduce((n,a)=>n.concat(a));if(e.mainValues.find(n=>n.name===r)?.type==="string")return mt(e,o);{let n=Math.min(...o),a=Math.max(...o);return be(e,null,null,[n,a])}}function oo(e,t=[]){return e.children&&e.children.length>0?e.children.forEach(r=>t.concat(oo(r,t))):e.data.color&&t.push(e.data.color),t}import{select as R}from"d3";var ao=7,Lt=e=>!!(e.target&&e.target.textAttributes),zt=(e,t,r)=>{e.selectAll("text").each(function(n,a){let l=Ya(n,t,r);this.style=l});let o=Je(e);Ga(o),tr(o)},lo=e=>{e.each((t,r,o)=>{R(o[r]).selectAll("text").attr("dx",t.target.textAttributes.dx).attr("dy",t.target.textAttributes.dy).attr("style",t.target.textAttributes.style)})},tr=e=>{let o=a=>a.getBoundingClientRect(),n=[];e.selectAll("text").filter((a,l,s)=>R(s[l]).attr("style")===Le.high).each((a,l,s)=>n.push(s[l])),e.selectAll("text").filter((a,l,s)=>R(s[l]).attr("style")===Le.low).each((a,l,s)=>{let u=s[l];n.filter(i=>Yt("x",o(i),o(u))&&Yt("y",o(i),o(u),-2)).forEach(()=>R(u).attr("dy",Number(R(u).attr("dy"))+14))})},io=e=>R(e).style("opacity",Ze[R(e).attr("class")]),so=e=>R(e).style("opacity",null),Ze={top:1,mid:.7,lower:0},Je=e=>e.filter((t,r,o)=>R(o[r]).selectAll("text").attr("style")!==Le.zero),Et=e=>e.selectAll("text").each((t,r,o)=>ja(o[r])),Ga=e=>e.selectAll("text").each((t,r,o)=>co(o[r])),co=e=>{let t=R(e),r=e.getBoundingClientRect();t.attr("dx",0-r.width/2).attr("dy",0+r.height/4)},ja=e=>{let r=e.parentNode.childNodes[0],o=e.getBBox(),n=r.getBBox();Wa(e,n,o)||R(e).attr("style",R(e).attr("style"))},Wa=(e,t,r)=>{let o=Math.min(t.height/r.height,t.width/r.width);if(o<1){let n=parseInt(R(e).style("font-size")),a=Math.floor(n*o);return n>ao&&a>ao?(R(e).style("font-size",`${a}px`),co(e)):(R(e).style("font-size",null),R(e).style("opacity","0")),!0}return!1},Ya=(e,t,r)=>{if(!r.filter(o=>o!=="").every(o=>e.crossValue.includes(o)))return Le.zero;switch(e.depth){case t+1:return Le.high;case t+2:return Le.low;default:return Le.zero}},Le={high:"font-size:14px;z-index:5;pointer-events: none;",low:"font-size:8px;opacity:0.7;z-index:4;",zero:"font-size:0px;opacity:0;z-index:4;"};import*as Nt from"d3";var Ot=(e,t)=>{let r=Nt.treemap().size([e,t]).paddingInner(o=>1+2*(o.height-1));return r.tile(Nt.treemapBinary),r};import*as J from"d3";import{hierarchy as Ua,select as rr}from"d3";var Ka=(e,t)=>t.every(r=>e.crossValue.includes(r));function nr(e,t,r,o,n,a){Xa(e,t,r,o,n),e.mapLevel[o].levelRoot=!0,qa(e,a.node().getBoundingClientRect().width,a.node().getBoundingClientRect().height,o),mo(r,o)}function uo(e,t){e.each(r=>{r.mapLevel=[],r.mapLevel[0]={x0:r.x0,x1:ze(r)+r.x0,y0:r.y0,y1:Ee(r)+r.y0,visible:!0,opacity:1}}),t.mapLevel[0].levelRoot=!0,mo(e,0)}var Dt=(e,t)=>{e.each((r,o,n)=>{let a=rr(n[o]).selectAll("text");r.mapLevel[t].textAttributes={dx:a.attr("dx"),dy:a.attr("dy"),class:a.attr("class"),"font-size":a.style("font-size")}})};function Xa(e,t,r,o,n){let a={x:e.x0,y:e.y0,width:e.x1-e.x0,height:e.y1-e.y0},l={width:n.x1-n.x0,height:n.y1-n.y0},s={width:l.width/a.width,height:l.height/a.height};r.each(u=>{let i=(u.x0-a.x)*s.width,m=(u.y0-a.y)*s.height,f=ze(u)*s.width,c=Ee(u)*s.height,p=Ka(u,t)&&u.data.name!==t[o-1];u.mapLevel[o]={x0:i,x1:f+i,y0:m,y1:c+m,visible:p,opacity:p?1:0}}),e.mapLevel[o].levelRoot=!0}function qa(e,t,r,o){let l=Ot(t,r)(Ua(e.data).sum(u=>u.size)).descendants(),s=e.descendants();l.forEach((u,i)=>{s[i].mapLevel[o].x0=l[i].x0,s[i].mapLevel[o].x1=l[i].x1,s[i].mapLevel[o].y0=l[i].y0,s[i].mapLevel[o].y1=l[i].y1})}function mo(e,t){e.selectAll("text").each((r,o,n)=>{let a=rr(n[o]),l=rr(n[o]).datum(),s=a.attr("class");l.mapLevel[t].textLockedAt={opacity:Ze[s]}})}function po(e,t,r,o,n,a,l,s,u){if(o.treemapLevel>0){let i=l.crossValue;ar(l,e,t,r,o,n,a,l,0,i,s,u,1,!1),o.treemapRoute.slice(1,o.treemapRoute.length).forEach(m=>{let f=t.filter(p=>p.crossValue===m).datum(),c=f.crossValue;nr(f,c,t,f.depth,l,n),ar(f,e,t,r,o,n,a,l,f.depth,c,s,u,1,!1)})}}function lr(e,t,r,o,n,a,l,s,u,i){if(!e.children)return;n.treemapLevel<e.depth?n.treemapRoute.push(e.crossValue):n.treemapRoute.pop(),n.treemapLevel=e.depth;let m=e.crossValue;(!e.mapLevel[n.treemapLevel]||!e.mapLevel[n.treemapLevel].levelRoot)&&nr(e,m,r,n.treemapLevel,s,a),ar(e,t,r,o,n,a,l,s,n.treemapLevel,m,u,i)}function ar(e,t,r,o,n,a,l,s,u,i,m,f,c=500,p=!0){let d=e.parent,h=l.transition("main transition").duration(c).ease(J.easeCubicOut);r.each(y=>y.target=y.mapLevel[u]),Lt(e)||el(r,m),r.transition(h).tween("data",y=>{let x=J.interpolate(y.current,y.target);return v=>y.current=x(v)}).styleTween("opacity",y=>()=>y.current.opacity).attrTween("pointer-events",y=>()=>y.target.visible?"all":"none"),t.transition(h).filter(y=>y.target.visible).styleTween("x",y=>()=>`${y.current.x0}px`).styleTween("y",y=>()=>`${y.current.y0}px`).styleTween("width",y=>()=>`${y.current.x1-y.current.x0}px`).styleTween("height",y=>()=>`${y.current.y1-y.current.y0}px`),o.transition(h).filter(y=>y.target.visible).attrTween("x",y=>()=>y.current.x0+ze(y.current)/2).attrTween("y",y=>()=>y.current.y0+Ee(y.current)/2).end().catch(()=>or(r)).then(()=>{Lt(e)||(tr(g),Et(g),Za(o,l,c),p&&Dt(r,u),or(r,m,d))}).catch(y=>{console.error("Exception completing promises after main transition",y),or(r,m,d)}),Lt(e)?lo(r):(o.each((y,x,v)=>io(v[x])),zt(r,u,i));let g=Je(r);d?m.hide(!1).text(e.label).onClick(()=>{lr(d,t,r,o,n,a,l,s,m,f);let y=a.node().getRootNode().host.parentElement;Ye(y,d,f)})():m.hide(!0)()}async function Za(e,t,r=400){let o=t.transition("text fade transition").duration(r).ease(J.easeCubicOut);await e.transition(o).filter(n=>n.target.visible).tween("data",(n,a,l)=>{let s=l[a],u=J.interpolate(Ja(n),Qa(s));return i=>n.current.opacity=u(i)}).styleTween("opacity",n=>()=>n.current.opacity).end().catch(n=>console.error("Exception in text fade transition",n)).then(()=>e.each((n,a,l)=>so(l[a])))}var Ja=e=>e.target.textLockedAt.opacity,Qa=e=>Ze[J.select(e).attr("class")],el=(e,t)=>{t.deactivate(!0),e.each((r,o,n)=>{J.select(n[o]).selectAll("rect").style("pointer-events","none")})},or=(e,t)=>{t&&t.deactivate(!1),e.each((r,o,n)=>{J.select(n[o]).selectAll("rect").style("pointer-events",null)})};var fo=`<button id="goto-parent">Goto parent</button>
`;function ho(e){let t=null,r=null,o=!0,n=!1,a=O(e,".parent-controls",()=>e.append("div").attr("class","parent-controls").style("display",o?"none":"").html(fo)),l=()=>{a.style("display",o?"none":"").select("#goto-parent").style("pointer-events",n?"none":null).html(`\u21EA ${r}`).on("click",()=>t())};return l.deactivate=(...s)=>{if(!s.length)return n;n=s[0];let u=a.select("#goto-parent");return n?u.style("pointer-events","none"):u.style("pointer-events",null),l},l.hide=(...s)=>s.length?(o=s[0],l):o,l.text=(...s)=>s.length?(r=s[0],l):r,l.onClick=(...s)=>s.length?(t=s[0],l):t,l}var Mt={leaf:"leafnode",branch:"branchnode",root:"rootnode"},ze=e=>e.x1-e.x0,Ee=e=>e.y1-e.y0,rl=(e,t)=>t.depth===e,go=(e,t)=>t.depth===0?Mt.root:rl(e,t)?Mt.leaf:Mt.branch;function yo(){let e=null,t=null,r=null,o=null,n=null,a=null,l=s=>{a=ho(n),a();let u=r.height;e.treemapLevel||(e.treemapLevel=0),e.treemapRoute||(e.treemapRoute=[]),Ot(n.node().getBoundingClientRect().width,n.node().getBoundingClientRect().height)(r);let m=s.selectAll("g").data(r.descendants()),f=m.enter().append("g");f.append("rect"),f.append("text");let c=f.merge(m).sort((g,y)=>y.depth-g.depth),p=c.select("rect").attr("class",g=>`treerect ${go(u,g)}`).style("x",g=>g.x0).style("y",g=>g.y0).style("width",g=>ze(g)).style("height",g=>Ee(g));p.style("fill",g=>go(u,g)===Mt.leaf?g.data.color?o(g.data.color):t.colorStyles.series:"transparent");let d=c.filter(g=>g.value!==0).select("text").attr("x",g=>g.x0+ze(g)/2).attr("y",g=>g.y0+Ee(g)/2).text(g=>g.label),h=p.filter(g=>g.crossValue.length===0).datum();uo(c,h),zt(c,0,[]),Et(Je(c)),Dt(c,0),e.treemapRoute.length===0&&e.treemapRoute.push(h.crossValue),p.filter(g=>g.children).on("click",(g,y)=>lr(y,p,c,d,e,n,s,h,a,t)),po(p,c,d,e,n,s,h,a,t)};return l.settings=(...s)=>s.length?(e=s[0],t=s[1],l):e,l.data=(...s)=>s.length?(r=s[0],l):r,l.color=(...s)=>s.length?(o=s[0],l):o,l.container=(...s)=>s.length?(n=s[0],l):n,l}function xo(e,t){if(t.crossValues.length===0){console.warn("Unable to render a chart in the absence of any groups.");return}t.treemaps||(t.treemaps={});let r=Ct(t),o=no(t,r.map(u=>u.data));o&&this._container.classList.add("has-legend");let n=kt().elementsPrefix("treemap");if(e.datum(r).call(n),o){let u=t.realValues[1];if(t.mainValues.find(i=>i.name===u)?.type==="string"){let i=$().settings(t).scale(o);e.call(i)}else{let i=we().scale(o);e.call(i)}}let a=n.chartEnter(),l=n.chartDiv();n.chartTitle().each((u,i,m)=>Qe.select(m[i]).text(u.split)),a.merge(l).select("svg").select("g.treemap").each(function({split:u,data:i}){let m=Qe.select(this);t.treemaps[u]||(t.treemaps[u]={}),yo().settings(t.treemaps[u],t).data(i).container(Qe.select(Qe.select(this.parentNode).node().parentNode)).color(o)(m),pe().settings(t).centered(!0)(m.selectAll("g"))})}xo.plugin={type:"Treemap",name:"Treemap",category:"Hierarchial Chart",max_cells:5e3,max_columns:50,render_warning:!0,initial:{type:"number",count:1,names:["Size","Color","Tooltip"]}};var bo=xo;var nl=[en,mn,gn,wn,An,Nn,Rn,Yn,Kn,bo,ro,Hn],ir=nl;import*as sr from"d3";import*as vo from"gradient-parser";var wo=(e,t)=>{if(!t.colorStyles){let r={scheme:[],gradient:{},interpolator:{},grid:{}},o=ll(e);r.series=o("--d3fc-local-series");for(let a=1;;a++){let l=`series-${a}`,s=o(`--d3fc-local-${l}`);if(!s)break;r[l]=s,r.scheme.push(s)}r.opacity=ol(r.series),r.grid.gridLineColor=o`--d3fc-gridline--color`,["full","positive","negative"].forEach(a=>{let l=o(`--d3fc-local-${a}--gradient`);r.gradient[a]=il(l,r.opacity)}),t.colorStyles=r}if(!t.textStyles){let r=window.getComputedStyle(e),o=r.getPropertyValue("color"),n=`12px ${r.getPropertyValue("font-family")}`;t.textStyles={color:o,font:n}}},ol=e=>sr.color(e).opacity,al=(e,t)=>{let r=sr.color(`#${e}`);return r.opacity=t,r+""},ll=e=>{let t=getComputedStyle(e);return r=>t?.getPropertyValue(r)},il=(e,t)=>{let r=vo.parse(e)[0].colorStops;return r.map((o,n)=>[o.length?o.length.value/100:n/(r.length-1),al(o.value,t)]).sort((o,n)=>o[0]-n[0])};var _o=`:host .chart{--d3fc-local-full--gradient: var(--d3fc-full--gradient, linear-gradient(#4d342f 0%, #e4521b 22.5%, #feeb65 42.5%, #f0f0f0 50%, #dcedc8 57.5%, #42b3d5 67.5%, #1a237e 100%));--d3fc-local-positive--gradient: var(--d3fc-positive--gradient, linear-gradient(#dcedc8 0%, #42b3d5 35%, #1a237e 100%));--d3fc-local-negative--gradient: var(--d3fc-negative--gradient, linear-gradient(#feeb65 100%, #e4521b 70%, #4d342f 0%))}:host .chart{--d3fc-local-series: var(--d3fc-series, rgba(31, 119, 180, .5));--d3fc-local-series-1: var(--d3fc-series-1, #0366d6);--d3fc-local-series-2: var(--d3fc-series-2, #ff7f0e);--d3fc-local-series-3: var(--d3fc-series-3, #2ca02c);--d3fc-local-series-4: var(--d3fc-series-4, #d62728);--d3fc-local-series-5: var(--d3fc-series-5, #9467bd);--d3fc-local-series-6: var(--d3fc-series-6, #8c564b);--d3fc-local-series-7: var(--d3fc-series-7, #e377c2);--d3fc-local-series-8: var(--d3fc-series-8, #7f7f7f);--d3fc-local-series-9: var(--d3fc-series-9, #bcbd22);--d3fc-local-series-10: var(--d3fc-series-10, #17becf)}:host .chart .series{fill:var(--d3fc-local-series)}:host .chart .series-1{fill:var(--d3fc-local-series-1)}:host .chart .series-2{fill:var(--d3fc-local-series-2)}:host .chart .series-3{fill:var(--d3fc-local-series-3)}:host .chart .series-4{fill:var(--d3fc-local-series-4)}:host .chart .series-5{fill:var(--d3fc-local-series-5)}:host .chart .series-6{fill:var(--d3fc-local-series-6)}:host .chart .series-7{fill:var(--d3fc-local-series-7)}:host .chart .series-8{fill:var(--d3fc-local-series-8)}:host .chart .series-9{fill:var(--d3fc-local-series-9)}:host .chart .series-10{fill:var(--d3fc-local-series-10)}:host{user-select:none}:host .chart{position:absolute;box-sizing:border-box;left:0;top:0;width:100%;height:100%;padding:15px;overflow:hidden}:host .chart.heatmap d3fc-group.cartesian-chart,:host .chart.treemap d3fc-group.cartesian-chart{grid-template-columns:minmax(0em,max-content) auto 1fr auto minmax(0em,max-content);grid-template-rows:minmax(0em,max-content) auto 1fr auto minmax(0em,max-content)}:host .chart .chart-label{display:none}:host .chart.heatmap{padding-right:120px}:host .chart.sunburst{padding:0;font-size:14px}:host .chart.sunburst .inner-container{width:100%;height:100%;display:inline-grid;padding:0;margin:0;overflow-x:hidden;overflow-y:auto}:host .chart.sunburst .inner-container div{overflow:hidden}:host .chart.sunburst .inner-container .sunburst-container:not(:only-child) svg{transform:translateY(-27px)}:host .chart.sunburst .inner-container svg{width:100%;height:100%}:host .chart.sunburst .inner-container path{fill:var(--d3fc-series, rgba(31, 119, 180, .5))}:host .chart.sunburst .inner-container text.segment,:host .chart.sunburst .inner-container text.parent{text-anchor:middle;user-select:none;pointer-events:none;fill:var(--d3fc-treedata--labels, #333333)}:host .chart.sunburst .inner-container div.title-container{margin-top:5px}:host .chart.has-legend{padding-right:120px}:host .chart.treemap .treemap-container{position:relative}:host .chart.treemap .treemap-container:not(:only-child){width:calc(100% - 12px);height:calc(100% - 12px)}:host .chart.treemap .inner-container{width:100%;height:100%;display:inline-grid;padding:0;margin:0;overflow-x:hidden;overflow-y:auto}:host .chart.treemap .inner-container div{overflow:hidden}:host .chart.treemap .inner-container svg{width:100%;height:100%}:host .chart.treemap .inner-container .treerect{stroke:var(--d3fc-treedata-axis--lines, var(--d3fc-axis--lines, white));fill:var(--d3fc-series, rgba(31, 119, 180, .5))}:host .chart.treemap .inner-container .treerect:hover{cursor:pointer;stroke:var(--d3fc-treedata--hover-highlight, black);stroke-opacity:1}:host .chart.treemap .inner-container .rootnode{opacity:0;pointer-events:none;z-index:0}:host .chart.treemap .inner-container .branchnode{opacity:0}:host .chart.treemap .inner-container .branchnode:hover{fill-opacity:.1;opacity:1;fill:var(--d3fc-treedata--hover-highlight, black)}:host .chart.treemap .inner-container .leafnode{fill-opacity:.8}:host .chart.treemap .inner-container .leafnode:hover{fill-opacity:.5}:host .chart.treemap .inner-container #hidden{opacity:0;pointer-events:none;z-index:0}:host .chart.treemap .inner-container .top{font-size:14px;z-index:5;pointer-events:none}:host .chart.treemap .inner-container .mid{font-size:8px;opacity:.7;z-index:4}:host .chart.treemap .inner-container .lower{font-size:0px;opacity:0;z-index:4}:host .chart.treemap .inner-container text{fill:var(--d3fc-treedata--labels, #333333)}:host .chart.treemap .inner-container text.title{dominant-baseline:hanging}:host .chart.treemap .inner-container .parent-controls{position:absolute;top:15px;right:auto;left:30px;width:auto;z-index:4;transition:box-shadow 1s}:host .chart.treemap .inner-container .parent-controls:hover{box-shadow:2px 2px 6px #000;transition:box-shadow .2s}:host .chart .x-label{height:1.2em!important;line-height:1em!important}:host .chart .x-label,:host .chart .y-label{color:var(--d3fc-label--color, inherit);font-size:14px}:host .chart d3fc-canvas.plot-area{display:none}:host .chart.xyscatter d3fc-canvas.plot-area,:host .chart.xyline d3fc-canvas.plot-area,:host .chart.ohlc d3fc-canvas.plot-area,:host .chart.candlestick d3fc-canvas.plot-area,:host .chart.heatmap d3fc-canvas.plot-area{display:block}:host .chart .y-axis text,:host .chart .x-axis text{fill:var(--d3fc-axis-ticks--color, #505050);font-size:11px}:host .chart .y-axis path,:host .chart .x-axis path{stroke:var(--d3fc-axis--lines, #b4d2e1)}:host .chart .splitter-label{display:inline-block;margin:0 10px;cursor:pointer}:host .chart .splitter-label:after{margin-left:5px;color:var(--d3fc-axis--lines, #b4d2e1)}:host .chart .splitter-label:hover:after{color:var(--d3fc-axis-ticks--color, #505050)}:host .chart .splitter-label.disabled{cursor:default}:host .chart .splitter-label.disabled:after{color:#5050504d}:host .chart .y-label.left-label .splitter-label:after{font-family:var(--d3fc-y1-label--font-family, var(--button--font-family, inherit));content:var(--d3fc-y1-label--content, "\\1f847")}:host .chart .y-label.right-label .splitter-label:after{font-family:var(--d3fc-y2-label--font-family, var(--button--font-family, inherit));content:var(--d3fc-y2-label--content, "\\1f845")}:host .chart.ybar .y-axis path,:host .chart.yline .y-axis path,:host .chart.xyline .y-axis path,:host .chart.xyline .x-axis path,:host .chart.yarea .y-axis path,:host .chart.yscatter .y-axis path,:host .chart.xyscatter .y-axis path,:host .chart.xyscatter .x-axis path,:host .chart.xbar .x-axis path{visibility:hidden}:host .chart .y-label{white-space:nowrap}:host .chart .nearbyTip{fill:var(--d3fc-series, rgba(31, 119, 180, .5))}:host #dragHandles{position:absolute;top:0;right:0;left:auto;pointer-events:none}:host #dragHandles rect{pointer-events:all}:host .label rect{fill:none}:host .legend-container{position:absolute;top:15px;right:15px;left:auto;width:150px;height:280px}:host .legend-container.legend-color{width:90px;height:150px}:host .legend-container[borderbox-on-hover=true]{transition:box-shadow 1s}:host .legend-container[borderbox-on-hover=true]:hover{background-color:var(--d3fc-legend--background, #ffffff);box-shadow:0 2px 4px #0000001a;transition:box-shadow .2s,background-color .2s}:host .legend-container .legend{font-size:8pt;width:100%}:host .legend-container .legend .cell{cursor:pointer}:host .legend-container .legend .cell path{fill:var(--d3fc-series, rgba(31, 119, 180, .5));stroke:var(--d3fc-series, #1f77b4)}:host .legend-container .legend .cell.hidden path{fill:#cccccc80;stroke:#ccc}:host .legend-container .legend .cell.hidden circle{fill:#ccc!important}:host .legend-container text{fill:var(--d3fc-legend--text, #333333)}:host .legend-container .label:hover{fill:#22a0ce}:host .legend-container #legend-axis path{stroke:var(--d3fc-legend--text, #333333)}:host .legend-container .legend-controls{margin-left:12px}:host .legend-container .legend-controls #up-arrow,:host .legend-container .legend-controls #down-arrow{cursor:pointer;color:#1f77b4}:host .legend-container .legend-controls #up-arrow.disabled,:host .legend-container .legend-controls #down-arrow.disabled{cursor:default;color:#333}:host .heatmap .legend-container.legend-color{height:200px}:host .treemap .legend-container.legend-color{height:200px}:host .treemap .legend-container:not(.legend-color){width:100px}:host .zoom-controls{position:absolute;top:10px;left:0;width:100%;text-align:center}:host .zoom-controls button{-webkit-appearance:none;background:var(--plugin--background, #f7f7f7);border:1px solid var(--inactive--color, #cccccc);color:var(--d3fc-label--color, inherit);font-size:12px;padding:8px;opacity:.5;cursor:pointer}:host .zoom-controls button:hover{opacity:1}:host .parent-controls{position:absolute;top:30px;right:145px;width:100%;text-align:right}:host .parent-controls button{-webkit-appearance:none;background:#f7f7f7;border:1px solid #cccccc;padding:10px;opacity:.5;cursor:pointer}:host .parent-controls button:hover{background:#e6e6e6}:host div.tooltip{position:absolute;text-align:left;font-size:12px;font-weight:300;white-space:nowrap;padding:.5em;background:var(--d3fc-tooltip--background, #ffffff);color:var(--d3fc-tooltip--color, black);border:1px solid var(--d3fc-tooltip--border-color, #777777);box-shadow:var(--d3fc-tooltip--box-shadow, none);pointer-events:none}:host div.tooltip ul{margin:0;padding:0;list-style-type:none}
`;import*as Vo from"d3";var So={initial:{type:"number",count:1},selectMode:"select"},cl=`${_o}${ul()}`,cr=["crossValues","mainValues","realValues","splitValues","filter","data","size","colorStyles","textStyles","agg_paths","treemaps"];function ul(){let e=document.querySelector("head").querySelectorAll("style"),t=[];return e.forEach(r=>{r.innerText.indexOf("d3fc-")!==-1&&t.push(r.innerText)}),t.join("")}function ml(e){customElements.get("perspective-viewer").registerPlugin(e)}function Co(...e){e=new Set(e.length>0?e:ir.map(t=>t.plugin.name)),ir.forEach(t=>{if(e.has(t.plugin.name)){let r=t.plugin.name.toLowerCase().replace(/[ \t\r\n\/]*/g,""),o=`perspective-viewer-d3fc-${r}`;customElements.define(o,class extends HTMLElement{constructor(){super(),this._chart=null,this._settings=null,this.render_warning=!0}connectedCallback(){this._initialized||(this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`<style>${cl}</style>`,this.shadowRoot.innerHTML+='<div id="container" class="chart"></div>',this._container=this.shadowRoot.querySelector(".chart"),this._initialized=!0)}get name(){return t.plugin.name}get category(){return t.plugin.category}get select_mode(){return t.plugin.selectMode||"select"}get min_config_columns(){return t.plugin.initial?.count||So.initial.count}get config_column_names(){return t.plugin.initial?.names||So.initial.names}get max_cells(){return t.plugin.max_cells||4e3}set max_cells(n){t.plugin.max_cells=n}get max_columns(){return t.plugin.max_columns||50}set max_columns(n){t.plugin.max_columns=n}async render(){var n=document.createElement("canvas"),a=this.shadowRoot.querySelector("#container");n.width=a.offsetWidth,n.height=a.offsetHeight;let l=n.getContext("2d");l.fillStyle=window.getComputedStyle(this).getPropertyValue("--plugin--background")||"white",l.fillRect(0,0,n.width,n.height);let s=window.getComputedStyle(this).getPropertyValue("color"),u=Array.from(this.shadowRoot.querySelectorAll("svg:not(#dragHandles)"));for(let c of u.reverse()){var i=document.createElement("img");i.width=c.parentNode.offsetWidth,i.height=c.parentNode.offsetHeight;let p=c.cloneNode(!0);p.hasAttribute("viewBox")||p.setAttribute("viewBox",`0 0 ${i.width} ${i.height}`),p.setAttribute("xmlns","http://www.w3.org/2000/svg");for(let h of p.querySelectorAll("text"))h.setAttribute("fill",s);var m=new XMLSerializer().serializeToString(p);m=m.replace(/[^\x00-\x7F]/g,"");let d=new Promise((h,g)=>{i.onload=h,i.onerror=g});try{i.src=`data:image/svg+xml;base64,${btoa(m)}`,await d}catch{let g=new Promise((y,x)=>{i.onload=y,i.onerror=x});i.src=`data:image/svg+xml;utf8,${m}`,await g}l.drawImage(i,c.parentNode.offsetLeft,c.parentNode.offsetTop,i.width,i.height)}let f=Array.from(this.shadowRoot.querySelectorAll("canvas"));for(let c of f.reverse())l.drawImage(c,c.parentNode.offsetLeft,c.parentNode.offsetTop,c.width/window.devicePixelRatio,c.height/window.devicePixelRatio);return await new Promise(c=>n.toBlob(p=>c(p)),"image/png")}async draw(n,a,l){if(this.offsetParent===null){this._staged_view=[n,a,l];return}this._staged_view=void 0,this.config=await this.parentElement.save(),await this.update(n,a,l,!0)}async update(n,a,l,s=!1){if(this.offsetParent===null)return;let u=this.parentElement,i,m,f=this.config.columns,c=t.plugin.name!=="Sunburst";a&&l?i=n.to_json({end_row:l,end_col:a,leaves_only:c}):a?i=n.to_json({end_col:a,leaves_only:c}):l?i=n.to_json({end_row:l,leaves_only:c}):i=n.to_json({leaves_only:c}),m=await Promise.all([u.getTable().then(V=>V.schema(!1)),n.expression_schema(!1),n.schema(!1),i,n.get_config()]);let[p,d,h,g,y]=m,x=function(V){let C=p[V];return C||(C=d[V]),C},{columns:v,group_by:b,split_by:_,filter:S}=y,k=b.length>0?g.reduce((V,C)=>{if(C.__ROW_PATH__&&C.__ROW_PATH__.length==b.length)V.agg_paths.push(V.aggs.slice()),V.rows.push(C);else{let N=C.__ROW_PATH__.filter(U=>U!==void 0).length;V.aggs[N]=C,V.aggs=V.aggs.slice(0,N+1)}return V},{rows:[],aggs:[],agg_paths:[]}):{rows:g},B=(V,C)=>b.length?V:{...V,__ROW_PATH__:[C]},H=k.rows.map(B),E={realValues:f,crossValues:b.map(V=>({name:V,type:x(V)})),mainValues:v.map(V=>({name:V,type:h[V]})),splitValues:_.map(V=>({name:V,type:x(V)})),filter:S,data:H,agg_paths:k.agg_paths};this._chart=t;let z={set:(V,C,N)=>(cr.includes(C)||this._container&&this._container.dispatchEvent(new Event("perspective-plugin-update",{bubbles:!0,composed:!0})),V[C]=N,!0)};this._settings=new Proxy({...this._settings,...E},z),this._settings.splitMainValues&&this._settings.splitMainValues.length>=v.length&&(this._settings.splitMainValues=[]),wo(this._container,this._settings),s&&(this._container.innerHTML=""),this._draw(),await new Promise(V=>requestAnimationFrame(V))}async clear(){this._container&&(this._container.innerHTML="")}_draw(){if(this.offsetParent!==null){let n=Vo.select(this._container),a=`chart ${r}`;this._settings.size=this._container.getBoundingClientRect(),this._settings.data.length>0?this._chart(n.attr("class",a),this._settings):n.attr("class",`${a} disabled`)}}async resize(n){if(this.offsetParent!==null)if(this._settings?.data!==void 0)this._draw();else{let[a,l,s]=this._staged_view;this._staged_view=void 0,this.draw(a,l,s)}}async restyle(...n){let a=this._settings;a&&(delete a.colorStyles,delete a.textStyles,await this.draw(...n))}async delete(){this._container.innerHTML=""}getContainer(){return this._container}save(){let n={...this._settings};return cr.forEach(a=>{delete n[a]}),n}restore(n){let a={};for(let l of cr)a[l]=this._settings?.[l];this._settings={...a,...n},this._draw()}}),customElements.whenDefined("perspective-viewer").then(()=>ml(o))}})}Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector);Co("Y Line");
//# sourceMappingURL=line.js.map
